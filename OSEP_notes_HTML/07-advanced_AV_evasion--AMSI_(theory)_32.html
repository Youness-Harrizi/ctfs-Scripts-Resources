<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>AMSI (theory)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>AMSI (theory)</h1><br/><p><ul><li><small>To protect against malicious PowerShell scripts, Microsoft introduced the Antimalware Scan Interface to allow run-time inspection of all PowerShell commands or scripts. At a high level, AMSI captures every PowerShell, Jscript, VBScript, VBA, or .NET command or script at run-time and passes it to the local antivirus software for inspection.</small></li><li><small>only 11 vendors today support amsi</small></li><li><small>How it works</small><ul><li></li></ul></li></ul><img src="images/32-1.png" alt="images/32-1.png" /><ul><li>AMSI.dll is injected onto every powershell process </li><li>info gathered by the api is capture via RPC to AV (e.g defender)</li><li>Windows Defender scans the buffer passed to AmsiScanBuffer and returns the result value. This value is defined according to the AMSI_RESULT361 enum. A return value of “32768” indicates the presence of malware, and “1” indicates a clean scan</p><p></li></ul></p></div>
</body>
</html>
